(()=>{"use strict";const t=(()=>{let t=[];return{addToList:function(e){t.push(e),console.log(t)},TodoList:t,removeTask:function(e){return t=t.filter((t=>e!==t.id))}}})(),e=function(){const t=r.grabProjectList();var e;localStorage.setItem("project",(e=t,JSON.stringify(e))),console.log(JSON.parse(localStorage.getItem("project")))},o=function(){const e=JSON.parse(localStorage.getItem("project"));e[0].taskList.forEach((e=>{t.addToList(e),m.updateDisplay(e.project)})),e.filter((t=>0!==t.id)).forEach((t=>{r.addToProjectList(t),p.displayProject(t)}))},n=(t,e,o)=>({title:t,taskList:e,id:o}),r=(()=>{let o,r=[],i=t.TodoList;const l=n("General",i,0);r.push(l);let c=0;function a(t){r.push(t),console.log(r)}return{submitProject:function(){document.querySelector("#createProject").addEventListener("click",(t=>{if(t.preventDefault(),function(){o=document.querySelector("#projectTitle").value;const t=0===r.length?0:r[r.length-1].id+1;if(""!==o){const r=n(o,[],t);console.log(r),a(r),e()}}(),""!==o){let t=r[r.length-1];p.displayProject(t),document.querySelector("#projectTitle").value="",o=""}}))},grabProjectId:function(t){let e=parseInt(t.target.getAttribute("data-projectId"));return c=e,c},grabCurrentProject:function(){return c},grabProjectList:function(){return r},projectList:r,updateGeneralList:function(t){return l.taskList=t,console.log(l.taskList),l},updateProject:function(t){let e=l.taskList.filter((e=>e.project===t));return console.log(e),0!==t?r.filter((e=>e.id===t))[0].taskList=e:void 0},grabCurrentProjectTasks:function(t){return console.log(r.filter((e=>e.id===t))[0].taskList),r.filter((e=>e.id===t))[0].taskList},removeProject:function(t){return console.log("before",r),r=r.filter((e=>e.id!==t)),console.log("after",r),r},addToProjectList:a}})();function i(t){const e=Object.prototype.toString.call(t);return t instanceof Date||"object"==typeof t&&"[object Date]"===e?new t.constructor(+t):"number"==typeof t||"[object Number]"===e||"string"==typeof t||"[object String]"===e?new Date(t):new Date(NaN)}function l(t){const e=i(t);return e.setHours(0,0,0,0),e}function c(t){return e=t,o=Date.now(),+l(e)==+l(o);var e,o}let a={};function s(){return a}function d(t,e){const o=s(),n=e?.weekStartsOn??e?.locale?.options?.weekStartsOn??o.weekStartsOn??o.locale?.options?.weekStartsOn??0,r=i(t),l=r.getDay(),c=(l<n?7:0)+l-n;return r.setDate(r.getDate()-c),r.setHours(0,0,0,0),r}function u(t,e){return function(t,e,o){return+d(t,o)==+d(e,o)}(t,Date.now(),e)}const m=(()=>{function o(o,i){const l=document.createElement("div");l.setAttribute("data-taskId",`${o.id}`),l.classList.add("task");const c=document.createElement("div"),s=document.createElement("div"),d=document.createElement("div"),u=document.createElement("div"),m=document.createElement("button"),p=document.createElement("button"),f=document.createElement("input"),g=document.createElement("label");return c.textContent=`Title: ${o.title}`,s.textContent=`Due Date: ${o.duedate}`,d.textContent=`Details: ${o.details}`,u.textContent=`Priority: ${o.priority}`,m.textContent="delete",p.textContent="edit",g.textContent="Done?",f.setAttribute("type","checkbox"),f.setAttribute("id",`status-${o.id}`),f.setAttribute("name","status"),f.setAttribute("value","off"),g.setAttribute("for",`status-${o.id}`),m.setAttribute("data-taskId",`${o.id}`),f.addEventListener("click",(()=>{"off"===f.value?n(o,f,g,p,l):function(t,e,o,n,r){o.textContent="Done?",e.value="off",n.removeAttribute("disabled"),t.status="unfinished",r.classList.remove("finished")}(o,f,g,p,l),e()})),m.addEventListener("click",(()=>function(o,n){let i=t.removeTask(o);const l=document.querySelector("#general");for(r.updateGeneralList(i),r.updateProject(n),e();l.lastElementChild;)l.removeChild(l.lastElementChild);a(n),console.log(r.projectList),console.log(n)}(o.id,o.project))),p.addEventListener("click",(()=>{!function(t){const e=document.querySelector("#main-form");e.classList.add("edit-mode"),e.setAttribute("data-taskId",`${t.id}`);let o=document.getElementById("title"),n=document.getElementById("details"),r=document.getElementById("date"),i=document.getElementById("priority");const l=t.title,c=t.details,a=t.duedate,s=t.priority;o.value=l,n.value=c,r.value=a,i.value=s,e.removeAttribute("hidden")}(o)})),"finished"===o.status&&(f.setAttribute("checked",""),n(o,f,g,p,l)),l.append(c,s,d,u,m,p,g,f),i.appendChild(l),i}function n(t,e,o,n,r){o.textContent="Done!",e.value="on",n.setAttribute("disabled",""),t.status="finished",r.classList.add("finished")}function l(){return document.querySelector("#general").getAttribute("class")}function a(t){let e=l();"inboxTab"===e?s():"todayTab"===e?d():"weekTab"===e?m():e===`${t}`&&0!==t&&p.displayProjectTasks(t)}function s(){let t=r.grabProjectList()[0].taskList;const e=document.querySelector("#general");for(e.classList.replace(e.getAttribute("class"),"inboxTab");e.lastElementChild;)e.removeChild(e.lastElementChild);console.log(t),t.forEach((t=>o(t,e))),console.log(r.projectList)}function d(){let t=r.grabProjectList()[0].taskList;const e=document.querySelector("#general");for(e.classList.replace(e.getAttribute("class"),"todayTab");e.lastElementChild;)e.removeChild(e.lastElementChild);t.filter((t=>c(i(t.duedate)))).forEach((t=>o(t,e)))}function m(){let t=r.grabProjectList()[0].taskList;const e=document.querySelector("#general");for(e.classList.replace(e.getAttribute("class"),"weekTab");e.lastElementChild;)e.removeChild(e.lastElementChild);t.filter((t=>u(i(t.duedate)))).forEach((t=>o(t,e)))}return{displayInbox:s,displayDaily:d,displayWeekly:m,displayAllTask:o,updateDisplay:a,grabTab:l}})(),p=(()=>{function o(t){r.projectList;const e=document.querySelector("#general");for(e.classList.replace(e.getAttribute("class"),`${t}`);e.lastElementChild;)e.removeChild(e.lastElementChild);r.grabCurrentProjectTasks(t).forEach((t=>m.displayAllTask(t,e)))}return{displayProject:function n(i){const l=document.querySelector(".all-projects"),c=document.createElement("div"),a=document.createElement("div"),s=document.createElement("button"),d=document.createElement("button");return c.classList.add(`project-${i.id}`),c.setAttribute("data-projectId",`${i.id}`),s.setAttribute("data-projectId",`${i.id}`),s.setAttribute("id",`project-${i.id}`),a.textContent=`${i.title}`,s.textContent="+",d.textContent="delete",c.addEventListener("click",(t=>{t.stopPropagation(),o(i.id)})),s.addEventListener("click",(t=>{t.stopPropagation(),console.log("project id",r.grabProjectId(t));const e=document.querySelector("#main-form");r.grabProjectId(t),e.removeAttribute("hidden"),t.preventDefault()})),d.addEventListener("click",(o=>{o.stopPropagation(),function(o){r.removeProject(o);let i=r.grabProjectList();t.TodoList.filter((t=>t.project===o)).forEach((e=>{let o=t.removeTask(e.id);r.updateGeneralList(o)}));let l=document.querySelector(".all-projects");for(;l.lastElementChild;)l.removeChild(l.lastElementChild);i.forEach((t=>{t.id>0&&n(t)})),parseInt(m.grabTab(o))===o?m.displayInbox():m.updateDisplay(o),e()}(i.id)})),c.append(a,s,d),l.appendChild(c),l},displayProjectTasks:o}})(),f=(()=>{let o,n;function l(){const e=r.grabProjectList();o=document.getElementById("title").value,n=document.getElementById("details").value;let l=document.getElementById("date").value,a=document.getElementById("priority").value,s=function(){let t=r.grabProjectList()[0].taskList;return 0===t.length?0:t[t.length-1].id+1}(),d=r.grabCurrentProject();if(console.log(u(i(l))),console.log(c(i(l))),""!==o&&""!==n&&""!==l){const r=((t,e,o,n,r,i,l)=>({id:t,title:e,details:o,duedate:n,priority:r,project:i,status:"unfinished"}))(s,o,n,l,a,d);console.log(r),0===d&&(e[0].taskList.push(r),console.log(e));for(let o=1;o<e.length;o++)e[o].id===d&&(t.addToList(r),e[o].taskList.push(r),console.log(e))}}function a(){document.getElementById("title").value="",o="",document.getElementById("details").value="",n="",document.getElementById("date").value="",document.getElementById("priority").value="Low"}return{createNewTask:l,initSubmitBtn:function(){document.querySelector("#submit").addEventListener("click",(t=>{!function(){const t=document.querySelector("#main-form"),i=document.querySelector("#newTask"),c=parseInt(t.getAttribute("data-taskId"));if("edit-mode"===t.getAttribute("class")?(console.log("werk"),function(t){let e=document.getElementById("title").value,i=document.getElementById("details").value,l=document.getElementById("date").value,c=document.getElementById("priority").value;const a=r.grabProjectList()[0].taskList,s=a.filter((e=>t===e.id))[0];s.title=e,s.details=i,s.duedate=l,s.priority=c,o=e,n=i;for(let e=0;e<a.length;e++)a[e].id===t&&(a[e]=s,r.updateProject(a[e].project),console.log(r.grabProjectList()))}(c)):l(),e(),""===o||""===n)return;let s,d=r.grabProjectList()[0].taskList;"edit-mode"===t.getAttribute("class")?(s=d.filter((t=>c===t.id))[0].project,t.classList.remove("edit-mode")):s=d[d.length-1].project,m.updateDisplay(s),a(),t.setAttribute("hidden",""),i.removeAttribute("hidden")}(),t.preventDefault()}))},cancelTask:function(){const t=document.querySelector("#cancel"),e=document.querySelector("#main-form"),o=document.querySelector("#newTask");t.addEventListener("click",(t=>{a(),e.setAttribute("hidden",""),o.removeAttribute("hidden"),t.preventDefault()}))},openTaskCreator:function(){const t=document.querySelector("#newTask"),e=document.querySelector("#main-form");t.addEventListener("click",(o=>{r.grabProjectId(o),e.removeAttribute("hidden"),t.setAttribute("hidden",""),o.preventDefault()}))}}})();f.initSubmitBtn(),f.cancelTask(),f.openTaskCreator(),r.submitProject();const g=document.querySelector("#today"),b=document.querySelector("#weekly"),y=document.querySelector("#inbox");g.addEventListener("click",m.displayDaily),b.addEventListener("click",m.displayWeekly),y.addEventListener("click",m.displayInbox),document.addEventListener("DOMContentLoaded",o)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QyxhQUFhLFNBQVUsSUFDbkNvRCxFQUFXeEMsZ0JBQWdCLFVBQzNCaEUsRUFBRUMsZ0JBQWdCLEdBRTFCLEVBY21EOEcsZ0JBWm5ELFdBQ0ksTUFBTVAsRUFBYTNHLFNBQVNDLGNBQWMsWUFDcEMrRixFQUFjaEcsU0FBU0MsY0FBYyxjQUUzQzBHLEVBQVd6RyxpQkFBaUIsU0FBVUMsSUFDbEMzQixFQUFTaUMsY0FBY04sR0FDdkI2RixFQUFZN0IsZ0JBQWdCLFVBQzVCd0MsRUFBV3BELGFBQWEsU0FBVSxJQUNsQ3BELEVBQUVDLGdCQUFnQixHQUUxQixFQUdILEVBaEtlLEdDUmhCZ0csRUFBUU0sZ0JBQ1JOLEVBQVFZLGFBQ1JaLEVBQVFjLGtCQUVSMUksRUFBU3VCLGdCQUVULE1BQU1vSCxFQUFXbkgsU0FBU0MsY0FBYyxVQUNsQ21ILEVBQVVwSCxTQUFTQyxjQUFjLFdBQ2pDb0gsRUFBV3JILFNBQVNDLGNBQWMsVUFFeENrSCxFQUFTakgsaUJBQWlCLFFBQVFkLEVBQVdtRyxjQUM3QzZCLEVBQVFsSCxpQkFBaUIsUUFBU2QsRUFBV29HLGVBQzdDNkIsRUFBU25ILGlCQUFpQixRQUFTZCxFQUFXa0csY0FFOUN0RixTQUFTRSxpQkFBaUIsbUJBQW9CNUIsRSIsInNvdXJjZXMiOlsid2VicGFjazovL3RvZG8tbGlzdC8uL3NyYy9tYW5hZ2VMaXN0LmpzIiwid2VicGFjazovL3RvZG8tbGlzdC8uL3NyYy9zdG9yYWdlLmpzIiwid2VicGFjazovL3RvZG8tbGlzdC8uL3NyYy9tYW5hZ2VQcm9qZWN0LmpzIiwid2VicGFjazovL3RvZG8tbGlzdC8uL25vZGVfbW9kdWxlcy9kYXRlLWZucy90b0RhdGUubWpzIiwid2VicGFjazovL3RvZG8tbGlzdC8uL25vZGVfbW9kdWxlcy9kYXRlLWZucy9zdGFydE9mRGF5Lm1qcyIsIndlYnBhY2s6Ly90b2RvLWxpc3QvLi9ub2RlX21vZHVsZXMvZGF0ZS1mbnMvaXNUb2RheS5tanMiLCJ3ZWJwYWNrOi8vdG9kby1saXN0Ly4vbm9kZV9tb2R1bGVzL2RhdGUtZm5zL2lzU2FtZURheS5tanMiLCJ3ZWJwYWNrOi8vdG9kby1saXN0Ly4vbm9kZV9tb2R1bGVzL2RhdGUtZm5zL19saWIvZGVmYXVsdE9wdGlvbnMubWpzIiwid2VicGFjazovL3RvZG8tbGlzdC8uL25vZGVfbW9kdWxlcy9kYXRlLWZucy9zdGFydE9mV2Vlay5tanMiLCJ3ZWJwYWNrOi8vdG9kby1saXN0Ly4vbm9kZV9tb2R1bGVzL2RhdGUtZm5zL2lzVGhpc1dlZWsubWpzIiwid2VicGFjazovL3RvZG8tbGlzdC8uL25vZGVfbW9kdWxlcy9kYXRlLWZucy9pc1NhbWVXZWVrLm1qcyIsIndlYnBhY2s6Ly90b2RvLWxpc3QvLi9zcmMvVUkuanMiLCJ3ZWJwYWNrOi8vdG9kby1saXN0Ly4vc3JjL21hbmFnZVRhc2suanMiLCJ3ZWJwYWNrOi8vdG9kby1saXN0Ly4vc3JjL2luZGV4LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IEFkZHRvTGlzdCA9ICgoKSA9PiB7XG4gICAgbGV0IFRvZG9MaXN0ID0gW107XG5cbiAgICBmdW5jdGlvbiBhZGRUb0xpc3QodGFzaykge1xuICAgICAgICBUb2RvTGlzdC5wdXNoKHRhc2spO1xuICAgICAgICBjb25zb2xlLmxvZyhUb2RvTGlzdCk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gcmVtb3ZlVGFzayhpZCkge1xuICAgICAgICByZXR1cm4gVG9kb0xpc3QgPSBUb2RvTGlzdC5maWx0ZXIodGFzayA9PiBpZCAhPT0gdGFzay5pZCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHsgYWRkVG9MaXN0LCBUb2RvTGlzdCwgcmVtb3ZlVGFzayB9O1xufSkoKVxuXG5cbmV4cG9ydCB7IEFkZHRvTGlzdCB9IiwiaW1wb3J0IHsgcHJvamVjdHMgfSBmcm9tIFwiLi9tYW5hZ2VQcm9qZWN0XCI7XG5pbXBvcnQgeyByZW5kZXJQcm9qZWN0LCByZW5kZXJUYXNrIH0gZnJvbSBcIi4vVUlcIjtcbmltcG9ydCB7IEFkZHRvTGlzdCB9IGZyb20gXCIuL21hbmFnZUxpc3RcIjtcblxuY29uc3Qgc3RvcmVMb2NhbCA9ICgoKSA9PiB7XG4gICAgZnVuY3Rpb24gc3RyaW5naWZ5KGl0ZW0pIHtcbiAgICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KGl0ZW0pO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHN0b3JlUHJvamVjdHMoKSB7XG4gICAgICAgIGNvbnN0IHByb2plY3RMaXN0ID0gcHJvamVjdHMuZ3JhYlByb2plY3RMaXN0KCk7XG4gICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdwcm9qZWN0Jywgc3RyaW5naWZ5KHByb2plY3RMaXN0KSk7XG4gICAgICAgIGNvbnNvbGUubG9nKEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3Byb2plY3QnKSkpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGxvYWRTdG9yYWdlKCkge1xuICAgICAgICBjb25zdCBuZXdMaXN0ID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgncHJvamVjdCcpKTtcblxuICAgICAgICBsZXQgZ2VuTGlzdCA9IG5ld0xpc3RbMF07XG4gICAgICAgIGdlbkxpc3QudGFza0xpc3QuZm9yRWFjaCh0YXNrID0+IHtcbiAgICAgICAgICAgIEFkZHRvTGlzdC5hZGRUb0xpc3QodGFzayk7XG4gICAgICAgICAgICByZW5kZXJUYXNrLnVwZGF0ZURpc3BsYXkodGFzay5wcm9qZWN0KVxuICAgICAgICB9KTtcblxuICAgICAgICBsZXQgbG9hZGVkUHJvamVjdHMgPSBuZXdMaXN0LmZpbHRlcihwcm9qZWN0ID0+IHByb2plY3QuaWQgIT09IDApO1xuICAgICAgICBsb2FkZWRQcm9qZWN0cy5mb3JFYWNoKHByb2plY3QgPT4ge1xuICAgICAgICAgICAgcHJvamVjdHMuYWRkVG9Qcm9qZWN0TGlzdChwcm9qZWN0KTtcbiAgICAgICAgICAgIHJlbmRlclByb2plY3QuZGlzcGxheVByb2plY3QocHJvamVjdCk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHJldHVybiB7IHN0b3JlUHJvamVjdHMsXG4gICAgICAgICAgICAgbG9hZFN0b3JhZ2UgfVxufSkoKTtcblxuZXhwb3J0IHtzdG9yZUxvY2FsfSIsImltcG9ydCB7IHJlbmRlclByb2plY3QgfSBmcm9tIFwiLi9VSVwiO1xuaW1wb3J0IHsgQWRkdG9MaXN0IH0gZnJvbSBcIi4vbWFuYWdlTGlzdFwiO1xuaW1wb3J0IHsgc3RvcmVMb2NhbCB9IGZyb20gXCIuL3N0b3JhZ2VcIjtcblxuY29uc3QgbmV3UHJvamVjdCA9ICh0aXRsZSwgdGFza0xpc3QsIGlkKSA9PiB7XG4gICAgcmV0dXJuIHsgdGl0bGUsIHRhc2tMaXN0LCBpZCB9O1xufVxuXG5jb25zdCBwcm9qZWN0cyA9ICgoKSA9PiB7XG4gICAgbGV0IHByb2plY3RUaXRsZVxuICAgIGxldCBwcm9qZWN0TGlzdCA9IFtdO1xuXG4gICAgbGV0IHRhc2tMaXN0ID0gQWRkdG9MaXN0LlRvZG9MaXN0O1xuXG4gICAgY29uc3QgZ2VuZXJhbExpc3QgPSBuZXdQcm9qZWN0KCdHZW5lcmFsJywgdGFza0xpc3QsIDApO1xuICAgIHByb2plY3RMaXN0LnB1c2goZ2VuZXJhbExpc3QpO1xuXG4gICAgbGV0IGN1cnJlbnRQcm9qZWN0ID0gMDtcblxuICAgIGZ1bmN0aW9uIHVwZGF0ZUdlbmVyYWxMaXN0KG5ld0xpc3QpIHtcbiAgICAgICAgZ2VuZXJhbExpc3QudGFza0xpc3QgPSBuZXdMaXN0XG4gICAgICAgIGNvbnNvbGUubG9nKGdlbmVyYWxMaXN0LnRhc2tMaXN0KVxuICAgICAgICByZXR1cm4gZ2VuZXJhbExpc3RcbiAgICB9XG5cbiAgICBmdW5jdGlvbiB1cGRhdGVQcm9qZWN0KGlkKSB7XG4gICAgICAgIGxldCB1cGRhdGUgPSBnZW5lcmFsTGlzdC50YXNrTGlzdC5maWx0ZXIodGFzayA9PiB0YXNrLnByb2plY3QgPT09IGlkKTtcbiAgICAgICAgY29uc29sZS5sb2codXBkYXRlKVxuICAgICAgICBpZiAoaWQgIT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiBwcm9qZWN0TGlzdC5maWx0ZXIocHJvamVjdCA9PiBwcm9qZWN0LmlkID09PSBpZClbMF0udGFza0xpc3QgPSB1cGRhdGVcbiAgICAgICAgfSBlbHNlIHJldHVybjtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBncmFiQ3VycmVudFByb2plY3RUYXNrcyhpZCkge1xuICAgICAgICBjb25zb2xlLmxvZyhwcm9qZWN0TGlzdC5maWx0ZXIocHJvamVjdCA9PiBwcm9qZWN0LmlkID09PSBpZClbMF0udGFza0xpc3QpXG4gICAgICAgIHJldHVybiBwcm9qZWN0TGlzdC5maWx0ZXIocHJvamVjdCA9PiBwcm9qZWN0LmlkID09PSBpZClbMF0udGFza0xpc3RcbiAgICB9XG5cbiAgICBmdW5jdGlvbiByZW1vdmVQcm9qZWN0KGlkKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdiZWZvcmUnLCBwcm9qZWN0TGlzdCk7XG4gICAgICAgIHByb2plY3RMaXN0ID0gcHJvamVjdExpc3QuZmlsdGVyKHByb2plY3QgPT4gcHJvamVjdC5pZCAhPT0gaWQpO1xuICAgICAgICBjb25zb2xlLmxvZygnYWZ0ZXInLCBwcm9qZWN0TGlzdCk7XG4gICAgICAgIHJldHVybiBwcm9qZWN0TGlzdFxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdyYWJDdXJyZW50UHJvamVjdCgpIHtcbiAgICAgICAgcmV0dXJuIGN1cnJlbnRQcm9qZWN0O1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdyYWJQcm9qZWN0TGlzdCgpIHtcbiAgICAgICAgcmV0dXJuIHByb2plY3RMaXN0O1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGNyZWF0ZVByb2plY3QoKSB7XG4gICAgICAgIHByb2plY3RUaXRsZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNwcm9qZWN0VGl0bGUnKS52YWx1ZTtcbiAgICAgICAgY29uc3QgcHJvamVjdElkID0gY3JlYXRlUHJvamVjdElkKClcbiAgICAgICAgY29uc3QgcHJvamVjdFRhc2tzID0gW107XG5cbiAgICAgICAgaWYgKHByb2plY3RUaXRsZSA9PT0gJycpIHJldHVyblxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IHByb2plY3QgPSBuZXdQcm9qZWN0KHByb2plY3RUaXRsZSwgcHJvamVjdFRhc2tzLCBwcm9qZWN0SWQpO1xuICAgICAgICAgICAgY29uc29sZS5sb2cocHJvamVjdCk7XG4gICAgICAgICAgICBhZGRUb1Byb2plY3RMaXN0KHByb2plY3QpO1xuICAgICAgICAgICAgc3RvcmVMb2NhbC5zdG9yZVByb2plY3RzKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjcmVhdGVQcm9qZWN0SWQoKSB7XG4gICAgICAgIGxldCBpZDtcbiAgICAgICAgaWYgKHByb2plY3RMaXN0Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIGlkID0gMDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBpZCA9IHByb2plY3RMaXN0W3Byb2plY3RMaXN0Lmxlbmd0aCAtIDFdLmlkICsgMTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGFkZFRvUHJvamVjdExpc3QocHJvamVjdCkge1xuICAgICAgICBwcm9qZWN0TGlzdC5wdXNoKHByb2plY3QpO1xuICAgICAgICBjb25zb2xlLmxvZyhwcm9qZWN0TGlzdCk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gcmVzZXQoKSB7XG4gICAgICAgIGxldCBwcm9qZWN0VGl0bGVWYWx1ZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNwcm9qZWN0VGl0bGUnKTtcbiAgICAgICAgcHJvamVjdFRpdGxlVmFsdWUudmFsdWUgPSAnJztcbiAgICAgICAgcHJvamVjdFRpdGxlID0gJyc7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gc3VibWl0UHJvamVjdCgpIHtcbiAgICAgICAgY29uc3QgY3JlYXRlUHJvamVjdEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNjcmVhdGVQcm9qZWN0Jyk7XG5cbiAgICAgICAgY3JlYXRlUHJvamVjdEJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNyZWF0ZVByb2plY3QoKTtcbiAgICAgICAgICAgIGlmIChwcm9qZWN0VGl0bGUgPT09ICcnKSByZXR1cm5cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGxldCBwcm9qZWN0ID0gcHJvamVjdExpc3RbcHJvamVjdExpc3QubGVuZ3RoIC0xXTtcblxuICAgICAgICAgICAgICAgIHJlbmRlclByb2plY3QuZGlzcGxheVByb2plY3QocHJvamVjdCk7XG4gICAgICAgICAgICAgICAgcmVzZXQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBncmFiUHJvamVjdElkKGUpIHtcbiAgICAgICAgbGV0IHByb2plY3RJZCA9IHBhcnNlSW50KGUudGFyZ2V0LmdldEF0dHJpYnV0ZSgnZGF0YS1wcm9qZWN0SWQnKSk7XG5cbiAgICAgICAgY3VycmVudFByb2plY3QgPSBwcm9qZWN0SWQ7XG5cbiAgICAgICAgcmV0dXJuIGN1cnJlbnRQcm9qZWN0O1xuICAgIH1cblxuICAgIHJldHVybiB7IHN1Ym1pdFByb2plY3QsXG4gICAgICAgICAgICAgZ3JhYlByb2plY3RJZCxcbiAgICAgICAgICAgICBncmFiQ3VycmVudFByb2plY3QsIFxuICAgICAgICAgICAgIGdyYWJQcm9qZWN0TGlzdCwgXG4gICAgICAgICAgICAgcHJvamVjdExpc3QsIFxuICAgICAgICAgICAgIHVwZGF0ZUdlbmVyYWxMaXN0LFxuICAgICAgICAgICAgIHVwZGF0ZVByb2plY3QsIFxuICAgICAgICAgICAgIGdyYWJDdXJyZW50UHJvamVjdFRhc2tzLCBcbiAgICAgICAgICAgICByZW1vdmVQcm9qZWN0LFxuICAgICAgICAgICAgIGFkZFRvUHJvamVjdExpc3QgfVxufSkoKVxuXG5leHBvcnQgeyBwcm9qZWN0cyB9XG5cbiIsIi8qKlxuICogQG5hbWUgdG9EYXRlXG4gKiBAY2F0ZWdvcnkgQ29tbW9uIEhlbHBlcnNcbiAqIEBzdW1tYXJ5IENvbnZlcnQgdGhlIGdpdmVuIGFyZ3VtZW50IHRvIGFuIGluc3RhbmNlIG9mIERhdGUuXG4gKlxuICogQGRlc2NyaXB0aW9uXG4gKiBDb252ZXJ0IHRoZSBnaXZlbiBhcmd1bWVudCB0byBhbiBpbnN0YW5jZSBvZiBEYXRlLlxuICpcbiAqIElmIHRoZSBhcmd1bWVudCBpcyBhbiBpbnN0YW5jZSBvZiBEYXRlLCB0aGUgZnVuY3Rpb24gcmV0dXJucyBpdHMgY2xvbmUuXG4gKlxuICogSWYgdGhlIGFyZ3VtZW50IGlzIGEgbnVtYmVyLCBpdCBpcyB0cmVhdGVkIGFzIGEgdGltZXN0YW1wLlxuICpcbiAqIElmIHRoZSBhcmd1bWVudCBpcyBub25lIG9mIHRoZSBhYm92ZSwgdGhlIGZ1bmN0aW9uIHJldHVybnMgSW52YWxpZCBEYXRlLlxuICpcbiAqICoqTm90ZSoqOiAqYWxsKiBEYXRlIGFyZ3VtZW50cyBwYXNzZWQgdG8gYW55ICpkYXRlLWZucyogZnVuY3Rpb24gaXMgcHJvY2Vzc2VkIGJ5IGB0b0RhdGVgLlxuICpcbiAqIEB0eXBlUGFyYW0gRGF0ZVR5cGUgLSBUaGUgYERhdGVgIHR5cGUsIHRoZSBmdW5jdGlvbiBvcGVyYXRlcyBvbi4gR2V0cyBpbmZlcnJlZCBmcm9tIHBhc3NlZCBhcmd1bWVudHMuIEFsbG93cyB0byB1c2UgZXh0ZW5zaW9ucyBsaWtlIFtgVVRDRGF0ZWBdKGh0dHBzOi8vZ2l0aHViLmNvbS9kYXRlLWZucy91dGMpLlxuICpcbiAqIEBwYXJhbSBhcmd1bWVudCAtIFRoZSB2YWx1ZSB0byBjb252ZXJ0XG4gKlxuICogQHJldHVybnMgVGhlIHBhcnNlZCBkYXRlIGluIHRoZSBsb2NhbCB0aW1lIHpvbmVcbiAqXG4gKiBAZXhhbXBsZVxuICogLy8gQ2xvbmUgdGhlIGRhdGU6XG4gKiBjb25zdCByZXN1bHQgPSB0b0RhdGUobmV3IERhdGUoMjAxNCwgMSwgMTEsIDExLCAzMCwgMzApKVxuICogLy89PiBUdWUgRmViIDExIDIwMTQgMTE6MzA6MzBcbiAqXG4gKiBAZXhhbXBsZVxuICogLy8gQ29udmVydCB0aGUgdGltZXN0YW1wIHRvIGRhdGU6XG4gKiBjb25zdCByZXN1bHQgPSB0b0RhdGUoMTM5MjA5ODQzMDAwMClcbiAqIC8vPT4gVHVlIEZlYiAxMSAyMDE0IDExOjMwOjMwXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB0b0RhdGUoYXJndW1lbnQpIHtcbiAgY29uc3QgYXJnU3RyID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGFyZ3VtZW50KTtcblxuICAvLyBDbG9uZSB0aGUgZGF0ZVxuICBpZiAoXG4gICAgYXJndW1lbnQgaW5zdGFuY2VvZiBEYXRlIHx8XG4gICAgKHR5cGVvZiBhcmd1bWVudCA9PT0gXCJvYmplY3RcIiAmJiBhcmdTdHIgPT09IFwiW29iamVjdCBEYXRlXVwiKVxuICApIHtcbiAgICAvLyBQcmV2ZW50IHRoZSBkYXRlIHRvIGxvc2UgdGhlIG1pbGxpc2Vjb25kcyB3aGVuIHBhc3NlZCB0byBuZXcgRGF0ZSgpIGluIElFMTBcbiAgICByZXR1cm4gbmV3IGFyZ3VtZW50LmNvbnN0cnVjdG9yKCthcmd1bWVudCk7XG4gIH0gZWxzZSBpZiAoXG4gICAgdHlwZW9mIGFyZ3VtZW50ID09PSBcIm51bWJlclwiIHx8XG4gICAgYXJnU3RyID09PSBcIltvYmplY3QgTnVtYmVyXVwiIHx8XG4gICAgdHlwZW9mIGFyZ3VtZW50ID09PSBcInN0cmluZ1wiIHx8XG4gICAgYXJnU3RyID09PSBcIltvYmplY3QgU3RyaW5nXVwiXG4gICkge1xuICAgIC8vIFRPRE86IENhbiB3ZSBnZXQgcmlkIG9mIGFzP1xuICAgIHJldHVybiBuZXcgRGF0ZShhcmd1bWVudCk7XG4gIH0gZWxzZSB7XG4gICAgLy8gVE9ETzogQ2FuIHdlIGdldCByaWQgb2YgYXM/XG4gICAgcmV0dXJuIG5ldyBEYXRlKE5hTik7XG4gIH1cbn1cblxuLy8gRmFsbGJhY2sgZm9yIG1vZHVsYXJpemVkIGltcG9ydHM6XG5leHBvcnQgZGVmYXVsdCB0b0RhdGU7XG4iLCJpbXBvcnQgeyB0b0RhdGUgfSBmcm9tIFwiLi90b0RhdGUubWpzXCI7XG5cbi8qKlxuICogQG5hbWUgc3RhcnRPZkRheVxuICogQGNhdGVnb3J5IERheSBIZWxwZXJzXG4gKiBAc3VtbWFyeSBSZXR1cm4gdGhlIHN0YXJ0IG9mIGEgZGF5IGZvciB0aGUgZ2l2ZW4gZGF0ZS5cbiAqXG4gKiBAZGVzY3JpcHRpb25cbiAqIFJldHVybiB0aGUgc3RhcnQgb2YgYSBkYXkgZm9yIHRoZSBnaXZlbiBkYXRlLlxuICogVGhlIHJlc3VsdCB3aWxsIGJlIGluIHRoZSBsb2NhbCB0aW1lem9uZS5cbiAqXG4gKiBAdHlwZVBhcmFtIERhdGVUeXBlIC0gVGhlIGBEYXRlYCB0eXBlLCB0aGUgZnVuY3Rpb24gb3BlcmF0ZXMgb24uIEdldHMgaW5mZXJyZWQgZnJvbSBwYXNzZWQgYXJndW1lbnRzLiBBbGxvd3MgdG8gdXNlIGV4dGVuc2lvbnMgbGlrZSBbYFVUQ0RhdGVgXShodHRwczovL2dpdGh1Yi5jb20vZGF0ZS1mbnMvdXRjKS5cbiAqXG4gKiBAcGFyYW0gZGF0ZSAtIFRoZSBvcmlnaW5hbCBkYXRlXG4gKlxuICogQHJldHVybnMgVGhlIHN0YXJ0IG9mIGEgZGF5XG4gKlxuICogQGV4YW1wbGVcbiAqIC8vIFRoZSBzdGFydCBvZiBhIGRheSBmb3IgMiBTZXB0ZW1iZXIgMjAxNCAxMTo1NTowMDpcbiAqIGNvbnN0IHJlc3VsdCA9IHN0YXJ0T2ZEYXkobmV3IERhdGUoMjAxNCwgOCwgMiwgMTEsIDU1LCAwKSlcbiAqIC8vPT4gVHVlIFNlcCAwMiAyMDE0IDAwOjAwOjAwXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBzdGFydE9mRGF5KGRhdGUpIHtcbiAgY29uc3QgX2RhdGUgPSB0b0RhdGUoZGF0ZSk7XG4gIF9kYXRlLnNldEhvdXJzKDAsIDAsIDAsIDApO1xuICByZXR1cm4gX2RhdGU7XG59XG5cbi8vIEZhbGxiYWNrIGZvciBtb2R1bGFyaXplZCBpbXBvcnRzOlxuZXhwb3J0IGRlZmF1bHQgc3RhcnRPZkRheTtcbiIsImltcG9ydCB7IGlzU2FtZURheSB9IGZyb20gXCIuL2lzU2FtZURheS5tanNcIjtcblxuLyoqXG4gKiBAbmFtZSBpc1RvZGF5XG4gKiBAY2F0ZWdvcnkgRGF5IEhlbHBlcnNcbiAqIEBzdW1tYXJ5IElzIHRoZSBnaXZlbiBkYXRlIHRvZGF5P1xuICogQHB1cmUgZmFsc2VcbiAqXG4gKiBAZGVzY3JpcHRpb25cbiAqIElzIHRoZSBnaXZlbiBkYXRlIHRvZGF5P1xuICpcbiAqIEB0eXBlUGFyYW0gRGF0ZVR5cGUgLSBUaGUgYERhdGVgIHR5cGUsIHRoZSBmdW5jdGlvbiBvcGVyYXRlcyBvbi4gR2V0cyBpbmZlcnJlZCBmcm9tIHBhc3NlZCBhcmd1bWVudHMuIEFsbG93cyB0byB1c2UgZXh0ZW5zaW9ucyBsaWtlIFtgVVRDRGF0ZWBdKGh0dHBzOi8vZ2l0aHViLmNvbS9kYXRlLWZucy91dGMpLlxuICpcbiAqIEBwYXJhbSBkYXRlIC0gVGhlIGRhdGUgdG8gY2hlY2tcbiAqXG4gKiBAcmV0dXJucyBUaGUgZGF0ZSBpcyB0b2RheVxuICpcbiAqIEBleGFtcGxlXG4gKiAvLyBJZiB0b2RheSBpcyA2IE9jdG9iZXIgMjAxNCwgaXMgNiBPY3RvYmVyIDE0OjAwOjAwIHRvZGF5P1xuICogY29uc3QgcmVzdWx0ID0gaXNUb2RheShuZXcgRGF0ZSgyMDE0LCA5LCA2LCAxNCwgMCkpXG4gKiAvLz0+IHRydWVcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGlzVG9kYXkoZGF0ZSkge1xuICByZXR1cm4gaXNTYW1lRGF5KGRhdGUsIERhdGUubm93KCkpO1xufVxuXG4vLyBGYWxsYmFjayBmb3IgbW9kdWxhcml6ZWQgaW1wb3J0czpcbmV4cG9ydCBkZWZhdWx0IGlzVG9kYXk7XG4iLCJpbXBvcnQgeyBzdGFydE9mRGF5IH0gZnJvbSBcIi4vc3RhcnRPZkRheS5tanNcIjtcblxuLyoqXG4gKiBAbmFtZSBpc1NhbWVEYXlcbiAqIEBjYXRlZ29yeSBEYXkgSGVscGVyc1xuICogQHN1bW1hcnkgQXJlIHRoZSBnaXZlbiBkYXRlcyBpbiB0aGUgc2FtZSBkYXkgKGFuZCB5ZWFyIGFuZCBtb250aCk/XG4gKlxuICogQGRlc2NyaXB0aW9uXG4gKiBBcmUgdGhlIGdpdmVuIGRhdGVzIGluIHRoZSBzYW1lIGRheSAoYW5kIHllYXIgYW5kIG1vbnRoKT9cbiAqXG4gKiBAdHlwZVBhcmFtIERhdGVUeXBlIC0gVGhlIGBEYXRlYCB0eXBlLCB0aGUgZnVuY3Rpb24gb3BlcmF0ZXMgb24uIEdldHMgaW5mZXJyZWQgZnJvbSBwYXNzZWQgYXJndW1lbnRzLiBBbGxvd3MgdG8gdXNlIGV4dGVuc2lvbnMgbGlrZSBbYFVUQ0RhdGVgXShodHRwczovL2dpdGh1Yi5jb20vZGF0ZS1mbnMvdXRjKS5cbiAqXG4gKiBAcGFyYW0gZGF0ZUxlZnQgLSBUaGUgZmlyc3QgZGF0ZSB0byBjaGVja1xuICogQHBhcmFtIGRhdGVSaWdodCAtIFRoZSBzZWNvbmQgZGF0ZSB0byBjaGVja1xuXG4gKiBAcmV0dXJucyBUaGUgZGF0ZXMgYXJlIGluIHRoZSBzYW1lIGRheSAoYW5kIHllYXIgYW5kIG1vbnRoKVxuICpcbiAqIEBleGFtcGxlXG4gKiAvLyBBcmUgNCBTZXB0ZW1iZXIgMDY6MDA6MDAgYW5kIDQgU2VwdGVtYmVyIDE4OjAwOjAwIGluIHRoZSBzYW1lIGRheT9cbiAqIGNvbnN0IHJlc3VsdCA9IGlzU2FtZURheShuZXcgRGF0ZSgyMDE0LCA4LCA0LCA2LCAwKSwgbmV3IERhdGUoMjAxNCwgOCwgNCwgMTgsIDApKVxuICogLy89PiB0cnVlXG4gKlxuICogQGV4YW1wbGVcbiAqIC8vIEFyZSA0IFNlcHRlbWJlciBhbmQgNCBPY3RvYmVyIGluIHRoZSBzYW1lIGRheT9cbiAqIGNvbnN0IHJlc3VsdCA9IGlzU2FtZURheShuZXcgRGF0ZSgyMDE0LCA4LCA0KSwgbmV3IERhdGUoMjAxNCwgOSwgNCkpXG4gKiAvLz0+IGZhbHNlXG4gKlxuICogQGV4YW1wbGVcbiAqIC8vIEFyZSA0IFNlcHRlbWJlciwgMjAxNCBhbmQgNCBTZXB0ZW1iZXIsIDIwMTUgaW4gdGhlIHNhbWUgZGF5P1xuICogY29uc3QgcmVzdWx0ID0gaXNTYW1lRGF5KG5ldyBEYXRlKDIwMTQsIDgsIDQpLCBuZXcgRGF0ZSgyMDE1LCA4LCA0KSlcbiAqIC8vPT4gZmFsc2VcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGlzU2FtZURheShkYXRlTGVmdCwgZGF0ZVJpZ2h0KSB7XG4gIGNvbnN0IGRhdGVMZWZ0U3RhcnRPZkRheSA9IHN0YXJ0T2ZEYXkoZGF0ZUxlZnQpO1xuICBjb25zdCBkYXRlUmlnaHRTdGFydE9mRGF5ID0gc3RhcnRPZkRheShkYXRlUmlnaHQpO1xuXG4gIHJldHVybiArZGF0ZUxlZnRTdGFydE9mRGF5ID09PSArZGF0ZVJpZ2h0U3RhcnRPZkRheTtcbn1cblxuLy8gRmFsbGJhY2sgZm9yIG1vZHVsYXJpemVkIGltcG9ydHM6XG5leHBvcnQgZGVmYXVsdCBpc1NhbWVEYXk7XG4iLCJsZXQgZGVmYXVsdE9wdGlvbnMgPSB7fTtcblxuZXhwb3J0IGZ1bmN0aW9uIGdldERlZmF1bHRPcHRpb25zKCkge1xuICByZXR1cm4gZGVmYXVsdE9wdGlvbnM7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzZXREZWZhdWx0T3B0aW9ucyhuZXdPcHRpb25zKSB7XG4gIGRlZmF1bHRPcHRpb25zID0gbmV3T3B0aW9ucztcbn1cbiIsImltcG9ydCB7IHRvRGF0ZSB9IGZyb20gXCIuL3RvRGF0ZS5tanNcIjtcbmltcG9ydCB7IGdldERlZmF1bHRPcHRpb25zIH0gZnJvbSBcIi4vX2xpYi9kZWZhdWx0T3B0aW9ucy5tanNcIjtcblxuLyoqXG4gKiBUaGUge0BsaW5rIHN0YXJ0T2ZXZWVrfSBmdW5jdGlvbiBvcHRpb25zLlxuICovXG5cbi8qKlxuICogQG5hbWUgc3RhcnRPZldlZWtcbiAqIEBjYXRlZ29yeSBXZWVrIEhlbHBlcnNcbiAqIEBzdW1tYXJ5IFJldHVybiB0aGUgc3RhcnQgb2YgYSB3ZWVrIGZvciB0aGUgZ2l2ZW4gZGF0ZS5cbiAqXG4gKiBAZGVzY3JpcHRpb25cbiAqIFJldHVybiB0aGUgc3RhcnQgb2YgYSB3ZWVrIGZvciB0aGUgZ2l2ZW4gZGF0ZS5cbiAqIFRoZSByZXN1bHQgd2lsbCBiZSBpbiB0aGUgbG9jYWwgdGltZXpvbmUuXG4gKlxuICogQHR5cGVQYXJhbSBEYXRlVHlwZSAtIFRoZSBgRGF0ZWAgdHlwZSwgdGhlIGZ1bmN0aW9uIG9wZXJhdGVzIG9uLiBHZXRzIGluZmVycmVkIGZyb20gcGFzc2VkIGFyZ3VtZW50cy4gQWxsb3dzIHRvIHVzZSBleHRlbnNpb25zIGxpa2UgW2BVVENEYXRlYF0oaHR0cHM6Ly9naXRodWIuY29tL2RhdGUtZm5zL3V0YykuXG4gKlxuICogQHBhcmFtIGRhdGUgLSBUaGUgb3JpZ2luYWwgZGF0ZVxuICogQHBhcmFtIG9wdGlvbnMgLSBBbiBvYmplY3Qgd2l0aCBvcHRpb25zXG4gKlxuICogQHJldHVybnMgVGhlIHN0YXJ0IG9mIGEgd2Vla1xuICpcbiAqIEBleGFtcGxlXG4gKiAvLyBUaGUgc3RhcnQgb2YgYSB3ZWVrIGZvciAyIFNlcHRlbWJlciAyMDE0IDExOjU1OjAwOlxuICogY29uc3QgcmVzdWx0ID0gc3RhcnRPZldlZWsobmV3IERhdGUoMjAxNCwgOCwgMiwgMTEsIDU1LCAwKSlcbiAqIC8vPT4gU3VuIEF1ZyAzMSAyMDE0IDAwOjAwOjAwXG4gKlxuICogQGV4YW1wbGVcbiAqIC8vIElmIHRoZSB3ZWVrIHN0YXJ0cyBvbiBNb25kYXksIHRoZSBzdGFydCBvZiB0aGUgd2VlayBmb3IgMiBTZXB0ZW1iZXIgMjAxNCAxMTo1NTowMDpcbiAqIGNvbnN0IHJlc3VsdCA9IHN0YXJ0T2ZXZWVrKG5ldyBEYXRlKDIwMTQsIDgsIDIsIDExLCA1NSwgMCksIHsgd2Vla1N0YXJ0c09uOiAxIH0pXG4gKiAvLz0+IE1vbiBTZXAgMDEgMjAxNCAwMDowMDowMFxuICovXG5leHBvcnQgZnVuY3Rpb24gc3RhcnRPZldlZWsoZGF0ZSwgb3B0aW9ucykge1xuICBjb25zdCBkZWZhdWx0T3B0aW9ucyA9IGdldERlZmF1bHRPcHRpb25zKCk7XG4gIGNvbnN0IHdlZWtTdGFydHNPbiA9XG4gICAgb3B0aW9ucz8ud2Vla1N0YXJ0c09uID8/XG4gICAgb3B0aW9ucz8ubG9jYWxlPy5vcHRpb25zPy53ZWVrU3RhcnRzT24gPz9cbiAgICBkZWZhdWx0T3B0aW9ucy53ZWVrU3RhcnRzT24gPz9cbiAgICBkZWZhdWx0T3B0aW9ucy5sb2NhbGU/Lm9wdGlvbnM/LndlZWtTdGFydHNPbiA/P1xuICAgIDA7XG5cbiAgY29uc3QgX2RhdGUgPSB0b0RhdGUoZGF0ZSk7XG4gIGNvbnN0IGRheSA9IF9kYXRlLmdldERheSgpO1xuICBjb25zdCBkaWZmID0gKGRheSA8IHdlZWtTdGFydHNPbiA/IDcgOiAwKSArIGRheSAtIHdlZWtTdGFydHNPbjtcblxuICBfZGF0ZS5zZXREYXRlKF9kYXRlLmdldERhdGUoKSAtIGRpZmYpO1xuICBfZGF0ZS5zZXRIb3VycygwLCAwLCAwLCAwKTtcbiAgcmV0dXJuIF9kYXRlO1xufVxuXG4vLyBGYWxsYmFjayBmb3IgbW9kdWxhcml6ZWQgaW1wb3J0czpcbmV4cG9ydCBkZWZhdWx0IHN0YXJ0T2ZXZWVrO1xuIiwiaW1wb3J0IHsgaXNTYW1lV2VlayB9IGZyb20gXCIuL2lzU2FtZVdlZWsubWpzXCI7XG5cbi8qKlxuICogVGhlIHtAbGluayBpc1RoaXNXZWVrfSBmdW5jdGlvbiBvcHRpb25zLlxuICovXG5cbi8qKlxuICogQG5hbWUgaXNUaGlzV2Vla1xuICogQGNhdGVnb3J5IFdlZWsgSGVscGVyc1xuICogQHN1bW1hcnkgSXMgdGhlIGdpdmVuIGRhdGUgaW4gdGhlIHNhbWUgd2VlayBhcyB0aGUgY3VycmVudCBkYXRlP1xuICogQHB1cmUgZmFsc2VcbiAqXG4gKiBAZGVzY3JpcHRpb25cbiAqIElzIHRoZSBnaXZlbiBkYXRlIGluIHRoZSBzYW1lIHdlZWsgYXMgdGhlIGN1cnJlbnQgZGF0ZT9cbiAqXG4gKiBAdHlwZVBhcmFtIERhdGVUeXBlIC0gVGhlIGBEYXRlYCB0eXBlLCB0aGUgZnVuY3Rpb24gb3BlcmF0ZXMgb24uIEdldHMgaW5mZXJyZWQgZnJvbSBwYXNzZWQgYXJndW1lbnRzLiBBbGxvd3MgdG8gdXNlIGV4dGVuc2lvbnMgbGlrZSBbYFVUQ0RhdGVgXShodHRwczovL2dpdGh1Yi5jb20vZGF0ZS1mbnMvdXRjKS5cbiAqXG4gKiBAcGFyYW0gZGF0ZSAtIFRoZSBkYXRlIHRvIGNoZWNrXG4gKiBAcGFyYW0gb3B0aW9ucyAtIFRoZSBvYmplY3Qgd2l0aCBvcHRpb25zXG4gKlxuICogQHJldHVybnMgVGhlIGRhdGUgaXMgaW4gdGhpcyB3ZWVrXG4gKlxuICogQGV4YW1wbGVcbiAqIC8vIElmIHRvZGF5IGlzIDI1IFNlcHRlbWJlciAyMDE0LCBpcyAyMSBTZXB0ZW1iZXIgMjAxNCBpbiB0aGlzIHdlZWs/XG4gKiBjb25zdCByZXN1bHQgPSBpc1RoaXNXZWVrKG5ldyBEYXRlKDIwMTQsIDgsIDIxKSlcbiAqIC8vPT4gdHJ1ZVxuICpcbiAqIEBleGFtcGxlXG4gKiAvLyBJZiB0b2RheSBpcyAyNSBTZXB0ZW1iZXIgMjAxNCBhbmQgd2VlayBzdGFydHMgd2l0aCBNb25kYXlcbiAqIC8vIGlzIDIxIFNlcHRlbWJlciAyMDE0IGluIHRoaXMgd2Vlaz9cbiAqIGNvbnN0IHJlc3VsdCA9IGlzVGhpc1dlZWsobmV3IERhdGUoMjAxNCwgOCwgMjEpLCB7IHdlZWtTdGFydHNPbjogMSB9KVxuICogLy89PiBmYWxzZVxuICovXG5leHBvcnQgZnVuY3Rpb24gaXNUaGlzV2VlayhkYXRlLCBvcHRpb25zKSB7XG4gIHJldHVybiBpc1NhbWVXZWVrKGRhdGUsIERhdGUubm93KCksIG9wdGlvbnMpO1xufVxuXG4vLyBGYWxsYmFjayBmb3IgbW9kdWxhcml6ZWQgaW1wb3J0czpcbmV4cG9ydCBkZWZhdWx0IGlzVGhpc1dlZWs7XG4iLCJpbXBvcnQgeyBzdGFydE9mV2VlayB9IGZyb20gXCIuL3N0YXJ0T2ZXZWVrLm1qc1wiO1xuXG4vKipcbiAqIFRoZSB7QGxpbmsgaXNTYW1lV2Vla30gZnVuY3Rpb24gb3B0aW9ucy5cbiAqL1xuXG4vKipcbiAqIEBuYW1lIGlzU2FtZVdlZWtcbiAqIEBjYXRlZ29yeSBXZWVrIEhlbHBlcnNcbiAqIEBzdW1tYXJ5IEFyZSB0aGUgZ2l2ZW4gZGF0ZXMgaW4gdGhlIHNhbWUgd2VlayAoYW5kIG1vbnRoIGFuZCB5ZWFyKT9cbiAqXG4gKiBAZGVzY3JpcHRpb25cbiAqIEFyZSB0aGUgZ2l2ZW4gZGF0ZXMgaW4gdGhlIHNhbWUgd2VlayAoYW5kIG1vbnRoIGFuZCB5ZWFyKT9cbiAqXG4gKiBAdHlwZVBhcmFtIERhdGVUeXBlIC0gVGhlIGBEYXRlYCB0eXBlLCB0aGUgZnVuY3Rpb24gb3BlcmF0ZXMgb24uIEdldHMgaW5mZXJyZWQgZnJvbSBwYXNzZWQgYXJndW1lbnRzLiBBbGxvd3MgdG8gdXNlIGV4dGVuc2lvbnMgbGlrZSBbYFVUQ0RhdGVgXShodHRwczovL2dpdGh1Yi5jb20vZGF0ZS1mbnMvdXRjKS5cbiAqXG4gKiBAcGFyYW0gZGF0ZUxlZnQgLSBUaGUgZmlyc3QgZGF0ZSB0byBjaGVja1xuICogQHBhcmFtIGRhdGVSaWdodCAtIFRoZSBzZWNvbmQgZGF0ZSB0byBjaGVja1xuICogQHBhcmFtIG9wdGlvbnMgLSBBbiBvYmplY3Qgd2l0aCBvcHRpb25zXG4gKlxuICogQHJldHVybnMgVGhlIGRhdGVzIGFyZSBpbiB0aGUgc2FtZSB3ZWVrIChhbmQgbW9udGggYW5kIHllYXIpXG4gKlxuICogQGV4YW1wbGVcbiAqIC8vIEFyZSAzMSBBdWd1c3QgMjAxNCBhbmQgNCBTZXB0ZW1iZXIgMjAxNCBpbiB0aGUgc2FtZSB3ZWVrP1xuICogY29uc3QgcmVzdWx0ID0gaXNTYW1lV2VlayhuZXcgRGF0ZSgyMDE0LCA3LCAzMSksIG5ldyBEYXRlKDIwMTQsIDgsIDQpKVxuICogLy89PiB0cnVlXG4gKlxuICogQGV4YW1wbGVcbiAqIC8vIElmIHdlZWsgc3RhcnRzIHdpdGggTW9uZGF5LFxuICogLy8gYXJlIDMxIEF1Z3VzdCAyMDE0IGFuZCA0IFNlcHRlbWJlciAyMDE0IGluIHRoZSBzYW1lIHdlZWs/XG4gKiBjb25zdCByZXN1bHQgPSBpc1NhbWVXZWVrKG5ldyBEYXRlKDIwMTQsIDcsIDMxKSwgbmV3IERhdGUoMjAxNCwgOCwgNCksIHtcbiAqICAgd2Vla1N0YXJ0c09uOiAxXG4gKiB9KVxuICogLy89PiBmYWxzZVxuICpcbiAqIEBleGFtcGxlXG4gKiAvLyBBcmUgMSBKYW51YXJ5IDIwMTQgYW5kIDEgSmFudWFyeSAyMDE1IGluIHRoZSBzYW1lIHdlZWs/XG4gKiBjb25zdCByZXN1bHQgPSBpc1NhbWVXZWVrKG5ldyBEYXRlKDIwMTQsIDAsIDEpLCBuZXcgRGF0ZSgyMDE1LCAwLCAxKSlcbiAqIC8vPT4gZmFsc2VcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGlzU2FtZVdlZWsoZGF0ZUxlZnQsIGRhdGVSaWdodCwgb3B0aW9ucykge1xuICBjb25zdCBkYXRlTGVmdFN0YXJ0T2ZXZWVrID0gc3RhcnRPZldlZWsoZGF0ZUxlZnQsIG9wdGlvbnMpO1xuICBjb25zdCBkYXRlUmlnaHRTdGFydE9mV2VlayA9IHN0YXJ0T2ZXZWVrKGRhdGVSaWdodCwgb3B0aW9ucyk7XG5cbiAgcmV0dXJuICtkYXRlTGVmdFN0YXJ0T2ZXZWVrID09PSArZGF0ZVJpZ2h0U3RhcnRPZldlZWs7XG59XG5cbi8vIEZhbGxiYWNrIGZvciBtb2R1bGFyaXplZCBpbXBvcnRzOlxuZXhwb3J0IGRlZmF1bHQgaXNTYW1lV2VlaztcbiIsImltcG9ydCB7IHByb2plY3RzIH0gZnJvbSBcIi4vbWFuYWdlUHJvamVjdFwiO1xuaW1wb3J0IHsgaXNUb2RheSwgdG9EYXRlLCBpc1RoaXNXZWVrIH0gZnJvbSBcImRhdGUtZm5zXCI7XG5pbXBvcnQgeyBBZGR0b0xpc3QgfSBmcm9tIFwiLi9tYW5hZ2VMaXN0XCI7XG5pbXBvcnQgeyBzdG9yZUxvY2FsIH0gZnJvbSBcIi4vc3RvcmFnZVwiO1xuXG5jb25zdCByZW5kZXJUYXNrID0gKCgpID0+IHtcbiAgICBmdW5jdGlvbiBkaXNwbGF5QWxsVGFzayhpdGVtcywgZGlzcGxheSkge1xuICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcblxuICAgICAgICBjb250YWluZXIuc2V0QXR0cmlidXRlKCdkYXRhLXRhc2tJZCcsIGAke2l0ZW1zLmlkfWApXG5cbiAgICAgICAgY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ3Rhc2snKTtcblxuICAgICAgICBjb25zdCB0aXRsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpXG4gICAgICAgIGNvbnN0IGR1ZWRhdGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgY29uc3QgZGV0YWlscyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICBjb25zdCBwcmlvcml0eSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICBjb25zdCBkZWxldGVCdG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTtcbiAgICAgICAgY29uc3QgZWRpdEJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpO1xuICAgICAgICBjb25zdCBjaGVja2JveCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7XG4gICAgICAgIGNvbnN0IGxhYmVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGFiZWwnKTtcblxuICAgICAgICB0aXRsZS50ZXh0Q29udGVudCA9IGBUaXRsZTogJHtpdGVtcy50aXRsZX1gO1xuICAgICAgICBkdWVkYXRlLnRleHRDb250ZW50ID0gYER1ZSBEYXRlOiAke2l0ZW1zLmR1ZWRhdGV9YDtcbiAgICAgICAgZGV0YWlscy50ZXh0Q29udGVudCA9IGBEZXRhaWxzOiAke2l0ZW1zLmRldGFpbHN9YDtcbiAgICAgICAgcHJpb3JpdHkudGV4dENvbnRlbnQgPSBgUHJpb3JpdHk6ICR7aXRlbXMucHJpb3JpdHl9YDtcbiAgICAgICAgZGVsZXRlQnRuLnRleHRDb250ZW50ID0gJ2RlbGV0ZSc7XG4gICAgICAgIGVkaXRCdG4udGV4dENvbnRlbnQgPSAnZWRpdCc7XG4gICAgICAgIGxhYmVsLnRleHRDb250ZW50ID0gJ0RvbmU/JztcblxuICAgICAgICBjaGVja2JveC5zZXRBdHRyaWJ1dGUoJ3R5cGUnLCAnY2hlY2tib3gnKTtcbiAgICAgICAgY2hlY2tib3guc2V0QXR0cmlidXRlKCdpZCcsIGBzdGF0dXMtJHtpdGVtcy5pZH1gKTtcbiAgICAgICAgY2hlY2tib3guc2V0QXR0cmlidXRlKCduYW1lJywgJ3N0YXR1cycpO1xuICAgICAgICBjaGVja2JveC5zZXRBdHRyaWJ1dGUoJ3ZhbHVlJywgJ29mZicpO1xuICAgICAgICBsYWJlbC5zZXRBdHRyaWJ1dGUoJ2ZvcicsIGBzdGF0dXMtJHtpdGVtcy5pZH1gKTtcbiAgICAgICAgZGVsZXRlQnRuLnNldEF0dHJpYnV0ZSgnZGF0YS10YXNrSWQnLCBgJHtpdGVtcy5pZH1gKTtcbiAgICAgICAgXG5cbiAgICAgICAgY2hlY2tib3guYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgICAgICAgICBpZiAoY2hlY2tib3gudmFsdWUgPT09ICdvZmYnKSB7aW5pdENoZWNrYm94T24oaXRlbXMsIGNoZWNrYm94LCBsYWJlbCwgZWRpdEJ0biwgY29udGFpbmVyKX1cbiAgICAgICAgICAgIGVsc2Uge2luaXRDaGVja2JveE9mZihpdGVtcywgY2hlY2tib3gsIGxhYmVsLCBlZGl0QnRuLCBjb250YWluZXIpfTtcbiAgICAgICAgXG4gICAgICAgICAgICBzdG9yZUxvY2FsLnN0b3JlUHJvamVjdHMoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgZGVsZXRlQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gaW5pdERlbEJ0bihpdGVtcy5pZCwgaXRlbXMucHJvamVjdCkpO1xuICAgICAgICBlZGl0QnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge2luaXRFZGl0QnRuKGl0ZW1zKX0pO1xuXG4gICAgICAgIGlmIChpdGVtcy5zdGF0dXMgPT09ICdmaW5pc2hlZCcpIHtcbiAgICAgICAgICAgIGNoZWNrYm94LnNldEF0dHJpYnV0ZSgnY2hlY2tlZCcsJycpO1xuICAgICAgICAgICAgaW5pdENoZWNrYm94T24oaXRlbXMsIGNoZWNrYm94LCBsYWJlbCwgZWRpdEJ0biwgY29udGFpbmVyKTtcbiAgICAgICAgfTtcblxuICAgICAgICBjb250YWluZXIuYXBwZW5kKHRpdGxlLCBkdWVkYXRlLCBkZXRhaWxzLCBwcmlvcml0eSwgZGVsZXRlQnRuLCBlZGl0QnRuLCBsYWJlbCwgY2hlY2tib3gpO1xuICAgICAgICBkaXNwbGF5LmFwcGVuZENoaWxkKGNvbnRhaW5lcik7XG5cbiAgICAgICAgcmV0dXJuIGRpc3BsYXk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gaW5pdENoZWNrYm94T24oaXRlbXMsIGNoZWNrYm94LCBsYWJlbCwgZWRpdEJ0biwgY29udGFpbmVyKSB7XG4gICAgICAgICAgICBsYWJlbC50ZXh0Q29udGVudCA9ICdEb25lISc7XG4gICAgICAgICAgICBjaGVja2JveC52YWx1ZSA9ICdvbic7XG4gICAgICAgICAgICBlZGl0QnRuLnNldEF0dHJpYnV0ZSgnZGlzYWJsZWQnLCAnJyk7XG4gICAgICAgICAgICBpdGVtcy5zdGF0dXMgPSAnZmluaXNoZWQnO1xuICAgICAgICAgICAgY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ2ZpbmlzaGVkJyk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gaW5pdENoZWNrYm94T2ZmKGl0ZW1zLCBjaGVja2JveCwgbGFiZWwsIGVkaXRCdG4sIGNvbnRhaW5lcikge1xuICAgICAgICBsYWJlbC50ZXh0Q29udGVudCA9ICdEb25lPyc7XG4gICAgICAgIGNoZWNrYm94LnZhbHVlID0gJ29mZic7XG4gICAgICAgIGVkaXRCdG4ucmVtb3ZlQXR0cmlidXRlKCdkaXNhYmxlZCcpO1xuICAgICAgICBpdGVtcy5zdGF0dXMgPSAndW5maW5pc2hlZCc7XG4gICAgICAgIGNvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKCdmaW5pc2hlZCcpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGluaXRFZGl0QnRuKHRhc2spIHtcbiAgICAgICAgY29uc3QgdGFza0Zvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjbWFpbi1mb3JtJyk7XG5cbiAgICAgICAgdGFza0Zvcm0uY2xhc3NMaXN0LmFkZCgnZWRpdC1tb2RlJyk7XG4gICAgICAgIHRhc2tGb3JtLnNldEF0dHJpYnV0ZSgnZGF0YS10YXNrSWQnLCBgJHt0YXNrLmlkfWApO1xuXG4gICAgICAgIGxldCB0aXRsZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0aXRsZScpO1xuICAgICAgICBsZXQgZGV0YWlscyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkZXRhaWxzJyk7XG4gICAgICAgIGxldCBkYXRlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RhdGUnKTtcbiAgICAgICAgbGV0IHByaW9yaXR5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ByaW9yaXR5Jyk7XG5cbiAgICAgICAgY29uc3QgdGFza1RpdGxlID0gdGFzay50aXRsZTtcbiAgICAgICAgY29uc3QgdGFza0RldGFpbHMgPSB0YXNrLmRldGFpbHM7XG4gICAgICAgIGNvbnN0IHRhc2tEYXRlID0gdGFzay5kdWVkYXRlO1xuICAgICAgICBjb25zdCB0YXNrUHJpb3JpdHkgPSB0YXNrLnByaW9yaXR5O1xuXG4gICAgICAgIHRpdGxlLnZhbHVlID0gdGFza1RpdGxlO1xuICAgICAgICBkZXRhaWxzLnZhbHVlID0gdGFza0RldGFpbHM7XG4gICAgICAgIGRhdGUudmFsdWUgPSB0YXNrRGF0ZTtcbiAgICAgICAgcHJpb3JpdHkudmFsdWUgPSB0YXNrUHJpb3JpdHk7XG5cbiAgICAgICAgdGFza0Zvcm0ucmVtb3ZlQXR0cmlidXRlKCdoaWRkZW4nKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBpbml0RGVsQnRuKGlkLCBwcm9qZWN0SWQpIHtcbiAgICAgICAgbGV0IEFsbHRhc2sgPSBBZGR0b0xpc3QucmVtb3ZlVGFzayhpZCk7XG4gICAgICAgIGNvbnN0IGdlbmVyYWxMaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2dlbmVyYWwnKTtcblxuICAgICAgICBwcm9qZWN0cy51cGRhdGVHZW5lcmFsTGlzdChBbGx0YXNrKTtcbiAgICAgICAgcHJvamVjdHMudXBkYXRlUHJvamVjdChwcm9qZWN0SWQpO1xuICAgICAgICBzdG9yZUxvY2FsLnN0b3JlUHJvamVjdHMoKTtcblxuICAgICAgICB3aGlsZSAoZ2VuZXJhbExpc3QubGFzdEVsZW1lbnRDaGlsZCkgZ2VuZXJhbExpc3QucmVtb3ZlQ2hpbGQoZ2VuZXJhbExpc3QubGFzdEVsZW1lbnRDaGlsZCk7XG4gICAgICAgIFxuICAgICAgICB1cGRhdGVEaXNwbGF5KHByb2plY3RJZCk7XG5cbiAgICAgICAgY29uc29sZS5sb2cocHJvamVjdHMucHJvamVjdExpc3QpO1xuICAgICAgICBjb25zb2xlLmxvZyhwcm9qZWN0SWQpXG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZ3JhYlRhYigpIHtcbiAgICAgICAgbGV0IGN1cnJlbnRUYWIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjZ2VuZXJhbCcpLmdldEF0dHJpYnV0ZSgnY2xhc3MnKTtcbiAgICAgICAgcmV0dXJuIGN1cnJlbnRUYWI7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gdXBkYXRlRGlzcGxheShpZCkge1xuICAgICAgICBsZXQgdGFiID0gZ3JhYlRhYigpO1xuICAgICAgICBpZiAodGFiID09PSAnaW5ib3hUYWInKSBkaXNwbGF5SW5ib3goKVxuICAgICAgICBlbHNlIGlmICh0YWIgPT09ICd0b2RheVRhYicpIGRpc3BsYXlEYWlseSgpXG4gICAgICAgIGVsc2UgaWYgKHRhYiA9PT0gJ3dlZWtUYWInKSBkaXNwbGF5V2Vla2x5KClcbiAgICAgICAgZWxzZSBpZiAodGFiID09PSBgJHtpZH1gICYmIGlkICE9PSAwKSByZW5kZXJQcm9qZWN0LmRpc3BsYXlQcm9qZWN0VGFza3MoaWQpXG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZGlzcGxheUluYm94KCkge1xuICAgICAgICBsZXQgbGlzdCA9IHByb2plY3RzLmdyYWJQcm9qZWN0TGlzdCgpWzBdLnRhc2tMaXN0O1xuICAgICAgICBjb25zdCBnZW5lcmFsTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNnZW5lcmFsJyk7XG4gICAgICAgIGdlbmVyYWxMaXN0LmNsYXNzTGlzdC5yZXBsYWNlKGdlbmVyYWxMaXN0LmdldEF0dHJpYnV0ZSgnY2xhc3MnKSwgJ2luYm94VGFiJyk7XG5cbiAgICAgICAgd2hpbGUgKGdlbmVyYWxMaXN0Lmxhc3RFbGVtZW50Q2hpbGQpIGdlbmVyYWxMaXN0LnJlbW92ZUNoaWxkKGdlbmVyYWxMaXN0Lmxhc3RFbGVtZW50Q2hpbGQpO1xuICAgICAgICBjb25zb2xlLmxvZyhsaXN0KVxuICAgICAgICBsaXN0LmZvckVhY2godGFzayA9PiBkaXNwbGF5QWxsVGFzayh0YXNrLCBnZW5lcmFsTGlzdCkpO1xuICAgICAgICBjb25zb2xlLmxvZyhwcm9qZWN0cy5wcm9qZWN0TGlzdClcbiAgICAgICAgXG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZGlzcGxheURhaWx5KCkge1xuICAgICAgICBsZXQgbGlzdCA9IHByb2plY3RzLmdyYWJQcm9qZWN0TGlzdCgpWzBdLnRhc2tMaXN0O1xuICAgICAgICBjb25zdCBnZW5lcmFsTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNnZW5lcmFsJyk7XG4gICAgICAgIGdlbmVyYWxMaXN0LmNsYXNzTGlzdC5yZXBsYWNlKGdlbmVyYWxMaXN0LmdldEF0dHJpYnV0ZSgnY2xhc3MnKSwgJ3RvZGF5VGFiJyk7XG5cbiAgICAgICAgd2hpbGUgKGdlbmVyYWxMaXN0Lmxhc3RFbGVtZW50Q2hpbGQpIGdlbmVyYWxMaXN0LnJlbW92ZUNoaWxkKGdlbmVyYWxMaXN0Lmxhc3RFbGVtZW50Q2hpbGQpO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgZGFpbHlUYXNrcyA9IGxpc3QuZmlsdGVyKHRhc2sgPT4gaXNUb2RheSh0b0RhdGUodGFzay5kdWVkYXRlKSkpO1xuICAgICAgICBcbiAgICAgICAgZGFpbHlUYXNrcy5mb3JFYWNoKHRhc2sgPT4gZGlzcGxheUFsbFRhc2sodGFzaywgZ2VuZXJhbExpc3QpKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBkaXNwbGF5V2Vla2x5KCkge1xuICAgICAgICBsZXQgbGlzdCA9IHByb2plY3RzLmdyYWJQcm9qZWN0TGlzdCgpWzBdLnRhc2tMaXN0O1xuICAgICAgICBjb25zdCBnZW5lcmFsTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNnZW5lcmFsJyk7XG4gICAgICAgIGdlbmVyYWxMaXN0LmNsYXNzTGlzdC5yZXBsYWNlKGdlbmVyYWxMaXN0LmdldEF0dHJpYnV0ZSgnY2xhc3MnKSwgJ3dlZWtUYWInKTtcblxuICAgICAgICB3aGlsZSAoZ2VuZXJhbExpc3QubGFzdEVsZW1lbnRDaGlsZCkgZ2VuZXJhbExpc3QucmVtb3ZlQ2hpbGQoZ2VuZXJhbExpc3QubGFzdEVsZW1lbnRDaGlsZCk7XG5cbiAgICAgICAgY29uc3Qgd2Vla2x5VGFza3MgPSBsaXN0LmZpbHRlcih0YXNrID0+IGlzVGhpc1dlZWsodG9EYXRlKHRhc2suZHVlZGF0ZSkpKTtcblxuICAgICAgICB3ZWVrbHlUYXNrcy5mb3JFYWNoKHRhc2sgPT4gZGlzcGxheUFsbFRhc2sodGFzaywgZ2VuZXJhbExpc3QpKTtcbiAgICB9XG5cbiAgICByZXR1cm4geyBkaXNwbGF5SW5ib3gsIGRpc3BsYXlEYWlseSwgZGlzcGxheVdlZWtseSwgZGlzcGxheUFsbFRhc2ssIHVwZGF0ZURpc3BsYXksIGdyYWJUYWIgfVxufSkoKVxuXG5jb25zdCByZW5kZXJQcm9qZWN0ID0gKCgpID0+IHtcbiAgICBmdW5jdGlvbiBkaXNwbGF5UHJvamVjdChwcm9qZWN0KSB7XG4gICAgICAgIGNvbnN0IHByb2plY3REaXNwbGF5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmFsbC1wcm9qZWN0cycpO1xuICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcblxuICAgICAgICBjb25zdCBwcm9qZWN0VGl0bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgY29uc3QgcHJvamVjdFRhc2tCdG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTtcbiAgICAgICAgY29uc3QgcHJvamVjdERlbEJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpO1xuXG4gICAgICAgIGNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKGBwcm9qZWN0LSR7cHJvamVjdC5pZH1gKTtcbiAgICAgICAgY29udGFpbmVyLnNldEF0dHJpYnV0ZSgnZGF0YS1wcm9qZWN0SWQnLCBgJHtwcm9qZWN0LmlkfWApO1xuICAgICAgICBwcm9qZWN0VGFza0J0bi5zZXRBdHRyaWJ1dGUoJ2RhdGEtcHJvamVjdElkJywgYCR7cHJvamVjdC5pZH1gKTtcbiAgICAgICAgcHJvamVjdFRhc2tCdG4uc2V0QXR0cmlidXRlKCdpZCcsIGBwcm9qZWN0LSR7cHJvamVjdC5pZH1gKTtcblxuICAgICAgICBwcm9qZWN0VGl0bGUudGV4dENvbnRlbnQgPSBgJHtwcm9qZWN0LnRpdGxlfWA7XG4gICAgICAgIHByb2plY3RUYXNrQnRuLnRleHRDb250ZW50ID0gJysnO1xuICAgICAgICBwcm9qZWN0RGVsQnRuLnRleHRDb250ZW50ID0gJ2RlbGV0ZSc7XG5cbiAgICAgICAgY29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICBkaXNwbGF5UHJvamVjdFRhc2tzKHByb2plY3QuaWQpO1xuICAgICAgICB9KTtcblxuICAgICAgICBwcm9qZWN0VGFza0J0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG4gICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ3Byb2plY3QgaWQnLCBwcm9qZWN0cy5ncmFiUHJvamVjdElkKGUpKTtcbiAgICAgICAgICAgIGNvbnN0IG5ld1Rhc2tGb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI21haW4tZm9ybScpO1xuXG4gICAgICAgICAgICBwcm9qZWN0cy5ncmFiUHJvamVjdElkKGUpO1xuICAgICAgICAgICAgbmV3VGFza0Zvcm0ucmVtb3ZlQXR0cmlidXRlKCdoaWRkZW4nKTtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgfSlcblxuICAgICAgICBwcm9qZWN0RGVsQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICBpbml0RGVsUHJvakJ0bihwcm9qZWN0LmlkKTtcbiAgICAgICAgfSlcblxuICAgICAgICBjb250YWluZXIuYXBwZW5kKHByb2plY3RUaXRsZSwgcHJvamVjdFRhc2tCdG4sIHByb2plY3REZWxCdG4pO1xuICAgICAgICBwcm9qZWN0RGlzcGxheS5hcHBlbmRDaGlsZChjb250YWluZXIpO1xuXG4gICAgICAgIHJldHVybiBwcm9qZWN0RGlzcGxheVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGluaXREZWxQcm9qQnRuKHByb2plY3RJZCkge1xuICAgICAgICBwcm9qZWN0cy5yZW1vdmVQcm9qZWN0KHByb2plY3RJZCk7XG5cbiAgICAgICAgbGV0IHVwZGF0ZWRQcm9qZWN0cyA9IHByb2plY3RzLmdyYWJQcm9qZWN0TGlzdCgpO1xuICAgICAgICBsZXQgdGFza0xpc3QgPSBBZGR0b0xpc3QuVG9kb0xpc3Q7XG4gICAgICAgIGxldCB1cGRhdGVkVGFza0xpc3QgPSB0YXNrTGlzdC5maWx0ZXIodGFzayA9PiB0YXNrLnByb2plY3QgPT09IHByb2plY3RJZCk7XG5cbiAgICAgICAgdXBkYXRlZFRhc2tMaXN0LmZvckVhY2godGFzayA9PiB7XG4gICAgICAgICAgICBsZXQgbmV3TGlzdCA9IEFkZHRvTGlzdC5yZW1vdmVUYXNrKHRhc2suaWQpO1xuICAgICAgICAgICAgcHJvamVjdHMudXBkYXRlR2VuZXJhbExpc3QobmV3TGlzdCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGxldCBwcm9qZWN0c0Rpc3BsYXkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYWxsLXByb2plY3RzJyk7XG4gICAgICAgIHdoaWxlIChwcm9qZWN0c0Rpc3BsYXkubGFzdEVsZW1lbnRDaGlsZCkgcHJvamVjdHNEaXNwbGF5LnJlbW92ZUNoaWxkKHByb2plY3RzRGlzcGxheS5sYXN0RWxlbWVudENoaWxkKTtcblxuICAgICAgICB1cGRhdGVkUHJvamVjdHMuZm9yRWFjaChwcm9qZWN0ID0+IHtcbiAgICAgICAgICAgIGlmIChwcm9qZWN0LmlkID4gMCkgZGlzcGxheVByb2plY3QocHJvamVjdCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmIChwYXJzZUludChyZW5kZXJUYXNrLmdyYWJUYWIocHJvamVjdElkKSkgPT09IHByb2plY3RJZCkgcmVuZGVyVGFzay5kaXNwbGF5SW5ib3goKVxuICAgICAgICBlbHNlIHJlbmRlclRhc2sudXBkYXRlRGlzcGxheShwcm9qZWN0SWQpO1xuXG4gICAgICAgIHN0b3JlTG9jYWwuc3RvcmVQcm9qZWN0cygpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGRpc3BsYXlQcm9qZWN0VGFza3MoaWQpIHtcbiAgICAgICAgbGV0IGxpc3QgPSBwcm9qZWN0cy5wcm9qZWN0TGlzdDtcbiAgICAgICAgY29uc3QgZ2VuZXJhbExpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjZ2VuZXJhbCcpO1xuICAgICAgICBnZW5lcmFsTGlzdC5jbGFzc0xpc3QucmVwbGFjZShnZW5lcmFsTGlzdC5nZXRBdHRyaWJ1dGUoJ2NsYXNzJyksIGAke2lkfWApO1xuXG4gICAgICAgIHdoaWxlIChnZW5lcmFsTGlzdC5sYXN0RWxlbWVudENoaWxkKSBnZW5lcmFsTGlzdC5yZW1vdmVDaGlsZChnZW5lcmFsTGlzdC5sYXN0RWxlbWVudENoaWxkKTtcblxuICAgICAgICBsZXQgcHJvamVjdFRhc2tzID0gcHJvamVjdHMuZ3JhYkN1cnJlbnRQcm9qZWN0VGFza3MoaWQpO1xuXG4gICAgICAgIHByb2plY3RUYXNrcy5mb3JFYWNoKHRhc2sgPT4gcmVuZGVyVGFzay5kaXNwbGF5QWxsVGFzayh0YXNrLCBnZW5lcmFsTGlzdCkpO1xuICAgIH1cblxuICAgIHJldHVybiB7IGRpc3BsYXlQcm9qZWN0LCBkaXNwbGF5UHJvamVjdFRhc2tzIH1cbn0pKClcblxuZXhwb3J0IHsgcmVuZGVyVGFzaywgcmVuZGVyUHJvamVjdCB9IiwiaW1wb3J0IHsgQWRkdG9MaXN0IH0gZnJvbSBcIi4vbWFuYWdlTGlzdFwiO1xuaW1wb3J0IHsgcmVuZGVyVGFzayB9IGZyb20gXCIuL1VJXCI7XG5pbXBvcnQgeyBwcm9qZWN0cyB9IGZyb20gXCIuL21hbmFnZVByb2plY3RcIjtcbmltcG9ydCB7IHRvRGF0ZSwgaXNUaGlzV2VlaywgaXNUb2RheSB9IGZyb20gXCJkYXRlLWZuc1wiO1xuaW1wb3J0IHsgc3RvcmVMb2NhbCB9IGZyb20gXCIuL3N0b3JhZ2VcIjtcblxuXG5jb25zdCBjcmVhdGVUYXNrID0gKGlkLCB0aXRsZSwgZGV0YWlscywgZHVlZGF0ZSwgcHJpb3JpdHksIHByb2plY3QsIHN0YXR1cykgPT4ge1xuICAgIHJldHVybiB7XG4gICAgICAgIGlkLCB0aXRsZSwgZGV0YWlscywgZHVlZGF0ZSwgcHJpb3JpdHksIHByb2plY3QsIHN0YXR1c1xuICAgIH1cbn1cblxuY29uc3QgTmV3VGFzayA9ICgoKSA9PiB7XG5cbiAgICBsZXQgdGl0bGU7XG4gICAgbGV0IGRldGFpbHM7XG5cbiAgICBmdW5jdGlvbiBjcmVhdGVOZXdUYXNrKCkge1xuICAgICAgICBjb25zdCBwcm9qZWN0TGlzdCA9IHByb2plY3RzLmdyYWJQcm9qZWN0TGlzdCgpO1xuXG4gICAgICAgIHRpdGxlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RpdGxlJykudmFsdWU7XG4gICAgICAgIGRldGFpbHMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGV0YWlscycpLnZhbHVlO1xuXG4gICAgICAgIGxldCBkdWVkYXRlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RhdGUnKS52YWx1ZTtcbiAgICAgICAgbGV0IHByaW9yaXR5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ByaW9yaXR5JykudmFsdWU7XG4gICAgICAgIGxldCBpZCA9IGNyZWF0ZUlkKCk7XG4gICAgICAgIGxldCBwcm9qZWN0SWQgPSBwcm9qZWN0cy5ncmFiQ3VycmVudFByb2plY3QoKTtcbiAgICAgICAgbGV0IHN0YXR1cyA9ICd1bmZpbmlzaGVkJ1xuXG4gICAgICAgIGNvbnNvbGUubG9nKGlzVGhpc1dlZWsodG9EYXRlKGR1ZWRhdGUpKSlcbiAgICAgICAgY29uc29sZS5sb2coaXNUb2RheSh0b0RhdGUoZHVlZGF0ZSkpKVxuXG4gICAgICAgIGlmICh0aXRsZSA9PT0gJycgfHxcbiAgICAgICAgICAgIGRldGFpbHMgPT09ICcnIHx8XG4gICAgICAgICAgICBkdWVkYXRlID09PSAnJykgcmV0dXJuXG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgdGFzayA9IGNyZWF0ZVRhc2soaWQsIHRpdGxlLCBkZXRhaWxzLCBkdWVkYXRlLCBwcmlvcml0eSwgcHJvamVjdElkLCBzdGF0dXMpO1xuICAgICAgICAgICAgY29uc29sZS5sb2codGFzayk7XG5cbiAgICAgICAgICAgIGlmIChwcm9qZWN0SWQgPT09IDApIHtcbiAgICAgICAgICAgICAgICBwcm9qZWN0TGlzdFswXS50YXNrTGlzdC5wdXNoKHRhc2spO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHByb2plY3RMaXN0KVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8IHByb2plY3RMaXN0Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgaWYgKHByb2plY3RMaXN0W2ldLmlkID09PSBwcm9qZWN0SWQpIHtcbiAgICAgICAgICAgICAgICAgICAgQWRkdG9MaXN0LmFkZFRvTGlzdCh0YXNrKTtcbiAgICAgICAgICAgICAgICAgICAgcHJvamVjdExpc3RbaV0udGFza0xpc3QucHVzaCh0YXNrKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2cocHJvamVjdExpc3QpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9IFxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGNyZWF0ZUlkKCkge1xuICAgICAgICBsZXQgbGlzdCA9IHByb2plY3RzLmdyYWJQcm9qZWN0TGlzdCgpWzBdLnRhc2tMaXN0O1xuICAgICAgICBsZXQgaWQ7XG5cbiAgICAgICAgaWYgKGxpc3QubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gaWQgPSAwO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIGlkID0gbGlzdFtsaXN0Lmxlbmd0aC0xXS5pZCArIDE7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiByZXNldCgpIHtcbiAgICAgICAgbGV0IHRpdGxlVmFsdWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGl0bGUnKTtcbiAgICAgICAgdGl0bGVWYWx1ZS52YWx1ZSA9ICcnO1xuICAgICAgICB0aXRsZSA9ICcnO1xuXG4gICAgICAgIGxldCBkZXRhaWxzVmFsdWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGV0YWlscycpO1xuICAgICAgICBkZXRhaWxzVmFsdWUudmFsdWUgPSAnJztcbiAgICAgICAgZGV0YWlscyA9ICcnO1xuXG4gICAgICAgIGxldCBkdWVkYXRlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RhdGUnKTtcbiAgICAgICAgZHVlZGF0ZS52YWx1ZSA9ICcnO1xuXG4gICAgICAgIGxldCBwcmlvcml0eSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcmlvcml0eScpO1xuICAgICAgICBwcmlvcml0eS52YWx1ZSA9ICdMb3cnO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGluaXRTdWJtaXRCdG4oKSB7XG4gICAgICAgIGNvbnN0IHN1Ym1pdEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNzdWJtaXQnKTtcblxuICAgICAgICBzdWJtaXRCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xuICAgICAgICAgICAgc3VibWl0VGFzaygpO1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZWRpdFRhc2soaWQpIHtcbiAgICAgICAgbGV0IHRhc2tUaXRsZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0aXRsZScpLnZhbHVlO1xuICAgICAgICBsZXQgdGFza0RldGFpbHMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGV0YWlscycpLnZhbHVlO1xuICAgICAgICBsZXQgdGFza0RhdGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGF0ZScpLnZhbHVlO1xuICAgICAgICBsZXQgdGFza1ByaW9yaXR5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ByaW9yaXR5JykudmFsdWU7XG5cbiAgICAgICAgY29uc3QgdGFza0xpc3QgPSBwcm9qZWN0cy5ncmFiUHJvamVjdExpc3QoKVswXS50YXNrTGlzdDtcbiAgICAgICAgY29uc3QgZWRpdGVkVGFzayA9IHRhc2tMaXN0LmZpbHRlcih0YXNrID0+IGlkID09PSB0YXNrLmlkKVswXTtcblxuICAgICAgICBlZGl0ZWRUYXNrLnRpdGxlID0gdGFza1RpdGxlO1xuICAgICAgICBlZGl0ZWRUYXNrLmRldGFpbHMgPSB0YXNrRGV0YWlscztcbiAgICAgICAgZWRpdGVkVGFzay5kdWVkYXRlID0gdGFza0RhdGU7XG4gICAgICAgIGVkaXRlZFRhc2sucHJpb3JpdHkgPSB0YXNrUHJpb3JpdHk7XG5cbiAgICAgICAgdGl0bGUgPSB0YXNrVGl0bGU7XG4gICAgICAgIGRldGFpbHMgPSB0YXNrRGV0YWlscztcblxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRhc2tMaXN0Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAodGFza0xpc3RbaV0uaWQgPT09IGlkKSB7XG4gICAgICAgICAgICAgICAgdGFza0xpc3RbaV0gPSBlZGl0ZWRUYXNrO1xuICAgICAgICAgICAgICAgIHByb2plY3RzLnVwZGF0ZVByb2plY3QodGFza0xpc3RbaV0ucHJvamVjdCk7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cocHJvamVjdHMuZ3JhYlByb2plY3RMaXN0KCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gc3VibWl0VGFzaygpIHtcbiAgICAgICAgY29uc3QgbmV3VGFza0Zvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjbWFpbi1mb3JtJyk7XG4gICAgICAgIGNvbnN0IG5ld1Rhc2tCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjbmV3VGFzaycpO1xuICAgICAgICBjb25zdCB0YXNrSWQgPSBwYXJzZUludChuZXdUYXNrRm9ybS5nZXRBdHRyaWJ1dGUoJ2RhdGEtdGFza0lkJykpO1xuICAgICAgICBcbiAgICAgICAgaWYgKG5ld1Rhc2tGb3JtLmdldEF0dHJpYnV0ZSgnY2xhc3MnKSA9PT0gJ2VkaXQtbW9kZScpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCd3ZXJrJylcbiAgICAgICAgICAgIGVkaXRUYXNrKHRhc2tJZCk7XG4gICAgICAgIH0gZWxzZSB7Y3JlYXRlTmV3VGFzaygpfTtcbiAgICAgICAgc3RvcmVMb2NhbC5zdG9yZVByb2plY3RzKCk7XG5cbiAgICAgICAgaWYgKHRpdGxlID09PSAnJyB8fCBkZXRhaWxzID09PSAnJykgcmV0dXJuXG5cbiAgICAgICAgbGV0IHByb2plY3RJZDtcbiAgICAgICAgbGV0IHRhc2tMaXN0ID0gcHJvamVjdHMuZ3JhYlByb2plY3RMaXN0KClbMF0udGFza0xpc3RcblxuICAgICAgICBpZiAobmV3VGFza0Zvcm0uZ2V0QXR0cmlidXRlKCdjbGFzcycpID09PSAnZWRpdC1tb2RlJykge1xuICAgICAgICAgICAgcHJvamVjdElkID0gdGFza0xpc3QuZmlsdGVyKHRhc2sgPT4gdGFza0lkID09PSB0YXNrLmlkKVswXS5wcm9qZWN0O1xuICAgICAgICAgICAgbmV3VGFza0Zvcm0uY2xhc3NMaXN0LnJlbW92ZSgnZWRpdC1tb2RlJyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBwcm9qZWN0SWQgPSB0YXNrTGlzdFt0YXNrTGlzdC5sZW5ndGggLSAxXS5wcm9qZWN0OyBcbiAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgIHJlbmRlclRhc2sudXBkYXRlRGlzcGxheShwcm9qZWN0SWQpO1xuICAgICAgICByZXNldCgpO1xuICAgICAgICBuZXdUYXNrRm9ybS5zZXRBdHRyaWJ1dGUoJ2hpZGRlbicsICcnKTtcbiAgICAgICAgbmV3VGFza0J0bi5yZW1vdmVBdHRyaWJ1dGUoJ2hpZGRlbicpO1xuICAgICAgICBcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjYW5jZWxUYXNrKCkge1xuICAgICAgICBjb25zdCBjYW5jZWxCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjY2FuY2VsJyk7XG4gICAgICAgIGNvbnN0IG5ld1Rhc2tGb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI21haW4tZm9ybScpO1xuICAgICAgICBjb25zdCBuZXdUYXNrQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI25ld1Rhc2snKTtcblxuICAgICAgICBjYW5jZWxCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xuICAgICAgICAgICAgcmVzZXQoKTtcbiAgICAgICAgICAgIG5ld1Rhc2tGb3JtLnNldEF0dHJpYnV0ZSgnaGlkZGVuJywgJycpO1xuICAgICAgICAgICAgbmV3VGFza0J0bi5yZW1vdmVBdHRyaWJ1dGUoJ2hpZGRlbicpO1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB9KVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIG9wZW5UYXNrQ3JlYXRvcigpIHtcbiAgICAgICAgY29uc3QgbmV3VGFza0J0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNuZXdUYXNrJyk7XG4gICAgICAgIGNvbnN0IG5ld1Rhc2tGb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI21haW4tZm9ybScpO1xuXG4gICAgICAgIG5ld1Rhc2tCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xuICAgICAgICAgICAgcHJvamVjdHMuZ3JhYlByb2plY3RJZChlKTtcbiAgICAgICAgICAgIG5ld1Rhc2tGb3JtLnJlbW92ZUF0dHJpYnV0ZSgnaGlkZGVuJyk7XG4gICAgICAgICAgICBuZXdUYXNrQnRuLnNldEF0dHJpYnV0ZSgnaGlkZGVuJywgJycpO1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB9KVxuICAgIH1cblxuICAgIHJldHVybiB7IGNyZWF0ZU5ld1Rhc2ssIGluaXRTdWJtaXRCdG4sIGNhbmNlbFRhc2ssIG9wZW5UYXNrQ3JlYXRvciB9XG59KSgpO1xuXG5leHBvcnQgeyBOZXdUYXNrIH1cbiIsImltcG9ydCB7IE5ld1Rhc2sgfSBmcm9tIFwiLi9tYW5hZ2VUYXNrLmpzXCI7XG5pbXBvcnQgeyBwcm9qZWN0cyB9IGZyb20gXCIuL21hbmFnZVByb2plY3QuanNcIjtcbmltcG9ydCB7IHJlbmRlclRhc2sgfSBmcm9tIFwiLi9VSS5qc1wiO1xuaW1wb3J0IHsgc3RvcmVMb2NhbCB9IGZyb20gXCIuL3N0b3JhZ2UuanNcIjtcblxuTmV3VGFzay5pbml0U3VibWl0QnRuKCk7XG5OZXdUYXNrLmNhbmNlbFRhc2soKTtcbk5ld1Rhc2sub3BlblRhc2tDcmVhdG9yKCk7XG5cbnByb2plY3RzLnN1Ym1pdFByb2plY3QoKTtcblxuY29uc3QgdG9kYXlUYWIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjdG9kYXknKTtcbmNvbnN0IHdlZWtUYWIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjd2Vla2x5Jyk7XG5jb25zdCBpbmJveFRhYiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNpbmJveCcpO1xuXG50b2RheVRhYi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycscmVuZGVyVGFzay5kaXNwbGF5RGFpbHkpO1xud2Vla1RhYi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHJlbmRlclRhc2suZGlzcGxheVdlZWtseSk7XG5pbmJveFRhYi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHJlbmRlclRhc2suZGlzcGxheUluYm94KTtcblxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIHN0b3JlTG9jYWwubG9hZFN0b3JhZ2UpOyJdLCJuYW1lcyI6WyJBZGR0b0xpc3QiLCJUb2RvTGlzdCIsImFkZFRvTGlzdCIsInRhc2siLCJwdXNoIiwiY29uc29sZSIsImxvZyIsInJlbW92ZVRhc2siLCJpZCIsImZpbHRlciIsInN0b3JlTG9jYWwiLCJwcm9qZWN0TGlzdCIsInByb2plY3RzIiwiZ3JhYlByb2plY3RMaXN0IiwiaXRlbSIsImxvY2FsU3RvcmFnZSIsInNldEl0ZW0iLCJKU09OIiwic3RyaW5naWZ5IiwicGFyc2UiLCJnZXRJdGVtIiwibmV3TGlzdCIsInRhc2tMaXN0IiwiZm9yRWFjaCIsInJlbmRlclRhc2siLCJ1cGRhdGVEaXNwbGF5IiwicHJvamVjdCIsImFkZFRvUHJvamVjdExpc3QiLCJyZW5kZXJQcm9qZWN0IiwiZGlzcGxheVByb2plY3QiLCJuZXdQcm9qZWN0IiwidGl0bGUiLCJwcm9qZWN0VGl0bGUiLCJnZW5lcmFsTGlzdCIsImN1cnJlbnRQcm9qZWN0Iiwic3VibWl0UHJvamVjdCIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwicHJldmVudERlZmF1bHQiLCJ2YWx1ZSIsInByb2plY3RJZCIsImxlbmd0aCIsImNyZWF0ZVByb2plY3QiLCJncmFiUHJvamVjdElkIiwicGFyc2VJbnQiLCJ0YXJnZXQiLCJnZXRBdHRyaWJ1dGUiLCJncmFiQ3VycmVudFByb2plY3QiLCJ1cGRhdGVHZW5lcmFsTGlzdCIsInVwZGF0ZVByb2plY3QiLCJ1cGRhdGUiLCJncmFiQ3VycmVudFByb2plY3RUYXNrcyIsInJlbW92ZVByb2plY3QiLCJ0b0RhdGUiLCJhcmd1bWVudCIsImFyZ1N0ciIsIk9iamVjdCIsInByb3RvdHlwZSIsInRvU3RyaW5nIiwiY2FsbCIsIkRhdGUiLCJjb25zdHJ1Y3RvciIsIk5hTiIsInN0YXJ0T2ZEYXkiLCJkYXRlIiwiX2RhdGUiLCJzZXRIb3VycyIsImlzVG9kYXkiLCJkYXRlTGVmdCIsImRhdGVSaWdodCIsIm5vdyIsImRlZmF1bHRPcHRpb25zIiwiZ2V0RGVmYXVsdE9wdGlvbnMiLCJzdGFydE9mV2VlayIsIm9wdGlvbnMiLCJ3ZWVrU3RhcnRzT24iLCJsb2NhbGUiLCJkYXkiLCJnZXREYXkiLCJkaWZmIiwic2V0RGF0ZSIsImdldERhdGUiLCJpc1RoaXNXZWVrIiwiaXNTYW1lV2VlayIsImRpc3BsYXlBbGxUYXNrIiwiaXRlbXMiLCJkaXNwbGF5IiwiY29udGFpbmVyIiwiY3JlYXRlRWxlbWVudCIsInNldEF0dHJpYnV0ZSIsImNsYXNzTGlzdCIsImFkZCIsImR1ZWRhdGUiLCJkZXRhaWxzIiwicHJpb3JpdHkiLCJkZWxldGVCdG4iLCJlZGl0QnRuIiwiY2hlY2tib3giLCJsYWJlbCIsInRleHRDb250ZW50IiwiaW5pdENoZWNrYm94T24iLCJyZW1vdmVBdHRyaWJ1dGUiLCJzdGF0dXMiLCJyZW1vdmUiLCJpbml0Q2hlY2tib3hPZmYiLCJBbGx0YXNrIiwibGFzdEVsZW1lbnRDaGlsZCIsInJlbW92ZUNoaWxkIiwiaW5pdERlbEJ0biIsInRhc2tGb3JtIiwiZ2V0RWxlbWVudEJ5SWQiLCJ0YXNrVGl0bGUiLCJ0YXNrRGV0YWlscyIsInRhc2tEYXRlIiwidGFza1ByaW9yaXR5IiwiaW5pdEVkaXRCdG4iLCJhcHBlbmQiLCJhcHBlbmRDaGlsZCIsImdyYWJUYWIiLCJ0YWIiLCJkaXNwbGF5SW5ib3giLCJkaXNwbGF5RGFpbHkiLCJkaXNwbGF5V2Vla2x5IiwiZGlzcGxheVByb2plY3RUYXNrcyIsImxpc3QiLCJyZXBsYWNlIiwicHJvamVjdERpc3BsYXkiLCJwcm9qZWN0VGFza0J0biIsInByb2plY3REZWxCdG4iLCJzdG9wUHJvcGFnYXRpb24iLCJuZXdUYXNrRm9ybSIsInVwZGF0ZWRQcm9qZWN0cyIsInByb2plY3RzRGlzcGxheSIsImluaXREZWxQcm9qQnRuIiwiTmV3VGFzayIsImNyZWF0ZU5ld1Rhc2siLCJjcmVhdGVJZCIsImNyZWF0ZVRhc2siLCJpIiwicmVzZXQiLCJpbml0U3VibWl0QnRuIiwibmV3VGFza0J0biIsInRhc2tJZCIsImVkaXRlZFRhc2siLCJlZGl0VGFzayIsInN1Ym1pdFRhc2siLCJjYW5jZWxUYXNrIiwiY2FuY2VsQnRuIiwib3BlblRhc2tDcmVhdG9yIiwidG9kYXlUYWIiLCJ3ZWVrVGFiIiwiaW5ib3hUYWIiXSwic291cmNlUm9vdCI6IiJ9