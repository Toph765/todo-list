(()=>{"use strict";const t=(()=>{let t=[];return{addToList:function(e){t.push(e),console.log(t)},TodoList:t,removeTask:function(e){return t=t.filter((t=>e!==t.id))}}})(),e=function(){const t=r.grabProjectList();var e;localStorage.setItem("project",(e=t,JSON.stringify(e))),console.log(JSON.parse(localStorage.getItem("project")))},o=function(){const e=JSON.parse(localStorage.getItem("project"));e[0].taskList.forEach((e=>{t.addToList(e),m.updateDisplay(e.project)})),e.filter((t=>0!==t.id)).forEach((t=>{r.addToProjectList(t),p.displayProject(t)}))},n=(t,e,o)=>({title:t,taskList:e,id:o}),r=(()=>{let o,r=[],i=t.TodoList;const c=n("General",i,0);r.push(c);let l=0;function a(t){r.push(t),console.log(r)}return{submitProject:function(){document.querySelector("#createProject").addEventListener("click",(t=>{if(t.preventDefault(),function(){o=document.querySelector("#projectTitle").value;const t=0===r.length?0:r[r.length-1].id+1;if(""!==o){const r=n(o,[],t);console.log(r),a(r),e()}}(),""!==o){let t=r[r.length-1];p.displayProject(t),document.querySelector("#projectTitle").value="",o=""}}))},grabProjectId:function(t){let e=parseInt(t.target.getAttribute("data-projectId"));return l=e,l},grabCurrentProject:function(){return l},grabProjectList:function(){return r},projectList:r,updateGeneralList:function(t){return c.taskList=t,console.log(c.taskList),c},updateProject:function(t){let e=c.taskList.filter((e=>e.project===t));return console.log(e),0!==t?r.filter((e=>e.id===t))[0].taskList=e:void 0},grabCurrentProjectTasks:function(t){return console.log(r.filter((e=>e.id===t))[0].taskList),r.filter((e=>e.id===t))[0].taskList},removeProject:function(t){return console.log("before",r),r=r.filter((e=>e.id!==t)),console.log("after",r),r},addToProjectList:a}})();function i(t){const e=Object.prototype.toString.call(t);return t instanceof Date||"object"==typeof t&&"[object Date]"===e?new t.constructor(+t):"number"==typeof t||"[object Number]"===e||"string"==typeof t||"[object String]"===e?new Date(t):new Date(NaN)}function c(t){const e=i(t);return e.setHours(0,0,0,0),e}function l(t){return e=t,o=Date.now(),+c(e)==+c(o);var e,o}let a={};function d(){return a}function s(t,e){const o=d(),n=e?.weekStartsOn??e?.locale?.options?.weekStartsOn??o.weekStartsOn??o.locale?.options?.weekStartsOn??0,r=i(t),c=r.getDay(),l=(c<n?7:0)+c-n;return r.setDate(r.getDate()-l),r.setHours(0,0,0,0),r}function u(t,e){return function(t,e,o){return+s(t,o)==+s(e,o)}(t,Date.now(),e)}const m=(()=>{function o(o,n){const i=document.createElement("div");i.setAttribute("data-taskId",`${o.id}`),i.classList.add("task");const l=document.createElement("div"),a=document.createElement("div"),d=document.createElement("div"),s=document.createElement("div"),u=document.createElement("button"),m=document.createElement("button");return l.textContent=`Title: ${o.title}`,a.textContent=`Due Date: ${o.duedate}`,d.textContent=`Description: ${o.description}`,s.textContent=`Priority: ${o.priority}`,u.textContent="delete",m.textContent="edit",u.setAttribute("data-taskId",`${o.id}`),u.addEventListener("click",(()=>function(o,n){let i=t.removeTask(o);const l=document.querySelector("#general");for(r.updateGeneralList(i),r.updateProject(n),e();l.lastElementChild;)l.removeChild(l.lastElementChild);c(n),console.log(r.projectList),console.log(n)}(o.id,o.project))),m.addEventListener("click",(()=>{!function(t){const e=document.querySelector("#main-form");e.classList.add("edit-mode"),e.setAttribute("data-taskId",`${t.id}`);let o=document.getElementById("title"),n=document.getElementById("description"),r=document.getElementById("date"),i=document.getElementById("priority");const c=t.title,l=t.description,a=t.duedate,d=t.priority;o.value=c,n.value=l,r.value=a,i.value=d,e.removeAttribute("hidden")}(o)})),i.append(l,a,d,s,u,m),n.appendChild(i),n}function n(){return document.querySelector("#general").getAttribute("class")}function c(t){let e=n();"inboxTab"===e?a():"todayTab"===e?d():"weekTab"===e?s():e===`${t}`&&0!==t&&p.displayProjectTasks(t)}function a(){let t=r.grabProjectList()[0].taskList;const e=document.querySelector("#general");for(e.classList.replace(e.getAttribute("class"),"inboxTab");e.lastElementChild;)e.removeChild(e.lastElementChild);console.log(t),t.forEach((t=>o(t,e))),console.log(r.projectList)}function d(){let t=r.grabProjectList()[0].taskList;const e=document.querySelector("#general");for(e.classList.replace(e.getAttribute("class"),"todayTab");e.lastElementChild;)e.removeChild(e.lastElementChild);t.filter((t=>l(i(t.duedate)))).forEach((t=>o(t,e)))}function s(){let t=r.grabProjectList()[0].taskList;const e=document.querySelector("#general");for(e.classList.replace(e.getAttribute("class"),"weekTab");e.lastElementChild;)e.removeChild(e.lastElementChild);t.filter((t=>u(i(t.duedate)))).forEach((t=>o(t,e)))}return{displayInbox:a,displayDaily:d,displayWeekly:s,displayAllTask:o,updateDisplay:c,grabTab:n}})(),p=(()=>{function o(t){r.projectList;const e=document.querySelector("#general");for(e.classList.replace(e.getAttribute("class"),`${t}`);e.lastElementChild;)e.removeChild(e.lastElementChild);r.grabCurrentProjectTasks(t).forEach((t=>m.displayAllTask(t,e)))}return{displayProject:function n(i){const c=document.querySelector(".all-projects"),l=document.createElement("div"),a=document.createElement("div"),d=document.createElement("button"),s=document.createElement("button");return l.classList.add(`project-${i.id}`),l.setAttribute("data-projectId",`${i.id}`),d.setAttribute("data-projectId",`${i.id}`),d.setAttribute("id",`project-${i.id}`),a.textContent=`${i.title}`,d.textContent="+",s.textContent="delete",l.addEventListener("click",(t=>{t.stopPropagation(),o(i.id)})),d.addEventListener("click",(t=>{t.stopPropagation(),console.log("project id",r.grabProjectId(t));const e=document.querySelector("#main-form");r.grabProjectId(t),e.removeAttribute("hidden"),t.preventDefault()})),s.addEventListener("click",(o=>{o.stopPropagation(),function(o){r.removeProject(o);let i=r.grabProjectList();t.TodoList.filter((t=>t.project===o)).forEach((e=>{let o=t.removeTask(e.id);r.updateGeneralList(o)}));let c=document.querySelector(".all-projects");for(;c.lastElementChild;)c.removeChild(c.lastElementChild);i.forEach((t=>{t.id>0&&n(t)})),parseInt(m.grabTab(o))===o?m.displayInbox():m.updateDisplay(o),e()}(i.id)})),l.append(a,d,s),c.appendChild(l),c},displayProjectTasks:o}})(),g=(()=>{let o,n;function c(){const e=r.grabProjectList();o=document.getElementById("title").value,n=document.getElementById("description").value;let c=document.getElementById("date").value,a=document.getElementById("priority").value,d=function(){let t=r.grabProjectList()[0].taskList;return 0===t.length?0:t[t.length-1].id+1}(),s=r.grabCurrentProject();if(console.log(u(i(c))),console.log(l(i(c))),""!==o&&""!==n&&""!==c){const r=((t,e,o,n,r,i)=>({id:t,title:e,description:o,duedate:n,priority:r,project:i}))(d,o,n,c,a,s);console.log(r),0===s&&(e[0].taskList.push(r),console.log(e));for(let o=1;o<e.length;o++)e[o].id===s&&(t.addToList(r),e[o].taskList.push(r),console.log(e))}}function a(){document.getElementById("title").value="",o="",document.getElementById("description").value="",n="",document.getElementById("date").value="",document.getElementById("priority").value="Low"}return{createNewTask:c,initSubmitBtn:function(){document.querySelector("#submit").addEventListener("click",(t=>{!function(){const t=document.querySelector("#main-form"),i=document.querySelector("#newTask"),l=parseInt(t.getAttribute("data-taskId"));if("edit-mode"===t.getAttribute("class")?(console.log("werk"),function(t){let e=document.getElementById("title").value,i=document.getElementById("description").value,c=document.getElementById("date").value,l=document.getElementById("priority").value;const a=r.grabProjectList()[0].taskList,d=a.filter((e=>t===e.id))[0];d.title=e,d.description=i,d.duedate=c,d.priority=l,o=e,n=i;for(let e=0;e<a.length;e++)a[e].id===t&&(a[e]=d,r.updateProject(a[e].project),console.log(r.grabProjectList()))}(l)):c(),e(),""===o||""===n)return;let d,s=r.grabProjectList()[0].taskList;"edit-mode"===t.getAttribute("class")?(d=s.filter((t=>l===t.id))[0].project,t.classList.remove("edit-mode")):d=s[s.length-1].project,m.updateDisplay(d),a(),t.setAttribute("hidden",""),i.removeAttribute("hidden")}(),t.preventDefault()}))},cancelTask:function(){const t=document.querySelector("#cancel"),e=document.querySelector("#main-form"),o=document.querySelector("#newTask");t.addEventListener("click",(t=>{a(),e.setAttribute("hidden",""),o.removeAttribute("hidden"),t.preventDefault()}))},openTaskCreator:function(){const t=document.querySelector("#newTask"),e=document.querySelector("#main-form");t.addEventListener("click",(o=>{r.grabProjectId(o),e.removeAttribute("hidden"),t.setAttribute("hidden",""),o.preventDefault()}))}}})();g.initSubmitBtn(),g.cancelTask(),g.openTaskCreator(),r.submitProject();const f=document.querySelector("#today"),y=document.querySelector("#weekly"),b=document.querySelector("#inbox");f.addEventListener("click",m.displayDaily),y.addEventListener("click",m.displayWeekly),b.addEventListener("click",m.displayInbox),document.addEventListener("DOMContentLoaded",o)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RyxXQXpCdkMsV0FDSSxNQUFNQyxFQUFZNUcsU0FBU0MsY0FBYyxXQUNuQ3lGLEVBQWMxRixTQUFTQyxjQUFjLGNBQ3JDb0csRUFBYXJHLFNBQVNDLGNBQWMsWUFFMUMyRyxFQUFVMUcsaUJBQWlCLFNBQVVDLElBQ2pDZ0csSUFDQVQsRUFBWW5DLGFBQWEsU0FBVSxJQUNuQzhDLEVBQVczQixnQkFBZ0IsVUFDM0J2RSxFQUFFQyxnQkFBZ0IsR0FFMUIsRUFjbUR5RyxnQkFabkQsV0FDSSxNQUFNUixFQUFhckcsU0FBU0MsY0FBYyxZQUNwQ3lGLEVBQWMxRixTQUFTQyxjQUFjLGNBRTNDb0csRUFBV25HLGlCQUFpQixTQUFVQyxJQUNsQzNCLEVBQVNpQyxjQUFjTixHQUN2QnVGLEVBQVloQixnQkFBZ0IsVUFDNUIyQixFQUFXOUMsYUFBYSxTQUFVLElBQ2xDcEQsRUFBRUMsZ0JBQWdCLEdBRTFCLEVBR0gsRUEvSmUsR0NSaEIwRixFQUFRTSxnQkFDUk4sRUFBUWEsYUFDUmIsRUFBUWUsa0JBRVJySSxFQUFTdUIsZ0JBRVQsTUFBTStHLEVBQVc5RyxTQUFTQyxjQUFjLFVBQ2xDOEcsRUFBVS9HLFNBQVNDLGNBQWMsV0FDakMrRyxFQUFXaEgsU0FBU0MsY0FBYyxVQUV4QzZHLEVBQVM1RyxpQkFBaUIsUUFBUWQsRUFBVzZGLGNBQzdDOEIsRUFBUTdHLGlCQUFpQixRQUFTZCxFQUFXOEYsZUFDN0M4QixFQUFTOUcsaUJBQWlCLFFBQVNkLEVBQVc0RixjQUU5Q2hGLFNBQVNFLGlCQUFpQixtQkFBb0I1QixFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vdG9kby1saXN0Ly4vc3JjL21hbmFnZUxpc3QuanMiLCJ3ZWJwYWNrOi8vdG9kby1saXN0Ly4vc3JjL3N0b3JhZ2UuanMiLCJ3ZWJwYWNrOi8vdG9kby1saXN0Ly4vc3JjL21hbmFnZVByb2plY3QuanMiLCJ3ZWJwYWNrOi8vdG9kby1saXN0Ly4vbm9kZV9tb2R1bGVzL2RhdGUtZm5zL3RvRGF0ZS5tanMiLCJ3ZWJwYWNrOi8vdG9kby1saXN0Ly4vbm9kZV9tb2R1bGVzL2RhdGUtZm5zL3N0YXJ0T2ZEYXkubWpzIiwid2VicGFjazovL3RvZG8tbGlzdC8uL25vZGVfbW9kdWxlcy9kYXRlLWZucy9pc1RvZGF5Lm1qcyIsIndlYnBhY2s6Ly90b2RvLWxpc3QvLi9ub2RlX21vZHVsZXMvZGF0ZS1mbnMvaXNTYW1lRGF5Lm1qcyIsIndlYnBhY2s6Ly90b2RvLWxpc3QvLi9ub2RlX21vZHVsZXMvZGF0ZS1mbnMvX2xpYi9kZWZhdWx0T3B0aW9ucy5tanMiLCJ3ZWJwYWNrOi8vdG9kby1saXN0Ly4vbm9kZV9tb2R1bGVzL2RhdGUtZm5zL3N0YXJ0T2ZXZWVrLm1qcyIsIndlYnBhY2s6Ly90b2RvLWxpc3QvLi9ub2RlX21vZHVsZXMvZGF0ZS1mbnMvaXNUaGlzV2Vlay5tanMiLCJ3ZWJwYWNrOi8vdG9kby1saXN0Ly4vbm9kZV9tb2R1bGVzL2RhdGUtZm5zL2lzU2FtZVdlZWsubWpzIiwid2VicGFjazovL3RvZG8tbGlzdC8uL3NyYy9VSS5qcyIsIndlYnBhY2s6Ly90b2RvLWxpc3QvLi9zcmMvbWFuYWdlVGFzay5qcyIsIndlYnBhY2s6Ly90b2RvLWxpc3QvLi9zcmMvaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgQWRkdG9MaXN0ID0gKCgpID0+IHtcbiAgICBsZXQgVG9kb0xpc3QgPSBbXTtcblxuICAgIGZ1bmN0aW9uIGFkZFRvTGlzdCh0YXNrKSB7XG4gICAgICAgIFRvZG9MaXN0LnB1c2godGFzayk7XG4gICAgICAgIGNvbnNvbGUubG9nKFRvZG9MaXN0KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiByZW1vdmVUYXNrKGlkKSB7XG4gICAgICAgIHJldHVybiBUb2RvTGlzdCA9IFRvZG9MaXN0LmZpbHRlcih0YXNrID0+IGlkICE9PSB0YXNrLmlkKTtcbiAgICB9XG5cbiAgICByZXR1cm4geyBhZGRUb0xpc3QsIFRvZG9MaXN0LCByZW1vdmVUYXNrIH07XG59KSgpXG5cblxuZXhwb3J0IHsgQWRkdG9MaXN0IH0iLCJpbXBvcnQgeyBwcm9qZWN0cyB9IGZyb20gXCIuL21hbmFnZVByb2plY3RcIjtcbmltcG9ydCB7IHJlbmRlclByb2plY3QsIHJlbmRlclRhc2sgfSBmcm9tIFwiLi9VSVwiO1xuaW1wb3J0IHsgQWRkdG9MaXN0IH0gZnJvbSBcIi4vbWFuYWdlTGlzdFwiO1xuXG5jb25zdCBzdG9yZUxvY2FsID0gKCgpID0+IHtcbiAgICBmdW5jdGlvbiBzdHJpbmdpZnkoaXRlbSkge1xuICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoaXRlbSk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gc3RvcmVQcm9qZWN0cygpIHtcbiAgICAgICAgY29uc3QgcHJvamVjdExpc3QgPSBwcm9qZWN0cy5ncmFiUHJvamVjdExpc3QoKTtcbiAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3Byb2plY3QnLCBzdHJpbmdpZnkocHJvamVjdExpc3QpKTtcbiAgICAgICAgY29uc29sZS5sb2coSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgncHJvamVjdCcpKSk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gbG9hZFN0b3JhZ2UoKSB7XG4gICAgICAgIGNvbnN0IG5ld0xpc3QgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdwcm9qZWN0JykpO1xuXG4gICAgICAgIGxldCBnZW5MaXN0ID0gbmV3TGlzdFswXTtcbiAgICAgICAgZ2VuTGlzdC50YXNrTGlzdC5mb3JFYWNoKHRhc2sgPT4ge1xuICAgICAgICAgICAgQWRkdG9MaXN0LmFkZFRvTGlzdCh0YXNrKTtcbiAgICAgICAgICAgIHJlbmRlclRhc2sudXBkYXRlRGlzcGxheSh0YXNrLnByb2plY3QpXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGxldCBsb2FkZWRQcm9qZWN0cyA9IG5ld0xpc3QuZmlsdGVyKHByb2plY3QgPT4gcHJvamVjdC5pZCAhPT0gMCk7XG4gICAgICAgIGxvYWRlZFByb2plY3RzLmZvckVhY2gocHJvamVjdCA9PiB7XG4gICAgICAgICAgICBwcm9qZWN0cy5hZGRUb1Byb2plY3RMaXN0KHByb2plY3QpO1xuICAgICAgICAgICAgcmVuZGVyUHJvamVjdC5kaXNwbGF5UHJvamVjdChwcm9qZWN0KTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHsgc3RvcmVQcm9qZWN0cyxcbiAgICAgICAgICAgICBsb2FkU3RvcmFnZSB9XG59KSgpO1xuXG5leHBvcnQge3N0b3JlTG9jYWx9IiwiaW1wb3J0IHsgcmVuZGVyUHJvamVjdCB9IGZyb20gXCIuL1VJXCI7XG5pbXBvcnQgeyBBZGR0b0xpc3QgfSBmcm9tIFwiLi9tYW5hZ2VMaXN0XCI7XG5pbXBvcnQgeyBzdG9yZUxvY2FsIH0gZnJvbSBcIi4vc3RvcmFnZVwiO1xuXG5jb25zdCBuZXdQcm9qZWN0ID0gKHRpdGxlLCB0YXNrTGlzdCwgaWQpID0+IHtcbiAgICByZXR1cm4geyB0aXRsZSwgdGFza0xpc3QsIGlkIH07XG59XG5cbmNvbnN0IHByb2plY3RzID0gKCgpID0+IHtcbiAgICBsZXQgcHJvamVjdFRpdGxlXG4gICAgbGV0IHByb2plY3RMaXN0ID0gW107XG5cbiAgICBsZXQgdGFza0xpc3QgPSBBZGR0b0xpc3QuVG9kb0xpc3Q7XG5cbiAgICBjb25zdCBnZW5lcmFsTGlzdCA9IG5ld1Byb2plY3QoJ0dlbmVyYWwnLCB0YXNrTGlzdCwgMCk7XG4gICAgcHJvamVjdExpc3QucHVzaChnZW5lcmFsTGlzdCk7XG5cbiAgICBsZXQgY3VycmVudFByb2plY3QgPSAwO1xuXG4gICAgZnVuY3Rpb24gdXBkYXRlR2VuZXJhbExpc3QobmV3TGlzdCkge1xuICAgICAgICBnZW5lcmFsTGlzdC50YXNrTGlzdCA9IG5ld0xpc3RcbiAgICAgICAgY29uc29sZS5sb2coZ2VuZXJhbExpc3QudGFza0xpc3QpXG4gICAgICAgIHJldHVybiBnZW5lcmFsTGlzdFxuICAgIH1cblxuICAgIGZ1bmN0aW9uIHVwZGF0ZVByb2plY3QoaWQpIHtcbiAgICAgICAgbGV0IHVwZGF0ZSA9IGdlbmVyYWxMaXN0LnRhc2tMaXN0LmZpbHRlcih0YXNrID0+IHRhc2sucHJvamVjdCA9PT0gaWQpO1xuICAgICAgICBjb25zb2xlLmxvZyh1cGRhdGUpXG4gICAgICAgIGlmIChpZCAhPT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIHByb2plY3RMaXN0LmZpbHRlcihwcm9qZWN0ID0+IHByb2plY3QuaWQgPT09IGlkKVswXS50YXNrTGlzdCA9IHVwZGF0ZVxuICAgICAgICB9IGVsc2UgcmV0dXJuO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdyYWJDdXJyZW50UHJvamVjdFRhc2tzKGlkKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKHByb2plY3RMaXN0LmZpbHRlcihwcm9qZWN0ID0+IHByb2plY3QuaWQgPT09IGlkKVswXS50YXNrTGlzdClcbiAgICAgICAgcmV0dXJuIHByb2plY3RMaXN0LmZpbHRlcihwcm9qZWN0ID0+IHByb2plY3QuaWQgPT09IGlkKVswXS50YXNrTGlzdFxuICAgIH1cblxuICAgIGZ1bmN0aW9uIHJlbW92ZVByb2plY3QoaWQpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ2JlZm9yZScsIHByb2plY3RMaXN0KTtcbiAgICAgICAgcHJvamVjdExpc3QgPSBwcm9qZWN0TGlzdC5maWx0ZXIocHJvamVjdCA9PiBwcm9qZWN0LmlkICE9PSBpZCk7XG4gICAgICAgIGNvbnNvbGUubG9nKCdhZnRlcicsIHByb2plY3RMaXN0KTtcbiAgICAgICAgcmV0dXJuIHByb2plY3RMaXN0XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZ3JhYkN1cnJlbnRQcm9qZWN0KCkge1xuICAgICAgICByZXR1cm4gY3VycmVudFByb2plY3Q7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZ3JhYlByb2plY3RMaXN0KCkge1xuICAgICAgICByZXR1cm4gcHJvamVjdExpc3Q7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gY3JlYXRlUHJvamVjdCgpIHtcbiAgICAgICAgcHJvamVjdFRpdGxlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3Byb2plY3RUaXRsZScpLnZhbHVlO1xuICAgICAgICBjb25zdCBwcm9qZWN0SWQgPSBjcmVhdGVQcm9qZWN0SWQoKVxuICAgICAgICBjb25zdCBwcm9qZWN0VGFza3MgPSBbXTtcblxuICAgICAgICBpZiAocHJvamVjdFRpdGxlID09PSAnJykgcmV0dXJuXG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgcHJvamVjdCA9IG5ld1Byb2plY3QocHJvamVjdFRpdGxlLCBwcm9qZWN0VGFza3MsIHByb2plY3RJZCk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhwcm9qZWN0KTtcbiAgICAgICAgICAgIGFkZFRvUHJvamVjdExpc3QocHJvamVjdCk7XG4gICAgICAgICAgICBzdG9yZUxvY2FsLnN0b3JlUHJvamVjdHMoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGNyZWF0ZVByb2plY3RJZCgpIHtcbiAgICAgICAgbGV0IGlkO1xuICAgICAgICBpZiAocHJvamVjdExpc3QubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gaWQgPSAwO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIGlkID0gcHJvamVjdExpc3RbcHJvamVjdExpc3QubGVuZ3RoIC0gMV0uaWQgKyAxO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gYWRkVG9Qcm9qZWN0TGlzdChwcm9qZWN0KSB7XG4gICAgICAgIHByb2plY3RMaXN0LnB1c2gocHJvamVjdCk7XG4gICAgICAgIGNvbnNvbGUubG9nKHByb2plY3RMaXN0KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiByZXNldCgpIHtcbiAgICAgICAgbGV0IHByb2plY3RUaXRsZVZhbHVlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3Byb2plY3RUaXRsZScpO1xuICAgICAgICBwcm9qZWN0VGl0bGVWYWx1ZS52YWx1ZSA9ICcnO1xuICAgICAgICBwcm9qZWN0VGl0bGUgPSAnJztcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBzdWJtaXRQcm9qZWN0KCkge1xuICAgICAgICBjb25zdCBjcmVhdGVQcm9qZWN0QnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2NyZWF0ZVByb2plY3QnKTtcblxuICAgICAgICBjcmVhdGVQcm9qZWN0QnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY3JlYXRlUHJvamVjdCgpO1xuICAgICAgICAgICAgaWYgKHByb2plY3RUaXRsZSA9PT0gJycpIHJldHVyblxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgbGV0IHByb2plY3QgPSBwcm9qZWN0TGlzdFtwcm9qZWN0TGlzdC5sZW5ndGggLTFdO1xuXG4gICAgICAgICAgICAgICAgcmVuZGVyUHJvamVjdC5kaXNwbGF5UHJvamVjdChwcm9qZWN0KTtcbiAgICAgICAgICAgICAgICByZXNldCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdyYWJQcm9qZWN0SWQoZSkge1xuICAgICAgICBsZXQgcHJvamVjdElkID0gcGFyc2VJbnQoZS50YXJnZXQuZ2V0QXR0cmlidXRlKCdkYXRhLXByb2plY3RJZCcpKTtcblxuICAgICAgICBjdXJyZW50UHJvamVjdCA9IHByb2plY3RJZDtcblxuICAgICAgICByZXR1cm4gY3VycmVudFByb2plY3Q7XG4gICAgfVxuXG4gICAgcmV0dXJuIHsgc3VibWl0UHJvamVjdCxcbiAgICAgICAgICAgICBncmFiUHJvamVjdElkLFxuICAgICAgICAgICAgIGdyYWJDdXJyZW50UHJvamVjdCwgXG4gICAgICAgICAgICAgZ3JhYlByb2plY3RMaXN0LCBcbiAgICAgICAgICAgICBwcm9qZWN0TGlzdCwgXG4gICAgICAgICAgICAgdXBkYXRlR2VuZXJhbExpc3QsXG4gICAgICAgICAgICAgdXBkYXRlUHJvamVjdCwgXG4gICAgICAgICAgICAgZ3JhYkN1cnJlbnRQcm9qZWN0VGFza3MsIFxuICAgICAgICAgICAgIHJlbW92ZVByb2plY3QsXG4gICAgICAgICAgICAgYWRkVG9Qcm9qZWN0TGlzdCB9XG59KSgpXG5cbmV4cG9ydCB7IHByb2plY3RzIH1cblxuIiwiLyoqXG4gKiBAbmFtZSB0b0RhdGVcbiAqIEBjYXRlZ29yeSBDb21tb24gSGVscGVyc1xuICogQHN1bW1hcnkgQ29udmVydCB0aGUgZ2l2ZW4gYXJndW1lbnQgdG8gYW4gaW5zdGFuY2Ugb2YgRGF0ZS5cbiAqXG4gKiBAZGVzY3JpcHRpb25cbiAqIENvbnZlcnQgdGhlIGdpdmVuIGFyZ3VtZW50IHRvIGFuIGluc3RhbmNlIG9mIERhdGUuXG4gKlxuICogSWYgdGhlIGFyZ3VtZW50IGlzIGFuIGluc3RhbmNlIG9mIERhdGUsIHRoZSBmdW5jdGlvbiByZXR1cm5zIGl0cyBjbG9uZS5cbiAqXG4gKiBJZiB0aGUgYXJndW1lbnQgaXMgYSBudW1iZXIsIGl0IGlzIHRyZWF0ZWQgYXMgYSB0aW1lc3RhbXAuXG4gKlxuICogSWYgdGhlIGFyZ3VtZW50IGlzIG5vbmUgb2YgdGhlIGFib3ZlLCB0aGUgZnVuY3Rpb24gcmV0dXJucyBJbnZhbGlkIERhdGUuXG4gKlxuICogKipOb3RlKio6ICphbGwqIERhdGUgYXJndW1lbnRzIHBhc3NlZCB0byBhbnkgKmRhdGUtZm5zKiBmdW5jdGlvbiBpcyBwcm9jZXNzZWQgYnkgYHRvRGF0ZWAuXG4gKlxuICogQHR5cGVQYXJhbSBEYXRlVHlwZSAtIFRoZSBgRGF0ZWAgdHlwZSwgdGhlIGZ1bmN0aW9uIG9wZXJhdGVzIG9uLiBHZXRzIGluZmVycmVkIGZyb20gcGFzc2VkIGFyZ3VtZW50cy4gQWxsb3dzIHRvIHVzZSBleHRlbnNpb25zIGxpa2UgW2BVVENEYXRlYF0oaHR0cHM6Ly9naXRodWIuY29tL2RhdGUtZm5zL3V0YykuXG4gKlxuICogQHBhcmFtIGFyZ3VtZW50IC0gVGhlIHZhbHVlIHRvIGNvbnZlcnRcbiAqXG4gKiBAcmV0dXJucyBUaGUgcGFyc2VkIGRhdGUgaW4gdGhlIGxvY2FsIHRpbWUgem9uZVxuICpcbiAqIEBleGFtcGxlXG4gKiAvLyBDbG9uZSB0aGUgZGF0ZTpcbiAqIGNvbnN0IHJlc3VsdCA9IHRvRGF0ZShuZXcgRGF0ZSgyMDE0LCAxLCAxMSwgMTEsIDMwLCAzMCkpXG4gKiAvLz0+IFR1ZSBGZWIgMTEgMjAxNCAxMTozMDozMFxuICpcbiAqIEBleGFtcGxlXG4gKiAvLyBDb252ZXJ0IHRoZSB0aW1lc3RhbXAgdG8gZGF0ZTpcbiAqIGNvbnN0IHJlc3VsdCA9IHRvRGF0ZSgxMzkyMDk4NDMwMDAwKVxuICogLy89PiBUdWUgRmViIDExIDIwMTQgMTE6MzA6MzBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHRvRGF0ZShhcmd1bWVudCkge1xuICBjb25zdCBhcmdTdHIgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoYXJndW1lbnQpO1xuXG4gIC8vIENsb25lIHRoZSBkYXRlXG4gIGlmIChcbiAgICBhcmd1bWVudCBpbnN0YW5jZW9mIERhdGUgfHxcbiAgICAodHlwZW9mIGFyZ3VtZW50ID09PSBcIm9iamVjdFwiICYmIGFyZ1N0ciA9PT0gXCJbb2JqZWN0IERhdGVdXCIpXG4gICkge1xuICAgIC8vIFByZXZlbnQgdGhlIGRhdGUgdG8gbG9zZSB0aGUgbWlsbGlzZWNvbmRzIHdoZW4gcGFzc2VkIHRvIG5ldyBEYXRlKCkgaW4gSUUxMFxuICAgIHJldHVybiBuZXcgYXJndW1lbnQuY29uc3RydWN0b3IoK2FyZ3VtZW50KTtcbiAgfSBlbHNlIGlmIChcbiAgICB0eXBlb2YgYXJndW1lbnQgPT09IFwibnVtYmVyXCIgfHxcbiAgICBhcmdTdHIgPT09IFwiW29iamVjdCBOdW1iZXJdXCIgfHxcbiAgICB0eXBlb2YgYXJndW1lbnQgPT09IFwic3RyaW5nXCIgfHxcbiAgICBhcmdTdHIgPT09IFwiW29iamVjdCBTdHJpbmddXCJcbiAgKSB7XG4gICAgLy8gVE9ETzogQ2FuIHdlIGdldCByaWQgb2YgYXM/XG4gICAgcmV0dXJuIG5ldyBEYXRlKGFyZ3VtZW50KTtcbiAgfSBlbHNlIHtcbiAgICAvLyBUT0RPOiBDYW4gd2UgZ2V0IHJpZCBvZiBhcz9cbiAgICByZXR1cm4gbmV3IERhdGUoTmFOKTtcbiAgfVxufVxuXG4vLyBGYWxsYmFjayBmb3IgbW9kdWxhcml6ZWQgaW1wb3J0czpcbmV4cG9ydCBkZWZhdWx0IHRvRGF0ZTtcbiIsImltcG9ydCB7IHRvRGF0ZSB9IGZyb20gXCIuL3RvRGF0ZS5tanNcIjtcblxuLyoqXG4gKiBAbmFtZSBzdGFydE9mRGF5XG4gKiBAY2F0ZWdvcnkgRGF5IEhlbHBlcnNcbiAqIEBzdW1tYXJ5IFJldHVybiB0aGUgc3RhcnQgb2YgYSBkYXkgZm9yIHRoZSBnaXZlbiBkYXRlLlxuICpcbiAqIEBkZXNjcmlwdGlvblxuICogUmV0dXJuIHRoZSBzdGFydCBvZiBhIGRheSBmb3IgdGhlIGdpdmVuIGRhdGUuXG4gKiBUaGUgcmVzdWx0IHdpbGwgYmUgaW4gdGhlIGxvY2FsIHRpbWV6b25lLlxuICpcbiAqIEB0eXBlUGFyYW0gRGF0ZVR5cGUgLSBUaGUgYERhdGVgIHR5cGUsIHRoZSBmdW5jdGlvbiBvcGVyYXRlcyBvbi4gR2V0cyBpbmZlcnJlZCBmcm9tIHBhc3NlZCBhcmd1bWVudHMuIEFsbG93cyB0byB1c2UgZXh0ZW5zaW9ucyBsaWtlIFtgVVRDRGF0ZWBdKGh0dHBzOi8vZ2l0aHViLmNvbS9kYXRlLWZucy91dGMpLlxuICpcbiAqIEBwYXJhbSBkYXRlIC0gVGhlIG9yaWdpbmFsIGRhdGVcbiAqXG4gKiBAcmV0dXJucyBUaGUgc3RhcnQgb2YgYSBkYXlcbiAqXG4gKiBAZXhhbXBsZVxuICogLy8gVGhlIHN0YXJ0IG9mIGEgZGF5IGZvciAyIFNlcHRlbWJlciAyMDE0IDExOjU1OjAwOlxuICogY29uc3QgcmVzdWx0ID0gc3RhcnRPZkRheShuZXcgRGF0ZSgyMDE0LCA4LCAyLCAxMSwgNTUsIDApKVxuICogLy89PiBUdWUgU2VwIDAyIDIwMTQgMDA6MDA6MDBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHN0YXJ0T2ZEYXkoZGF0ZSkge1xuICBjb25zdCBfZGF0ZSA9IHRvRGF0ZShkYXRlKTtcbiAgX2RhdGUuc2V0SG91cnMoMCwgMCwgMCwgMCk7XG4gIHJldHVybiBfZGF0ZTtcbn1cblxuLy8gRmFsbGJhY2sgZm9yIG1vZHVsYXJpemVkIGltcG9ydHM6XG5leHBvcnQgZGVmYXVsdCBzdGFydE9mRGF5O1xuIiwiaW1wb3J0IHsgaXNTYW1lRGF5IH0gZnJvbSBcIi4vaXNTYW1lRGF5Lm1qc1wiO1xuXG4vKipcbiAqIEBuYW1lIGlzVG9kYXlcbiAqIEBjYXRlZ29yeSBEYXkgSGVscGVyc1xuICogQHN1bW1hcnkgSXMgdGhlIGdpdmVuIGRhdGUgdG9kYXk/XG4gKiBAcHVyZSBmYWxzZVxuICpcbiAqIEBkZXNjcmlwdGlvblxuICogSXMgdGhlIGdpdmVuIGRhdGUgdG9kYXk/XG4gKlxuICogQHR5cGVQYXJhbSBEYXRlVHlwZSAtIFRoZSBgRGF0ZWAgdHlwZSwgdGhlIGZ1bmN0aW9uIG9wZXJhdGVzIG9uLiBHZXRzIGluZmVycmVkIGZyb20gcGFzc2VkIGFyZ3VtZW50cy4gQWxsb3dzIHRvIHVzZSBleHRlbnNpb25zIGxpa2UgW2BVVENEYXRlYF0oaHR0cHM6Ly9naXRodWIuY29tL2RhdGUtZm5zL3V0YykuXG4gKlxuICogQHBhcmFtIGRhdGUgLSBUaGUgZGF0ZSB0byBjaGVja1xuICpcbiAqIEByZXR1cm5zIFRoZSBkYXRlIGlzIHRvZGF5XG4gKlxuICogQGV4YW1wbGVcbiAqIC8vIElmIHRvZGF5IGlzIDYgT2N0b2JlciAyMDE0LCBpcyA2IE9jdG9iZXIgMTQ6MDA6MDAgdG9kYXk/XG4gKiBjb25zdCByZXN1bHQgPSBpc1RvZGF5KG5ldyBEYXRlKDIwMTQsIDksIDYsIDE0LCAwKSlcbiAqIC8vPT4gdHJ1ZVxuICovXG5leHBvcnQgZnVuY3Rpb24gaXNUb2RheShkYXRlKSB7XG4gIHJldHVybiBpc1NhbWVEYXkoZGF0ZSwgRGF0ZS5ub3coKSk7XG59XG5cbi8vIEZhbGxiYWNrIGZvciBtb2R1bGFyaXplZCBpbXBvcnRzOlxuZXhwb3J0IGRlZmF1bHQgaXNUb2RheTtcbiIsImltcG9ydCB7IHN0YXJ0T2ZEYXkgfSBmcm9tIFwiLi9zdGFydE9mRGF5Lm1qc1wiO1xuXG4vKipcbiAqIEBuYW1lIGlzU2FtZURheVxuICogQGNhdGVnb3J5IERheSBIZWxwZXJzXG4gKiBAc3VtbWFyeSBBcmUgdGhlIGdpdmVuIGRhdGVzIGluIHRoZSBzYW1lIGRheSAoYW5kIHllYXIgYW5kIG1vbnRoKT9cbiAqXG4gKiBAZGVzY3JpcHRpb25cbiAqIEFyZSB0aGUgZ2l2ZW4gZGF0ZXMgaW4gdGhlIHNhbWUgZGF5IChhbmQgeWVhciBhbmQgbW9udGgpP1xuICpcbiAqIEB0eXBlUGFyYW0gRGF0ZVR5cGUgLSBUaGUgYERhdGVgIHR5cGUsIHRoZSBmdW5jdGlvbiBvcGVyYXRlcyBvbi4gR2V0cyBpbmZlcnJlZCBmcm9tIHBhc3NlZCBhcmd1bWVudHMuIEFsbG93cyB0byB1c2UgZXh0ZW5zaW9ucyBsaWtlIFtgVVRDRGF0ZWBdKGh0dHBzOi8vZ2l0aHViLmNvbS9kYXRlLWZucy91dGMpLlxuICpcbiAqIEBwYXJhbSBkYXRlTGVmdCAtIFRoZSBmaXJzdCBkYXRlIHRvIGNoZWNrXG4gKiBAcGFyYW0gZGF0ZVJpZ2h0IC0gVGhlIHNlY29uZCBkYXRlIHRvIGNoZWNrXG5cbiAqIEByZXR1cm5zIFRoZSBkYXRlcyBhcmUgaW4gdGhlIHNhbWUgZGF5IChhbmQgeWVhciBhbmQgbW9udGgpXG4gKlxuICogQGV4YW1wbGVcbiAqIC8vIEFyZSA0IFNlcHRlbWJlciAwNjowMDowMCBhbmQgNCBTZXB0ZW1iZXIgMTg6MDA6MDAgaW4gdGhlIHNhbWUgZGF5P1xuICogY29uc3QgcmVzdWx0ID0gaXNTYW1lRGF5KG5ldyBEYXRlKDIwMTQsIDgsIDQsIDYsIDApLCBuZXcgRGF0ZSgyMDE0LCA4LCA0LCAxOCwgMCkpXG4gKiAvLz0+IHRydWVcbiAqXG4gKiBAZXhhbXBsZVxuICogLy8gQXJlIDQgU2VwdGVtYmVyIGFuZCA0IE9jdG9iZXIgaW4gdGhlIHNhbWUgZGF5P1xuICogY29uc3QgcmVzdWx0ID0gaXNTYW1lRGF5KG5ldyBEYXRlKDIwMTQsIDgsIDQpLCBuZXcgRGF0ZSgyMDE0LCA5LCA0KSlcbiAqIC8vPT4gZmFsc2VcbiAqXG4gKiBAZXhhbXBsZVxuICogLy8gQXJlIDQgU2VwdGVtYmVyLCAyMDE0IGFuZCA0IFNlcHRlbWJlciwgMjAxNSBpbiB0aGUgc2FtZSBkYXk/XG4gKiBjb25zdCByZXN1bHQgPSBpc1NhbWVEYXkobmV3IERhdGUoMjAxNCwgOCwgNCksIG5ldyBEYXRlKDIwMTUsIDgsIDQpKVxuICogLy89PiBmYWxzZVxuICovXG5leHBvcnQgZnVuY3Rpb24gaXNTYW1lRGF5KGRhdGVMZWZ0LCBkYXRlUmlnaHQpIHtcbiAgY29uc3QgZGF0ZUxlZnRTdGFydE9mRGF5ID0gc3RhcnRPZkRheShkYXRlTGVmdCk7XG4gIGNvbnN0IGRhdGVSaWdodFN0YXJ0T2ZEYXkgPSBzdGFydE9mRGF5KGRhdGVSaWdodCk7XG5cbiAgcmV0dXJuICtkYXRlTGVmdFN0YXJ0T2ZEYXkgPT09ICtkYXRlUmlnaHRTdGFydE9mRGF5O1xufVxuXG4vLyBGYWxsYmFjayBmb3IgbW9kdWxhcml6ZWQgaW1wb3J0czpcbmV4cG9ydCBkZWZhdWx0IGlzU2FtZURheTtcbiIsImxldCBkZWZhdWx0T3B0aW9ucyA9IHt9O1xuXG5leHBvcnQgZnVuY3Rpb24gZ2V0RGVmYXVsdE9wdGlvbnMoKSB7XG4gIHJldHVybiBkZWZhdWx0T3B0aW9ucztcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHNldERlZmF1bHRPcHRpb25zKG5ld09wdGlvbnMpIHtcbiAgZGVmYXVsdE9wdGlvbnMgPSBuZXdPcHRpb25zO1xufVxuIiwiaW1wb3J0IHsgdG9EYXRlIH0gZnJvbSBcIi4vdG9EYXRlLm1qc1wiO1xuaW1wb3J0IHsgZ2V0RGVmYXVsdE9wdGlvbnMgfSBmcm9tIFwiLi9fbGliL2RlZmF1bHRPcHRpb25zLm1qc1wiO1xuXG4vKipcbiAqIFRoZSB7QGxpbmsgc3RhcnRPZldlZWt9IGZ1bmN0aW9uIG9wdGlvbnMuXG4gKi9cblxuLyoqXG4gKiBAbmFtZSBzdGFydE9mV2Vla1xuICogQGNhdGVnb3J5IFdlZWsgSGVscGVyc1xuICogQHN1bW1hcnkgUmV0dXJuIHRoZSBzdGFydCBvZiBhIHdlZWsgZm9yIHRoZSBnaXZlbiBkYXRlLlxuICpcbiAqIEBkZXNjcmlwdGlvblxuICogUmV0dXJuIHRoZSBzdGFydCBvZiBhIHdlZWsgZm9yIHRoZSBnaXZlbiBkYXRlLlxuICogVGhlIHJlc3VsdCB3aWxsIGJlIGluIHRoZSBsb2NhbCB0aW1lem9uZS5cbiAqXG4gKiBAdHlwZVBhcmFtIERhdGVUeXBlIC0gVGhlIGBEYXRlYCB0eXBlLCB0aGUgZnVuY3Rpb24gb3BlcmF0ZXMgb24uIEdldHMgaW5mZXJyZWQgZnJvbSBwYXNzZWQgYXJndW1lbnRzLiBBbGxvd3MgdG8gdXNlIGV4dGVuc2lvbnMgbGlrZSBbYFVUQ0RhdGVgXShodHRwczovL2dpdGh1Yi5jb20vZGF0ZS1mbnMvdXRjKS5cbiAqXG4gKiBAcGFyYW0gZGF0ZSAtIFRoZSBvcmlnaW5hbCBkYXRlXG4gKiBAcGFyYW0gb3B0aW9ucyAtIEFuIG9iamVjdCB3aXRoIG9wdGlvbnNcbiAqXG4gKiBAcmV0dXJucyBUaGUgc3RhcnQgb2YgYSB3ZWVrXG4gKlxuICogQGV4YW1wbGVcbiAqIC8vIFRoZSBzdGFydCBvZiBhIHdlZWsgZm9yIDIgU2VwdGVtYmVyIDIwMTQgMTE6NTU6MDA6XG4gKiBjb25zdCByZXN1bHQgPSBzdGFydE9mV2VlayhuZXcgRGF0ZSgyMDE0LCA4LCAyLCAxMSwgNTUsIDApKVxuICogLy89PiBTdW4gQXVnIDMxIDIwMTQgMDA6MDA6MDBcbiAqXG4gKiBAZXhhbXBsZVxuICogLy8gSWYgdGhlIHdlZWsgc3RhcnRzIG9uIE1vbmRheSwgdGhlIHN0YXJ0IG9mIHRoZSB3ZWVrIGZvciAyIFNlcHRlbWJlciAyMDE0IDExOjU1OjAwOlxuICogY29uc3QgcmVzdWx0ID0gc3RhcnRPZldlZWsobmV3IERhdGUoMjAxNCwgOCwgMiwgMTEsIDU1LCAwKSwgeyB3ZWVrU3RhcnRzT246IDEgfSlcbiAqIC8vPT4gTW9uIFNlcCAwMSAyMDE0IDAwOjAwOjAwXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBzdGFydE9mV2VlayhkYXRlLCBvcHRpb25zKSB7XG4gIGNvbnN0IGRlZmF1bHRPcHRpb25zID0gZ2V0RGVmYXVsdE9wdGlvbnMoKTtcbiAgY29uc3Qgd2Vla1N0YXJ0c09uID1cbiAgICBvcHRpb25zPy53ZWVrU3RhcnRzT24gPz9cbiAgICBvcHRpb25zPy5sb2NhbGU/Lm9wdGlvbnM/LndlZWtTdGFydHNPbiA/P1xuICAgIGRlZmF1bHRPcHRpb25zLndlZWtTdGFydHNPbiA/P1xuICAgIGRlZmF1bHRPcHRpb25zLmxvY2FsZT8ub3B0aW9ucz8ud2Vla1N0YXJ0c09uID8/XG4gICAgMDtcblxuICBjb25zdCBfZGF0ZSA9IHRvRGF0ZShkYXRlKTtcbiAgY29uc3QgZGF5ID0gX2RhdGUuZ2V0RGF5KCk7XG4gIGNvbnN0IGRpZmYgPSAoZGF5IDwgd2Vla1N0YXJ0c09uID8gNyA6IDApICsgZGF5IC0gd2Vla1N0YXJ0c09uO1xuXG4gIF9kYXRlLnNldERhdGUoX2RhdGUuZ2V0RGF0ZSgpIC0gZGlmZik7XG4gIF9kYXRlLnNldEhvdXJzKDAsIDAsIDAsIDApO1xuICByZXR1cm4gX2RhdGU7XG59XG5cbi8vIEZhbGxiYWNrIGZvciBtb2R1bGFyaXplZCBpbXBvcnRzOlxuZXhwb3J0IGRlZmF1bHQgc3RhcnRPZldlZWs7XG4iLCJpbXBvcnQgeyBpc1NhbWVXZWVrIH0gZnJvbSBcIi4vaXNTYW1lV2Vlay5tanNcIjtcblxuLyoqXG4gKiBUaGUge0BsaW5rIGlzVGhpc1dlZWt9IGZ1bmN0aW9uIG9wdGlvbnMuXG4gKi9cblxuLyoqXG4gKiBAbmFtZSBpc1RoaXNXZWVrXG4gKiBAY2F0ZWdvcnkgV2VlayBIZWxwZXJzXG4gKiBAc3VtbWFyeSBJcyB0aGUgZ2l2ZW4gZGF0ZSBpbiB0aGUgc2FtZSB3ZWVrIGFzIHRoZSBjdXJyZW50IGRhdGU/XG4gKiBAcHVyZSBmYWxzZVxuICpcbiAqIEBkZXNjcmlwdGlvblxuICogSXMgdGhlIGdpdmVuIGRhdGUgaW4gdGhlIHNhbWUgd2VlayBhcyB0aGUgY3VycmVudCBkYXRlP1xuICpcbiAqIEB0eXBlUGFyYW0gRGF0ZVR5cGUgLSBUaGUgYERhdGVgIHR5cGUsIHRoZSBmdW5jdGlvbiBvcGVyYXRlcyBvbi4gR2V0cyBpbmZlcnJlZCBmcm9tIHBhc3NlZCBhcmd1bWVudHMuIEFsbG93cyB0byB1c2UgZXh0ZW5zaW9ucyBsaWtlIFtgVVRDRGF0ZWBdKGh0dHBzOi8vZ2l0aHViLmNvbS9kYXRlLWZucy91dGMpLlxuICpcbiAqIEBwYXJhbSBkYXRlIC0gVGhlIGRhdGUgdG8gY2hlY2tcbiAqIEBwYXJhbSBvcHRpb25zIC0gVGhlIG9iamVjdCB3aXRoIG9wdGlvbnNcbiAqXG4gKiBAcmV0dXJucyBUaGUgZGF0ZSBpcyBpbiB0aGlzIHdlZWtcbiAqXG4gKiBAZXhhbXBsZVxuICogLy8gSWYgdG9kYXkgaXMgMjUgU2VwdGVtYmVyIDIwMTQsIGlzIDIxIFNlcHRlbWJlciAyMDE0IGluIHRoaXMgd2Vlaz9cbiAqIGNvbnN0IHJlc3VsdCA9IGlzVGhpc1dlZWsobmV3IERhdGUoMjAxNCwgOCwgMjEpKVxuICogLy89PiB0cnVlXG4gKlxuICogQGV4YW1wbGVcbiAqIC8vIElmIHRvZGF5IGlzIDI1IFNlcHRlbWJlciAyMDE0IGFuZCB3ZWVrIHN0YXJ0cyB3aXRoIE1vbmRheVxuICogLy8gaXMgMjEgU2VwdGVtYmVyIDIwMTQgaW4gdGhpcyB3ZWVrP1xuICogY29uc3QgcmVzdWx0ID0gaXNUaGlzV2VlayhuZXcgRGF0ZSgyMDE0LCA4LCAyMSksIHsgd2Vla1N0YXJ0c09uOiAxIH0pXG4gKiAvLz0+IGZhbHNlXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpc1RoaXNXZWVrKGRhdGUsIG9wdGlvbnMpIHtcbiAgcmV0dXJuIGlzU2FtZVdlZWsoZGF0ZSwgRGF0ZS5ub3coKSwgb3B0aW9ucyk7XG59XG5cbi8vIEZhbGxiYWNrIGZvciBtb2R1bGFyaXplZCBpbXBvcnRzOlxuZXhwb3J0IGRlZmF1bHQgaXNUaGlzV2VlaztcbiIsImltcG9ydCB7IHN0YXJ0T2ZXZWVrIH0gZnJvbSBcIi4vc3RhcnRPZldlZWsubWpzXCI7XG5cbi8qKlxuICogVGhlIHtAbGluayBpc1NhbWVXZWVrfSBmdW5jdGlvbiBvcHRpb25zLlxuICovXG5cbi8qKlxuICogQG5hbWUgaXNTYW1lV2Vla1xuICogQGNhdGVnb3J5IFdlZWsgSGVscGVyc1xuICogQHN1bW1hcnkgQXJlIHRoZSBnaXZlbiBkYXRlcyBpbiB0aGUgc2FtZSB3ZWVrIChhbmQgbW9udGggYW5kIHllYXIpP1xuICpcbiAqIEBkZXNjcmlwdGlvblxuICogQXJlIHRoZSBnaXZlbiBkYXRlcyBpbiB0aGUgc2FtZSB3ZWVrIChhbmQgbW9udGggYW5kIHllYXIpP1xuICpcbiAqIEB0eXBlUGFyYW0gRGF0ZVR5cGUgLSBUaGUgYERhdGVgIHR5cGUsIHRoZSBmdW5jdGlvbiBvcGVyYXRlcyBvbi4gR2V0cyBpbmZlcnJlZCBmcm9tIHBhc3NlZCBhcmd1bWVudHMuIEFsbG93cyB0byB1c2UgZXh0ZW5zaW9ucyBsaWtlIFtgVVRDRGF0ZWBdKGh0dHBzOi8vZ2l0aHViLmNvbS9kYXRlLWZucy91dGMpLlxuICpcbiAqIEBwYXJhbSBkYXRlTGVmdCAtIFRoZSBmaXJzdCBkYXRlIHRvIGNoZWNrXG4gKiBAcGFyYW0gZGF0ZVJpZ2h0IC0gVGhlIHNlY29uZCBkYXRlIHRvIGNoZWNrXG4gKiBAcGFyYW0gb3B0aW9ucyAtIEFuIG9iamVjdCB3aXRoIG9wdGlvbnNcbiAqXG4gKiBAcmV0dXJucyBUaGUgZGF0ZXMgYXJlIGluIHRoZSBzYW1lIHdlZWsgKGFuZCBtb250aCBhbmQgeWVhcilcbiAqXG4gKiBAZXhhbXBsZVxuICogLy8gQXJlIDMxIEF1Z3VzdCAyMDE0IGFuZCA0IFNlcHRlbWJlciAyMDE0IGluIHRoZSBzYW1lIHdlZWs/XG4gKiBjb25zdCByZXN1bHQgPSBpc1NhbWVXZWVrKG5ldyBEYXRlKDIwMTQsIDcsIDMxKSwgbmV3IERhdGUoMjAxNCwgOCwgNCkpXG4gKiAvLz0+IHRydWVcbiAqXG4gKiBAZXhhbXBsZVxuICogLy8gSWYgd2VlayBzdGFydHMgd2l0aCBNb25kYXksXG4gKiAvLyBhcmUgMzEgQXVndXN0IDIwMTQgYW5kIDQgU2VwdGVtYmVyIDIwMTQgaW4gdGhlIHNhbWUgd2Vlaz9cbiAqIGNvbnN0IHJlc3VsdCA9IGlzU2FtZVdlZWsobmV3IERhdGUoMjAxNCwgNywgMzEpLCBuZXcgRGF0ZSgyMDE0LCA4LCA0KSwge1xuICogICB3ZWVrU3RhcnRzT246IDFcbiAqIH0pXG4gKiAvLz0+IGZhbHNlXG4gKlxuICogQGV4YW1wbGVcbiAqIC8vIEFyZSAxIEphbnVhcnkgMjAxNCBhbmQgMSBKYW51YXJ5IDIwMTUgaW4gdGhlIHNhbWUgd2Vlaz9cbiAqIGNvbnN0IHJlc3VsdCA9IGlzU2FtZVdlZWsobmV3IERhdGUoMjAxNCwgMCwgMSksIG5ldyBEYXRlKDIwMTUsIDAsIDEpKVxuICogLy89PiBmYWxzZVxuICovXG5leHBvcnQgZnVuY3Rpb24gaXNTYW1lV2VlayhkYXRlTGVmdCwgZGF0ZVJpZ2h0LCBvcHRpb25zKSB7XG4gIGNvbnN0IGRhdGVMZWZ0U3RhcnRPZldlZWsgPSBzdGFydE9mV2VlayhkYXRlTGVmdCwgb3B0aW9ucyk7XG4gIGNvbnN0IGRhdGVSaWdodFN0YXJ0T2ZXZWVrID0gc3RhcnRPZldlZWsoZGF0ZVJpZ2h0LCBvcHRpb25zKTtcblxuICByZXR1cm4gK2RhdGVMZWZ0U3RhcnRPZldlZWsgPT09ICtkYXRlUmlnaHRTdGFydE9mV2Vlaztcbn1cblxuLy8gRmFsbGJhY2sgZm9yIG1vZHVsYXJpemVkIGltcG9ydHM6XG5leHBvcnQgZGVmYXVsdCBpc1NhbWVXZWVrO1xuIiwiaW1wb3J0IHsgcHJvamVjdHMgfSBmcm9tIFwiLi9tYW5hZ2VQcm9qZWN0XCI7XG5pbXBvcnQgeyBpc1RvZGF5LCB0b0RhdGUsIGlzVGhpc1dlZWsgfSBmcm9tIFwiZGF0ZS1mbnNcIjtcbmltcG9ydCB7IEFkZHRvTGlzdCB9IGZyb20gXCIuL21hbmFnZUxpc3RcIjtcbmltcG9ydCB7IHN0b3JlTG9jYWwgfSBmcm9tIFwiLi9zdG9yYWdlXCI7XG5pbXBvcnQgeyBOZXdUYXNrIH0gZnJvbSBcIi4vbWFuYWdlVGFza1wiO1xuXG5jb25zdCByZW5kZXJUYXNrID0gKCgpID0+IHtcbiAgICBmdW5jdGlvbiBkaXNwbGF5QWxsVGFzayhpdGVtcywgZGlzcGxheSkge1xuICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcblxuICAgICAgICBjb250YWluZXIuc2V0QXR0cmlidXRlKCdkYXRhLXRhc2tJZCcsIGAke2l0ZW1zLmlkfWApXG5cbiAgICAgICAgY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ3Rhc2snKTtcblxuICAgICAgICBjb25zdCB0aXRsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpXG4gICAgICAgIGNvbnN0IGR1ZWRhdGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgY29uc3QgZGVzY3JpcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgY29uc3QgcHJpb3JpdHkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgY29uc3QgZGVsZXRlQnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7XG4gICAgICAgIGNvbnN0IGVkaXRCdG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTtcblxuICAgICAgICB0aXRsZS50ZXh0Q29udGVudCA9IGBUaXRsZTogJHtpdGVtcy50aXRsZX1gO1xuICAgICAgICBkdWVkYXRlLnRleHRDb250ZW50ID0gYER1ZSBEYXRlOiAke2l0ZW1zLmR1ZWRhdGV9YDtcbiAgICAgICAgZGVzY3JpcHRpb24udGV4dENvbnRlbnQgPSBgRGVzY3JpcHRpb246ICR7aXRlbXMuZGVzY3JpcHRpb259YDtcbiAgICAgICAgcHJpb3JpdHkudGV4dENvbnRlbnQgPSBgUHJpb3JpdHk6ICR7aXRlbXMucHJpb3JpdHl9YDtcbiAgICAgICAgZGVsZXRlQnRuLnRleHRDb250ZW50ID0gJ2RlbGV0ZSc7XG4gICAgICAgIGVkaXRCdG4udGV4dENvbnRlbnQgPSAnZWRpdCc7XG5cbiAgICAgICAgZGVsZXRlQnRuLnNldEF0dHJpYnV0ZSgnZGF0YS10YXNrSWQnLCBgJHtpdGVtcy5pZH1gKTtcblxuICAgICAgICBkZWxldGVCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiBpbml0RGVsQnRuKGl0ZW1zLmlkLCBpdGVtcy5wcm9qZWN0KSk7XG5cbiAgICAgICAgZWRpdEJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtpbml0RWRpdEJ0bihpdGVtcyl9KTtcblxuICAgICAgICBjb250YWluZXIuYXBwZW5kKHRpdGxlLCBkdWVkYXRlLCBkZXNjcmlwdGlvbiwgcHJpb3JpdHksIGRlbGV0ZUJ0biwgZWRpdEJ0bik7XG4gICAgICAgIGRpc3BsYXkuYXBwZW5kQ2hpbGQoY29udGFpbmVyKTtcblxuICAgICAgICByZXR1cm4gZGlzcGxheTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBpbml0RWRpdEJ0bih0YXNrKSB7XG4gICAgICAgIGNvbnN0IHRhc2tGb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI21haW4tZm9ybScpO1xuXG4gICAgICAgIHRhc2tGb3JtLmNsYXNzTGlzdC5hZGQoJ2VkaXQtbW9kZScpO1xuICAgICAgICB0YXNrRm9ybS5zZXRBdHRyaWJ1dGUoJ2RhdGEtdGFza0lkJywgYCR7dGFzay5pZH1gKTtcblxuICAgICAgICBsZXQgdGl0bGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGl0bGUnKTtcbiAgICAgICAgbGV0IGRlc2NyaXB0aW9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Rlc2NyaXB0aW9uJyk7XG4gICAgICAgIGxldCBkYXRlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RhdGUnKTtcbiAgICAgICAgbGV0IHByaW9yaXR5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ByaW9yaXR5Jyk7XG5cbiAgICAgICAgY29uc3QgdGFza1RpdGxlID0gdGFzay50aXRsZTtcbiAgICAgICAgY29uc3QgdGFza0Rlc2NyaXB0aW9uID0gdGFzay5kZXNjcmlwdGlvbjtcbiAgICAgICAgY29uc3QgdGFza0RhdGUgPSB0YXNrLmR1ZWRhdGU7XG4gICAgICAgIGNvbnN0IHRhc2tQcmlvcml0eSA9IHRhc2sucHJpb3JpdHk7XG5cbiAgICAgICAgdGl0bGUudmFsdWUgPSB0YXNrVGl0bGU7XG4gICAgICAgIGRlc2NyaXB0aW9uLnZhbHVlID0gdGFza0Rlc2NyaXB0aW9uO1xuICAgICAgICBkYXRlLnZhbHVlID0gdGFza0RhdGU7XG4gICAgICAgIHByaW9yaXR5LnZhbHVlID0gdGFza1ByaW9yaXR5O1xuXG4gICAgICAgIHRhc2tGb3JtLnJlbW92ZUF0dHJpYnV0ZSgnaGlkZGVuJyk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gaW5pdERlbEJ0bihpZCwgcHJvamVjdElkKSB7XG4gICAgICAgIGxldCBBbGx0YXNrID0gQWRkdG9MaXN0LnJlbW92ZVRhc2soaWQpO1xuICAgICAgICBjb25zdCBnZW5lcmFsTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNnZW5lcmFsJyk7XG5cbiAgICAgICAgcHJvamVjdHMudXBkYXRlR2VuZXJhbExpc3QoQWxsdGFzayk7XG4gICAgICAgIHByb2plY3RzLnVwZGF0ZVByb2plY3QocHJvamVjdElkKTtcbiAgICAgICAgc3RvcmVMb2NhbC5zdG9yZVByb2plY3RzKCk7XG5cbiAgICAgICAgd2hpbGUgKGdlbmVyYWxMaXN0Lmxhc3RFbGVtZW50Q2hpbGQpIGdlbmVyYWxMaXN0LnJlbW92ZUNoaWxkKGdlbmVyYWxMaXN0Lmxhc3RFbGVtZW50Q2hpbGQpO1xuICAgICAgICBcbiAgICAgICAgdXBkYXRlRGlzcGxheShwcm9qZWN0SWQpO1xuXG4gICAgICAgIGNvbnNvbGUubG9nKHByb2plY3RzLnByb2plY3RMaXN0KTtcbiAgICAgICAgY29uc29sZS5sb2cocHJvamVjdElkKVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdyYWJUYWIoKSB7XG4gICAgICAgIGxldCBjdXJyZW50VGFiID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2dlbmVyYWwnKS5nZXRBdHRyaWJ1dGUoJ2NsYXNzJyk7XG4gICAgICAgIHJldHVybiBjdXJyZW50VGFiO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHVwZGF0ZURpc3BsYXkoaWQpIHtcbiAgICAgICAgbGV0IHRhYiA9IGdyYWJUYWIoKTtcbiAgICAgICAgaWYgKHRhYiA9PT0gJ2luYm94VGFiJykgZGlzcGxheUluYm94KClcbiAgICAgICAgZWxzZSBpZiAodGFiID09PSAndG9kYXlUYWInKSBkaXNwbGF5RGFpbHkoKVxuICAgICAgICBlbHNlIGlmICh0YWIgPT09ICd3ZWVrVGFiJykgZGlzcGxheVdlZWtseSgpXG4gICAgICAgIGVsc2UgaWYgKHRhYiA9PT0gYCR7aWR9YCAmJiBpZCAhPT0gMCkgcmVuZGVyUHJvamVjdC5kaXNwbGF5UHJvamVjdFRhc2tzKGlkKVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGRpc3BsYXlJbmJveCgpIHtcbiAgICAgICAgbGV0IGxpc3QgPSBwcm9qZWN0cy5ncmFiUHJvamVjdExpc3QoKVswXS50YXNrTGlzdDtcbiAgICAgICAgY29uc3QgZ2VuZXJhbExpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjZ2VuZXJhbCcpO1xuICAgICAgICBnZW5lcmFsTGlzdC5jbGFzc0xpc3QucmVwbGFjZShnZW5lcmFsTGlzdC5nZXRBdHRyaWJ1dGUoJ2NsYXNzJyksICdpbmJveFRhYicpO1xuXG4gICAgICAgIHdoaWxlIChnZW5lcmFsTGlzdC5sYXN0RWxlbWVudENoaWxkKSBnZW5lcmFsTGlzdC5yZW1vdmVDaGlsZChnZW5lcmFsTGlzdC5sYXN0RWxlbWVudENoaWxkKTtcbiAgICAgICAgY29uc29sZS5sb2cobGlzdClcbiAgICAgICAgbGlzdC5mb3JFYWNoKHRhc2sgPT4gZGlzcGxheUFsbFRhc2sodGFzaywgZ2VuZXJhbExpc3QpKTtcbiAgICAgICAgY29uc29sZS5sb2cocHJvamVjdHMucHJvamVjdExpc3QpXG4gICAgICAgIFxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGRpc3BsYXlEYWlseSgpIHtcbiAgICAgICAgbGV0IGxpc3QgPSBwcm9qZWN0cy5ncmFiUHJvamVjdExpc3QoKVswXS50YXNrTGlzdDtcbiAgICAgICAgY29uc3QgZ2VuZXJhbExpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjZ2VuZXJhbCcpO1xuICAgICAgICBnZW5lcmFsTGlzdC5jbGFzc0xpc3QucmVwbGFjZShnZW5lcmFsTGlzdC5nZXRBdHRyaWJ1dGUoJ2NsYXNzJyksICd0b2RheVRhYicpO1xuXG4gICAgICAgIHdoaWxlIChnZW5lcmFsTGlzdC5sYXN0RWxlbWVudENoaWxkKSBnZW5lcmFsTGlzdC5yZW1vdmVDaGlsZChnZW5lcmFsTGlzdC5sYXN0RWxlbWVudENoaWxkKTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IGRhaWx5VGFza3MgPSBsaXN0LmZpbHRlcih0YXNrID0+IGlzVG9kYXkodG9EYXRlKHRhc2suZHVlZGF0ZSkpKTtcbiAgICAgICAgXG4gICAgICAgIGRhaWx5VGFza3MuZm9yRWFjaCh0YXNrID0+IGRpc3BsYXlBbGxUYXNrKHRhc2ssIGdlbmVyYWxMaXN0KSk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZGlzcGxheVdlZWtseSgpIHtcbiAgICAgICAgbGV0IGxpc3QgPSBwcm9qZWN0cy5ncmFiUHJvamVjdExpc3QoKVswXS50YXNrTGlzdDtcbiAgICAgICAgY29uc3QgZ2VuZXJhbExpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjZ2VuZXJhbCcpO1xuICAgICAgICBnZW5lcmFsTGlzdC5jbGFzc0xpc3QucmVwbGFjZShnZW5lcmFsTGlzdC5nZXRBdHRyaWJ1dGUoJ2NsYXNzJyksICd3ZWVrVGFiJyk7XG5cbiAgICAgICAgd2hpbGUgKGdlbmVyYWxMaXN0Lmxhc3RFbGVtZW50Q2hpbGQpIGdlbmVyYWxMaXN0LnJlbW92ZUNoaWxkKGdlbmVyYWxMaXN0Lmxhc3RFbGVtZW50Q2hpbGQpO1xuXG4gICAgICAgIGNvbnN0IHdlZWtseVRhc2tzID0gbGlzdC5maWx0ZXIodGFzayA9PiBpc1RoaXNXZWVrKHRvRGF0ZSh0YXNrLmR1ZWRhdGUpKSk7XG5cbiAgICAgICAgd2Vla2x5VGFza3MuZm9yRWFjaCh0YXNrID0+IGRpc3BsYXlBbGxUYXNrKHRhc2ssIGdlbmVyYWxMaXN0KSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHsgZGlzcGxheUluYm94LCBkaXNwbGF5RGFpbHksIGRpc3BsYXlXZWVrbHksIGRpc3BsYXlBbGxUYXNrLCB1cGRhdGVEaXNwbGF5LCBncmFiVGFiIH1cbn0pKClcblxuY29uc3QgcmVuZGVyUHJvamVjdCA9ICgoKSA9PiB7XG4gICAgZnVuY3Rpb24gZGlzcGxheVByb2plY3QocHJvamVjdCkge1xuICAgICAgICBjb25zdCBwcm9qZWN0RGlzcGxheSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5hbGwtcHJvamVjdHMnKTtcbiAgICAgICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG5cbiAgICAgICAgY29uc3QgcHJvamVjdFRpdGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIGNvbnN0IHByb2plY3RUYXNrQnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7XG4gICAgICAgIGNvbnN0IHByb2plY3REZWxCdG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTtcblxuICAgICAgICBjb250YWluZXIuY2xhc3NMaXN0LmFkZChgcHJvamVjdC0ke3Byb2plY3QuaWR9YCk7XG4gICAgICAgIGNvbnRhaW5lci5zZXRBdHRyaWJ1dGUoJ2RhdGEtcHJvamVjdElkJywgYCR7cHJvamVjdC5pZH1gKTtcbiAgICAgICAgcHJvamVjdFRhc2tCdG4uc2V0QXR0cmlidXRlKCdkYXRhLXByb2plY3RJZCcsIGAke3Byb2plY3QuaWR9YCk7XG4gICAgICAgIHByb2plY3RUYXNrQnRuLnNldEF0dHJpYnV0ZSgnaWQnLCBgcHJvamVjdC0ke3Byb2plY3QuaWR9YCk7XG5cbiAgICAgICAgcHJvamVjdFRpdGxlLnRleHRDb250ZW50ID0gYCR7cHJvamVjdC50aXRsZX1gO1xuICAgICAgICBwcm9qZWN0VGFza0J0bi50ZXh0Q29udGVudCA9ICcrJztcbiAgICAgICAgcHJvamVjdERlbEJ0bi50ZXh0Q29udGVudCA9ICdkZWxldGUnO1xuXG4gICAgICAgIGNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG4gICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgZGlzcGxheVByb2plY3RUYXNrcyhwcm9qZWN0LmlkKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcHJvamVjdFRhc2tCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xuICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdwcm9qZWN0IGlkJywgcHJvamVjdHMuZ3JhYlByb2plY3RJZChlKSk7XG4gICAgICAgICAgICBjb25zdCBuZXdUYXNrRm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNtYWluLWZvcm0nKTtcblxuICAgICAgICAgICAgcHJvamVjdHMuZ3JhYlByb2plY3RJZChlKTtcbiAgICAgICAgICAgIG5ld1Rhc2tGb3JtLnJlbW92ZUF0dHJpYnV0ZSgnaGlkZGVuJyk7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIH0pXG5cbiAgICAgICAgcHJvamVjdERlbEJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG4gICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgaW5pdERlbFByb2pCdG4ocHJvamVjdC5pZCk7XG4gICAgICAgIH0pXG5cbiAgICAgICAgY29udGFpbmVyLmFwcGVuZChwcm9qZWN0VGl0bGUsIHByb2plY3RUYXNrQnRuLCBwcm9qZWN0RGVsQnRuKTtcbiAgICAgICAgcHJvamVjdERpc3BsYXkuYXBwZW5kQ2hpbGQoY29udGFpbmVyKTtcblxuICAgICAgICByZXR1cm4gcHJvamVjdERpc3BsYXlcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBpbml0RGVsUHJvakJ0bihwcm9qZWN0SWQpIHtcbiAgICAgICAgcHJvamVjdHMucmVtb3ZlUHJvamVjdChwcm9qZWN0SWQpO1xuXG4gICAgICAgIGxldCB1cGRhdGVkUHJvamVjdHMgPSBwcm9qZWN0cy5ncmFiUHJvamVjdExpc3QoKTtcbiAgICAgICAgbGV0IHRhc2tMaXN0ID0gQWRkdG9MaXN0LlRvZG9MaXN0O1xuICAgICAgICBsZXQgdXBkYXRlZFRhc2tMaXN0ID0gdGFza0xpc3QuZmlsdGVyKHRhc2sgPT4gdGFzay5wcm9qZWN0ID09PSBwcm9qZWN0SWQpO1xuXG4gICAgICAgIHVwZGF0ZWRUYXNrTGlzdC5mb3JFYWNoKHRhc2sgPT4ge1xuICAgICAgICAgICAgbGV0IG5ld0xpc3QgPSBBZGR0b0xpc3QucmVtb3ZlVGFzayh0YXNrLmlkKTtcbiAgICAgICAgICAgIHByb2plY3RzLnVwZGF0ZUdlbmVyYWxMaXN0KG5ld0xpc3QpO1xuICAgICAgICB9KTtcblxuICAgICAgICBsZXQgcHJvamVjdHNEaXNwbGF5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmFsbC1wcm9qZWN0cycpO1xuICAgICAgICB3aGlsZSAocHJvamVjdHNEaXNwbGF5Lmxhc3RFbGVtZW50Q2hpbGQpIHByb2plY3RzRGlzcGxheS5yZW1vdmVDaGlsZChwcm9qZWN0c0Rpc3BsYXkubGFzdEVsZW1lbnRDaGlsZCk7XG5cbiAgICAgICAgdXBkYXRlZFByb2plY3RzLmZvckVhY2gocHJvamVjdCA9PiB7XG4gICAgICAgICAgICBpZiAocHJvamVjdC5pZCA+IDApIGRpc3BsYXlQcm9qZWN0KHByb2plY3QpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpZiAocGFyc2VJbnQocmVuZGVyVGFzay5ncmFiVGFiKHByb2plY3RJZCkpID09PSBwcm9qZWN0SWQpIHJlbmRlclRhc2suZGlzcGxheUluYm94KClcbiAgICAgICAgZWxzZSByZW5kZXJUYXNrLnVwZGF0ZURpc3BsYXkocHJvamVjdElkKTtcblxuICAgICAgICBzdG9yZUxvY2FsLnN0b3JlUHJvamVjdHMoKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBkaXNwbGF5UHJvamVjdFRhc2tzKGlkKSB7XG4gICAgICAgIGxldCBsaXN0ID0gcHJvamVjdHMucHJvamVjdExpc3Q7XG4gICAgICAgIGNvbnN0IGdlbmVyYWxMaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2dlbmVyYWwnKTtcbiAgICAgICAgZ2VuZXJhbExpc3QuY2xhc3NMaXN0LnJlcGxhY2UoZ2VuZXJhbExpc3QuZ2V0QXR0cmlidXRlKCdjbGFzcycpLCBgJHtpZH1gKTtcblxuICAgICAgICB3aGlsZSAoZ2VuZXJhbExpc3QubGFzdEVsZW1lbnRDaGlsZCkgZ2VuZXJhbExpc3QucmVtb3ZlQ2hpbGQoZ2VuZXJhbExpc3QubGFzdEVsZW1lbnRDaGlsZCk7XG5cbiAgICAgICAgbGV0IHByb2plY3RUYXNrcyA9IHByb2plY3RzLmdyYWJDdXJyZW50UHJvamVjdFRhc2tzKGlkKTtcblxuICAgICAgICBwcm9qZWN0VGFza3MuZm9yRWFjaCh0YXNrID0+IHJlbmRlclRhc2suZGlzcGxheUFsbFRhc2sodGFzaywgZ2VuZXJhbExpc3QpKTtcbiAgICB9XG5cbiAgICByZXR1cm4geyBkaXNwbGF5UHJvamVjdCwgZGlzcGxheVByb2plY3RUYXNrcyB9XG59KSgpXG5cbmV4cG9ydCB7IHJlbmRlclRhc2ssIHJlbmRlclByb2plY3QgfSIsImltcG9ydCB7IEFkZHRvTGlzdCB9IGZyb20gXCIuL21hbmFnZUxpc3RcIjtcbmltcG9ydCB7IHJlbmRlclRhc2sgfSBmcm9tIFwiLi9VSVwiO1xuaW1wb3J0IHsgcHJvamVjdHMgfSBmcm9tIFwiLi9tYW5hZ2VQcm9qZWN0XCI7XG5pbXBvcnQgeyB0b0RhdGUsIGlzVGhpc1dlZWssIGlzVG9kYXkgfSBmcm9tIFwiZGF0ZS1mbnNcIjtcbmltcG9ydCB7IHN0b3JlTG9jYWwgfSBmcm9tIFwiLi9zdG9yYWdlXCI7XG5cblxuY29uc3QgY3JlYXRlVGFzayA9IChpZCwgdGl0bGUsIGRlc2NyaXB0aW9uLCBkdWVkYXRlLCBwcmlvcml0eSwgcHJvamVjdCkgPT4ge1xuICAgIHJldHVybiB7XG4gICAgICAgIGlkLCB0aXRsZSwgZGVzY3JpcHRpb24sIGR1ZWRhdGUsIHByaW9yaXR5LCBwcm9qZWN0XG4gICAgfVxufVxuXG5jb25zdCBOZXdUYXNrID0gKCgpID0+IHtcblxuICAgIGxldCB0aXRsZTtcbiAgICBsZXQgZGVzY3JpcHRpb247XG5cbiAgICBmdW5jdGlvbiBjcmVhdGVOZXdUYXNrKCkge1xuICAgICAgICBjb25zdCBwcm9qZWN0TGlzdCA9IHByb2plY3RzLmdyYWJQcm9qZWN0TGlzdCgpO1xuXG4gICAgICAgIHRpdGxlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RpdGxlJykudmFsdWU7XG4gICAgICAgIGRlc2NyaXB0aW9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Rlc2NyaXB0aW9uJykudmFsdWU7XG5cbiAgICAgICAgbGV0IGR1ZWRhdGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGF0ZScpLnZhbHVlO1xuICAgICAgICBsZXQgcHJpb3JpdHkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJpb3JpdHknKS52YWx1ZTtcbiAgICAgICAgbGV0IGlkID0gY3JlYXRlSWQoKTtcbiAgICAgICAgbGV0IHByb2plY3RJZCA9IHByb2plY3RzLmdyYWJDdXJyZW50UHJvamVjdCgpO1xuXG4gICAgICAgIGNvbnNvbGUubG9nKGlzVGhpc1dlZWsodG9EYXRlKGR1ZWRhdGUpKSlcbiAgICAgICAgY29uc29sZS5sb2coaXNUb2RheSh0b0RhdGUoZHVlZGF0ZSkpKVxuXG4gICAgICAgIGlmICh0aXRsZSA9PT0gJycgfHxcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uID09PSAnJyB8fFxuICAgICAgICAgICAgZHVlZGF0ZSA9PT0gJycpIHJldHVyblxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IHRhc2sgPSBjcmVhdGVUYXNrKGlkLCB0aXRsZSwgZGVzY3JpcHRpb24sIGR1ZWRhdGUsIHByaW9yaXR5LCBwcm9qZWN0SWQpO1xuICAgICAgICAgICAgY29uc29sZS5sb2codGFzayk7XG5cbiAgICAgICAgICAgIGlmIChwcm9qZWN0SWQgPT09IDApIHtcbiAgICAgICAgICAgICAgICBwcm9qZWN0TGlzdFswXS50YXNrTGlzdC5wdXNoKHRhc2spO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHByb2plY3RMaXN0KVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8IHByb2plY3RMaXN0Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgaWYgKHByb2plY3RMaXN0W2ldLmlkID09PSBwcm9qZWN0SWQpIHtcbiAgICAgICAgICAgICAgICAgICAgQWRkdG9MaXN0LmFkZFRvTGlzdCh0YXNrKTtcbiAgICAgICAgICAgICAgICAgICAgcHJvamVjdExpc3RbaV0udGFza0xpc3QucHVzaCh0YXNrKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2cocHJvamVjdExpc3QpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9IFxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGNyZWF0ZUlkKCkge1xuICAgICAgICBsZXQgbGlzdCA9IHByb2plY3RzLmdyYWJQcm9qZWN0TGlzdCgpWzBdLnRhc2tMaXN0O1xuICAgICAgICBsZXQgaWQ7XG5cbiAgICAgICAgaWYgKGxpc3QubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gaWQgPSAwO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIGlkID0gbGlzdFtsaXN0Lmxlbmd0aC0xXS5pZCArIDE7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiByZXNldCgpIHtcbiAgICAgICAgbGV0IHRpdGxlVmFsdWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGl0bGUnKTtcbiAgICAgICAgdGl0bGVWYWx1ZS52YWx1ZSA9ICcnO1xuICAgICAgICB0aXRsZSA9ICcnO1xuXG4gICAgICAgIGxldCBkZXNjcmlwdGlvblZhbHVlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Rlc2NyaXB0aW9uJyk7XG4gICAgICAgIGRlc2NyaXB0aW9uVmFsdWUudmFsdWUgPSAnJztcbiAgICAgICAgZGVzY3JpcHRpb24gPSAnJztcblxuICAgICAgICBsZXQgZHVlZGF0ZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkYXRlJyk7XG4gICAgICAgIGR1ZWRhdGUudmFsdWUgPSAnJztcblxuICAgICAgICBsZXQgcHJpb3JpdHkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJpb3JpdHknKTtcbiAgICAgICAgcHJpb3JpdHkudmFsdWUgPSAnTG93JztcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBpbml0U3VibWl0QnRuKCkge1xuICAgICAgICBjb25zdCBzdWJtaXRCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjc3VibWl0Jyk7XG5cbiAgICAgICAgc3VibWl0QnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgICAgICAgICAgIHN1Ym1pdFRhc2soKTtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIH0pO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGVkaXRUYXNrKGlkKSB7XG4gICAgICAgIGxldCB0YXNrVGl0bGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGl0bGUnKS52YWx1ZTtcbiAgICAgICAgbGV0IHRhc2tEZXNjcmlwdGlvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkZXNjcmlwdGlvbicpLnZhbHVlO1xuICAgICAgICBsZXQgdGFza0RhdGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGF0ZScpLnZhbHVlO1xuICAgICAgICBsZXQgdGFza1ByaW9yaXR5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ByaW9yaXR5JykudmFsdWU7XG5cbiAgICAgICAgY29uc3QgdGFza0xpc3QgPSBwcm9qZWN0cy5ncmFiUHJvamVjdExpc3QoKVswXS50YXNrTGlzdDtcbiAgICAgICAgY29uc3QgZWRpdGVkVGFzayA9IHRhc2tMaXN0LmZpbHRlcih0YXNrID0+IGlkID09PSB0YXNrLmlkKVswXTtcblxuICAgICAgICBlZGl0ZWRUYXNrLnRpdGxlID0gdGFza1RpdGxlO1xuICAgICAgICBlZGl0ZWRUYXNrLmRlc2NyaXB0aW9uID0gdGFza0Rlc2NyaXB0aW9uO1xuICAgICAgICBlZGl0ZWRUYXNrLmR1ZWRhdGUgPSB0YXNrRGF0ZTtcbiAgICAgICAgZWRpdGVkVGFzay5wcmlvcml0eSA9IHRhc2tQcmlvcml0eTtcblxuICAgICAgICB0aXRsZSA9IHRhc2tUaXRsZTtcbiAgICAgICAgZGVzY3JpcHRpb24gPSB0YXNrRGVzY3JpcHRpb247XG5cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0YXNrTGlzdC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgaWYgKHRhc2tMaXN0W2ldLmlkID09PSBpZCkge1xuICAgICAgICAgICAgICAgIHRhc2tMaXN0W2ldID0gZWRpdGVkVGFzaztcbiAgICAgICAgICAgICAgICBwcm9qZWN0cy51cGRhdGVQcm9qZWN0KHRhc2tMaXN0W2ldLnByb2plY3QpO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHByb2plY3RzLmdyYWJQcm9qZWN0TGlzdCgpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIHN1Ym1pdFRhc2soKSB7XG4gICAgICAgIGNvbnN0IG5ld1Rhc2tGb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI21haW4tZm9ybScpO1xuICAgICAgICBjb25zdCBuZXdUYXNrQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI25ld1Rhc2snKTtcbiAgICAgICAgY29uc3QgdGFza0lkID0gcGFyc2VJbnQobmV3VGFza0Zvcm0uZ2V0QXR0cmlidXRlKCdkYXRhLXRhc2tJZCcpKTtcbiAgICAgICAgXG4gICAgICAgIGlmIChuZXdUYXNrRm9ybS5nZXRBdHRyaWJ1dGUoJ2NsYXNzJykgPT09ICdlZGl0LW1vZGUnKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnd2VyaycpXG4gICAgICAgICAgICBlZGl0VGFzayh0YXNrSWQpO1xuICAgICAgICB9IGVsc2Uge2NyZWF0ZU5ld1Rhc2soKX07XG4gICAgICAgIHN0b3JlTG9jYWwuc3RvcmVQcm9qZWN0cygpO1xuXG4gICAgICAgIGlmICh0aXRsZSA9PT0gJycgfHwgZGVzY3JpcHRpb24gPT09ICcnKSByZXR1cm5cblxuICAgICAgICBsZXQgcHJvamVjdElkO1xuICAgICAgICBsZXQgdGFza0xpc3QgPSBwcm9qZWN0cy5ncmFiUHJvamVjdExpc3QoKVswXS50YXNrTGlzdFxuXG4gICAgICAgIGlmIChuZXdUYXNrRm9ybS5nZXRBdHRyaWJ1dGUoJ2NsYXNzJykgPT09ICdlZGl0LW1vZGUnKSB7XG4gICAgICAgICAgICBwcm9qZWN0SWQgPSB0YXNrTGlzdC5maWx0ZXIodGFzayA9PiB0YXNrSWQgPT09IHRhc2suaWQpWzBdLnByb2plY3Q7XG4gICAgICAgICAgICBuZXdUYXNrRm9ybS5jbGFzc0xpc3QucmVtb3ZlKCdlZGl0LW1vZGUnKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHByb2plY3RJZCA9IHRhc2tMaXN0W3Rhc2tMaXN0Lmxlbmd0aCAtIDFdLnByb2plY3Q7IFxuICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgcmVuZGVyVGFzay51cGRhdGVEaXNwbGF5KHByb2plY3RJZCk7XG4gICAgICAgIHJlc2V0KCk7XG4gICAgICAgIG5ld1Rhc2tGb3JtLnNldEF0dHJpYnV0ZSgnaGlkZGVuJywgJycpO1xuICAgICAgICBuZXdUYXNrQnRuLnJlbW92ZUF0dHJpYnV0ZSgnaGlkZGVuJyk7XG4gICAgICAgIFxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGNhbmNlbFRhc2soKSB7XG4gICAgICAgIGNvbnN0IGNhbmNlbEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNjYW5jZWwnKTtcbiAgICAgICAgY29uc3QgbmV3VGFza0Zvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjbWFpbi1mb3JtJyk7XG4gICAgICAgIGNvbnN0IG5ld1Rhc2tCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjbmV3VGFzaycpO1xuXG4gICAgICAgIGNhbmNlbEJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG4gICAgICAgICAgICByZXNldCgpO1xuICAgICAgICAgICAgbmV3VGFza0Zvcm0uc2V0QXR0cmlidXRlKCdoaWRkZW4nLCAnJyk7XG4gICAgICAgICAgICBuZXdUYXNrQnRuLnJlbW92ZUF0dHJpYnV0ZSgnaGlkZGVuJyk7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIH0pXG4gICAgfVxuXG4gICAgZnVuY3Rpb24gb3BlblRhc2tDcmVhdG9yKCkge1xuICAgICAgICBjb25zdCBuZXdUYXNrQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI25ld1Rhc2snKTtcbiAgICAgICAgY29uc3QgbmV3VGFza0Zvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjbWFpbi1mb3JtJyk7XG5cbiAgICAgICAgbmV3VGFza0J0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG4gICAgICAgICAgICBwcm9qZWN0cy5ncmFiUHJvamVjdElkKGUpO1xuICAgICAgICAgICAgbmV3VGFza0Zvcm0ucmVtb3ZlQXR0cmlidXRlKCdoaWRkZW4nKTtcbiAgICAgICAgICAgIG5ld1Rhc2tCdG4uc2V0QXR0cmlidXRlKCdoaWRkZW4nLCAnJyk7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIH0pXG4gICAgfVxuXG4gICAgcmV0dXJuIHsgY3JlYXRlTmV3VGFzaywgaW5pdFN1Ym1pdEJ0biwgY2FuY2VsVGFzaywgb3BlblRhc2tDcmVhdG9yIH1cbn0pKCk7XG5cbmV4cG9ydCB7IE5ld1Rhc2sgfVxuIiwiaW1wb3J0IHsgTmV3VGFzayB9IGZyb20gXCIuL21hbmFnZVRhc2suanNcIjtcbmltcG9ydCB7IHByb2plY3RzIH0gZnJvbSBcIi4vbWFuYWdlUHJvamVjdC5qc1wiO1xuaW1wb3J0IHsgcmVuZGVyVGFzayB9IGZyb20gXCIuL1VJLmpzXCI7XG5pbXBvcnQgeyBzdG9yZUxvY2FsIH0gZnJvbSBcIi4vc3RvcmFnZS5qc1wiO1xuXG5OZXdUYXNrLmluaXRTdWJtaXRCdG4oKTtcbk5ld1Rhc2suY2FuY2VsVGFzaygpO1xuTmV3VGFzay5vcGVuVGFza0NyZWF0b3IoKTtcblxucHJvamVjdHMuc3VibWl0UHJvamVjdCgpO1xuXG5jb25zdCB0b2RheVRhYiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyN0b2RheScpO1xuY29uc3Qgd2Vla1RhYiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyN3ZWVrbHknKTtcbmNvbnN0IGluYm94VGFiID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2luYm94Jyk7XG5cbnRvZGF5VGFiLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJyxyZW5kZXJUYXNrLmRpc3BsYXlEYWlseSk7XG53ZWVrVGFiLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgcmVuZGVyVGFzay5kaXNwbGF5V2Vla2x5KTtcbmluYm94VGFiLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgcmVuZGVyVGFzay5kaXNwbGF5SW5ib3gpO1xuXG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgc3RvcmVMb2NhbC5sb2FkU3RvcmFnZSk7Il0sIm5hbWVzIjpbIkFkZHRvTGlzdCIsIlRvZG9MaXN0IiwiYWRkVG9MaXN0IiwidGFzayIsInB1c2giLCJjb25zb2xlIiwibG9nIiwicmVtb3ZlVGFzayIsImlkIiwiZmlsdGVyIiwic3RvcmVMb2NhbCIsInByb2plY3RMaXN0IiwicHJvamVjdHMiLCJncmFiUHJvamVjdExpc3QiLCJpdGVtIiwibG9jYWxTdG9yYWdlIiwic2V0SXRlbSIsIkpTT04iLCJzdHJpbmdpZnkiLCJwYXJzZSIsImdldEl0ZW0iLCJuZXdMaXN0IiwidGFza0xpc3QiLCJmb3JFYWNoIiwicmVuZGVyVGFzayIsInVwZGF0ZURpc3BsYXkiLCJwcm9qZWN0IiwiYWRkVG9Qcm9qZWN0TGlzdCIsInJlbmRlclByb2plY3QiLCJkaXNwbGF5UHJvamVjdCIsIm5ld1Byb2plY3QiLCJ0aXRsZSIsInByb2plY3RUaXRsZSIsImdlbmVyYWxMaXN0IiwiY3VycmVudFByb2plY3QiLCJzdWJtaXRQcm9qZWN0IiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiYWRkRXZlbnRMaXN0ZW5lciIsImUiLCJwcmV2ZW50RGVmYXVsdCIsInZhbHVlIiwicHJvamVjdElkIiwibGVuZ3RoIiwiY3JlYXRlUHJvamVjdCIsImdyYWJQcm9qZWN0SWQiLCJwYXJzZUludCIsInRhcmdldCIsImdldEF0dHJpYnV0ZSIsImdyYWJDdXJyZW50UHJvamVjdCIsInVwZGF0ZUdlbmVyYWxMaXN0IiwidXBkYXRlUHJvamVjdCIsInVwZGF0ZSIsImdyYWJDdXJyZW50UHJvamVjdFRhc2tzIiwicmVtb3ZlUHJvamVjdCIsInRvRGF0ZSIsImFyZ3VtZW50IiwiYXJnU3RyIiwiT2JqZWN0IiwicHJvdG90eXBlIiwidG9TdHJpbmciLCJjYWxsIiwiRGF0ZSIsImNvbnN0cnVjdG9yIiwiTmFOIiwic3RhcnRPZkRheSIsImRhdGUiLCJfZGF0ZSIsInNldEhvdXJzIiwiaXNUb2RheSIsImRhdGVMZWZ0IiwiZGF0ZVJpZ2h0Iiwibm93IiwiZGVmYXVsdE9wdGlvbnMiLCJnZXREZWZhdWx0T3B0aW9ucyIsInN0YXJ0T2ZXZWVrIiwib3B0aW9ucyIsIndlZWtTdGFydHNPbiIsImxvY2FsZSIsImRheSIsImdldERheSIsImRpZmYiLCJzZXREYXRlIiwiZ2V0RGF0ZSIsImlzVGhpc1dlZWsiLCJpc1NhbWVXZWVrIiwiZGlzcGxheUFsbFRhc2siLCJpdGVtcyIsImRpc3BsYXkiLCJjb250YWluZXIiLCJjcmVhdGVFbGVtZW50Iiwic2V0QXR0cmlidXRlIiwiY2xhc3NMaXN0IiwiYWRkIiwiZHVlZGF0ZSIsImRlc2NyaXB0aW9uIiwicHJpb3JpdHkiLCJkZWxldGVCdG4iLCJlZGl0QnRuIiwidGV4dENvbnRlbnQiLCJBbGx0YXNrIiwibGFzdEVsZW1lbnRDaGlsZCIsInJlbW92ZUNoaWxkIiwiaW5pdERlbEJ0biIsInRhc2tGb3JtIiwiZ2V0RWxlbWVudEJ5SWQiLCJ0YXNrVGl0bGUiLCJ0YXNrRGVzY3JpcHRpb24iLCJ0YXNrRGF0ZSIsInRhc2tQcmlvcml0eSIsInJlbW92ZUF0dHJpYnV0ZSIsImluaXRFZGl0QnRuIiwiYXBwZW5kIiwiYXBwZW5kQ2hpbGQiLCJncmFiVGFiIiwidGFiIiwiZGlzcGxheUluYm94IiwiZGlzcGxheURhaWx5IiwiZGlzcGxheVdlZWtseSIsImRpc3BsYXlQcm9qZWN0VGFza3MiLCJsaXN0IiwicmVwbGFjZSIsInByb2plY3REaXNwbGF5IiwicHJvamVjdFRhc2tCdG4iLCJwcm9qZWN0RGVsQnRuIiwic3RvcFByb3BhZ2F0aW9uIiwibmV3VGFza0Zvcm0iLCJ1cGRhdGVkUHJvamVjdHMiLCJwcm9qZWN0c0Rpc3BsYXkiLCJpbml0RGVsUHJvakJ0biIsIk5ld1Rhc2siLCJjcmVhdGVOZXdUYXNrIiwiY3JlYXRlSWQiLCJjcmVhdGVUYXNrIiwiaSIsInJlc2V0IiwiaW5pdFN1Ym1pdEJ0biIsIm5ld1Rhc2tCdG4iLCJ0YXNrSWQiLCJlZGl0ZWRUYXNrIiwiZWRpdFRhc2siLCJyZW1vdmUiLCJzdWJtaXRUYXNrIiwiY2FuY2VsVGFzayIsImNhbmNlbEJ0biIsIm9wZW5UYXNrQ3JlYXRvciIsInRvZGF5VGFiIiwid2Vla1RhYiIsImluYm94VGFiIl0sInNvdXJjZVJvb3QiOiIifQ==