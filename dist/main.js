(()=>{"use strict";const e=(()=>{let e=[];return{addToList:function(t){e.push(t),console.log(e)},TodoList:e,removeTask:function(t){return e=e.filter((e=>t!==e.id))}}})(),t=(e,t,n)=>({title:e,taskList:t,id:n}),n=(()=>{let n,o=[],r=e.TodoList;const c=t("General",r,0);o.push(c);let i=0;return{submitProject:function(){document.querySelector("#createProject").addEventListener("click",(e=>{if(e.preventDefault(),function(){n=document.querySelector("#projectTitle").value;const e=0===o.length?0:o[o.length-1].id+1;if(""!==n){const r=t(n,[],e);console.log(r),function(e){o.push(e),console.log(o)}(r)}}(),""!==n){let e=o[o.length-1];u.displayProject(e),document.querySelector("#projectTitle").value="",n=""}}))},grabProjectId:function(e){let t=parseInt(e.target.getAttribute("data-projectId"));return i=t,i},grabCurrentProject:function(){return i},grabProjectList:function(){return o},projectList:o,updateGeneralList:function(e){return c.taskList=e,console.log(c.taskList),c},updateProjectList:function(e){let t=c.taskList.filter((t=>t.project===e));return console.log(t),0!==e?o.filter((t=>t.id===e))[0].taskList=t:void 0},grabCurrentProjectTasks:function(e){return console.log(o.filter((t=>t.id===e))[0].taskList),o.filter((t=>t.id===e))[0].taskList},removeProject:function(e){return console.log("before",o),o=o.filter((t=>t.id!==e)),console.log("after",o),o}}})();function o(e){const t=Object.prototype.toString.call(e);return e instanceof Date||"object"==typeof e&&"[object Date]"===t?new e.constructor(+e):"number"==typeof e||"[object Number]"===t||"string"==typeof e||"[object String]"===t?new Date(e):new Date(NaN)}function r(e){const t=o(e);return t.setHours(0,0,0,0),t}function c(e){return t=e,n=Date.now(),+r(t)==+r(n);var t,n}let i={};function l(){return i}function a(e,t){const n=l(),r=t?.weekStartsOn??t?.locale?.options?.weekStartsOn??n.weekStartsOn??n.locale?.options?.weekStartsOn??0,c=o(e),i=c.getDay(),a=(i<r?7:0)+i-r;return c.setDate(c.getDate()-a),c.setHours(0,0,0,0),c}function s(e,t){return function(e,t,n){return+a(e,n)==+a(t,n)}(e,Date.now(),t)}const d=(()=>{function t(t,o){const r=document.createElement("div");r.setAttribute("data-taskId",`${t.id}`),r.classList.add("task");const c=document.createElement("div"),l=document.createElement("div"),a=document.createElement("div"),s=document.createElement("div"),d=document.createElement("button");return c.textContent=`Title: ${t.title}`,l.textContent=`Due Date: ${t.duedate}`,a.textContent=`Description: ${t.description}`,s.textContent=`Priority: ${t.priority}`,d.textContent="delete",d.setAttribute("data-taskId",`${t.id}`),d.addEventListener("click",(()=>function(t,o){let r=e.removeTask(t);const c=document.querySelector("#general");for(n.updateGeneralList(r),n.updateProjectList(o);c.lastElementChild;)c.removeChild(c.lastElementChild);i(o),console.log(n.projectList),console.log(o)}(t.id,t.project))),r.append(c,l,a,s,d),o.appendChild(r),o}function r(){return document.querySelector("#general").getAttribute("class")}function i(e){let t=r();"inboxTab"===t?l():"todayTab"===t?a():"weekTab"===t?d():t===`${e}`&&0!==e&&u.displayProjectTasks(e)}function l(){let e=n.projectList[0].taskList;const o=document.querySelector("#general");for(o.classList.replace(o.getAttribute("class"),"inboxTab");o.lastElementChild;)o.removeChild(o.lastElementChild);e.forEach((e=>t(e,o))),console.log(e)}function a(){let e=n.projectList[0].taskList;const r=document.querySelector("#general");for(r.classList.replace(r.getAttribute("class"),"todayTab");r.lastElementChild;)r.removeChild(r.lastElementChild);e.filter((e=>c(o(e.duedate)))).forEach((e=>t(e,r)))}function d(){let e=n.projectList[0].taskList;const r=document.querySelector("#general");for(r.classList.replace(r.getAttribute("class"),"weekTab");r.lastElementChild;)r.removeChild(r.lastElementChild);e.filter((e=>s(o(e.duedate)))).forEach((e=>t(e,r)))}return{displayInbox:l,displayDaily:a,displayWeekly:d,displayAllTask:t,updateDisplay:i,grabTab:r}})(),u=(()=>{function t(e){n.projectList;const t=document.querySelector("#general");for(t.classList.replace(t.getAttribute("class"),`${e}`);t.lastElementChild;)t.removeChild(t.lastElementChild);n.grabCurrentProjectTasks(e).forEach((e=>d.displayAllTask(e,t)))}return{displayProject:function o(r){const c=document.querySelector(".all-projects"),i=document.createElement("div"),l=document.createElement("div"),a=document.createElement("button"),s=document.createElement("button");return i.classList.add(`project-${r.id}`),i.setAttribute("data-projectId",`${r.id}`),a.setAttribute("data-projectId",`${r.id}`),a.setAttribute("id",`project-${r.id}`),l.textContent=`${r.title}`,a.textContent="+",s.textContent="delete",i.addEventListener("click",(e=>{e.stopPropagation(),t(r.id)})),a.addEventListener("click",(e=>{e.stopPropagation(),console.log("project id",n.grabProjectId(e));const t=document.querySelector("#main-form");n.grabProjectId(e),t.removeAttribute("hidden"),e.preventDefault()})),s.addEventListener("click",(t=>{t.stopPropagation(),function(t){n.removeProject(t);let r=n.grabProjectList();e.TodoList.filter((e=>e.project===t)).forEach((t=>{let o=e.removeTask(t.id);n.updateGeneralList(o)}));let c=document.querySelector(".all-projects");for(;c.lastElementChild;)c.removeChild(c.lastElementChild);r.forEach((e=>{e.id>0&&o(e)})),parseInt(d.grabTab(t))===t?d.displayInbox():d.updateDisplay(t)}(r.id)})),i.append(l,a,s),c.appendChild(i),c},displayProjectTasks:t}})(),m=(()=>{let t,r;function i(){const i=n.grabProjectList();t=document.getElementById("title").value,r=document.getElementById("description").value;let l=document.getElementById("date").value,a=document.getElementById("priority").value,d=function(){let e=n.projectList[0].taskList;return 0===e.length?0:e[e.length-1].id+1}(),u=n.grabCurrentProject();if(console.log(s(o(l))),console.log(c(o(l))),""!==t&&""!==r&&""!==l){const n=((e,t,n,o,r,c)=>({id:e,title:t,description:n,duedate:o,priority:r,project:c}))(d,t,r,l,a,u);console.log(n),0===u&&(i[0].taskList.push(n),console.log(i));for(let t=1;t<i.length;t++)i[t].id===u&&(e.addToList(n),i[t].taskList.push(n),console.log(i))}}function l(){document.getElementById("title").value="",t="",document.getElementById("description").value="",r="",document.getElementById("date").value="",document.getElementById("priority").value="Low"}return{createNewTask:i,initSubmitBtn:function(){document.querySelector("#submit").addEventListener("click",(e=>{!function(){const e=document.querySelector("#main-form"),o=document.querySelector("#newTask");if(i(),""!==t&&""!==r){let t=n.projectList[0].taskList,r=t[t.length-1].project;d.updateDisplay(r),l(),e.setAttribute("hidden",""),o.removeAttribute("hidden")}}(),e.preventDefault()}))},cancelTask:function(){const e=document.querySelector("#cancel"),t=document.querySelector("#main-form"),n=document.querySelector("#newTask");e.addEventListener("click",(e=>{l(),t.setAttribute("hidden",""),n.removeAttribute("hidden"),e.preventDefault()}))},openTaskCreator:function(){const e=document.querySelector("#newTask"),t=document.querySelector("#main-form");e.addEventListener("click",(o=>{n.grabProjectId(o),t.removeAttribute("hidden"),e.setAttribute("hidden",""),o.preventDefault()}))}}})();m.initSubmitBtn(),m.cancelTask(),m.openTaskCreator(),n.submitProject();const p=document.querySelector("#today"),f=document.querySelector("#weekly"),g=document.querySelector("#inbox");p.addEventListener("click",d.displayDaily),f.addEventListener("click",d.displayWeekly),g.addEventListener("click",d.displayInbox)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFhLFNBQVUsSUFDbkN5QyxFQUFXWixnQkFBZ0IsU0FDL0IsQ0FDSixDQXJCUWEsR0FDQXJHLEVBQUVDLGdCQUFnQixHQUUxQixFQTZDdUNxRyxXQXpCdkMsV0FDSSxNQUFNQyxFQUFZMUcsU0FBU0MsY0FBYyxXQUNuQ3lGLEVBQWMxRixTQUFTQyxjQUFjLGNBQ3JDc0csRUFBYXZHLFNBQVNDLGNBQWMsWUFFMUN5RyxFQUFVeEcsaUJBQWlCLFNBQVVDLElBQ2pDa0csSUFDQVgsRUFBWTVCLGFBQWEsU0FBVSxJQUNuQ3lDLEVBQVdaLGdCQUFnQixVQUMzQnhGLEVBQUVDLGdCQUFnQixHQUUxQixFQWNtRHVHLGdCQVpuRCxXQUNJLE1BQU1KLEVBQWF2RyxTQUFTQyxjQUFjLFlBQ3BDeUYsRUFBYzFGLFNBQVNDLGNBQWMsY0FFM0NzRyxFQUFXckcsaUJBQWlCLFNBQVVDLElBQ2xDVCxFQUFTbUIsY0FBY1YsR0FDdkJ1RixFQUFZQyxnQkFBZ0IsVUFDNUJZLEVBQVd6QyxhQUFhLFNBQVUsSUFDbEMzRCxFQUFFQyxnQkFBZ0IsR0FFMUIsRUFHSCxFQXpIZSxHQ1JoQjJGLEVBQVFPLGdCQUNSUCxFQUFRVSxhQUNSVixFQUFRWSxrQkFFUmpILEVBQVNLLGdCQUVULE1BQU02RyxFQUFXNUcsU0FBU0MsY0FBYyxVQUNsQzRHLEVBQVU3RyxTQUFTQyxjQUFjLFdBQ2pDNkcsRUFBVzlHLFNBQVNDLGNBQWMsVUFFeEMyRyxFQUFTMUcsaUJBQWlCLFFBQVFzRCxFQUFXd0IsY0FDN0M2QixFQUFRM0csaUJBQWlCLFFBQVNzRCxFQUFXeUIsZUFDN0M2QixFQUFTNUcsaUJBQWlCLFFBQVNzRCxFQUFXdUIsYSIsInNvdXJjZXMiOlsid2VicGFjazovL3RvZG8tbGlzdC8uL3NyYy9tYW5hZ2VMaXN0LmpzIiwid2VicGFjazovL3RvZG8tbGlzdC8uL3NyYy9tYW5hZ2VQcm9qZWN0LmpzIiwid2VicGFjazovL3RvZG8tbGlzdC8uL25vZGVfbW9kdWxlcy9kYXRlLWZucy90b0RhdGUubWpzIiwid2VicGFjazovL3RvZG8tbGlzdC8uL25vZGVfbW9kdWxlcy9kYXRlLWZucy9zdGFydE9mRGF5Lm1qcyIsIndlYnBhY2s6Ly90b2RvLWxpc3QvLi9ub2RlX21vZHVsZXMvZGF0ZS1mbnMvaXNUb2RheS5tanMiLCJ3ZWJwYWNrOi8vdG9kby1saXN0Ly4vbm9kZV9tb2R1bGVzL2RhdGUtZm5zL2lzU2FtZURheS5tanMiLCJ3ZWJwYWNrOi8vdG9kby1saXN0Ly4vbm9kZV9tb2R1bGVzL2RhdGUtZm5zL19saWIvZGVmYXVsdE9wdGlvbnMubWpzIiwid2VicGFjazovL3RvZG8tbGlzdC8uL25vZGVfbW9kdWxlcy9kYXRlLWZucy9zdGFydE9mV2Vlay5tanMiLCJ3ZWJwYWNrOi8vdG9kby1saXN0Ly4vbm9kZV9tb2R1bGVzL2RhdGUtZm5zL2lzVGhpc1dlZWsubWpzIiwid2VicGFjazovL3RvZG8tbGlzdC8uL25vZGVfbW9kdWxlcy9kYXRlLWZucy9pc1NhbWVXZWVrLm1qcyIsIndlYnBhY2s6Ly90b2RvLWxpc3QvLi9zcmMvVUkuanMiLCJ3ZWJwYWNrOi8vdG9kby1saXN0Ly4vc3JjL21hbmFnZVRhc2suanMiLCJ3ZWJwYWNrOi8vdG9kby1saXN0Ly4vc3JjL2luZGV4LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IEFkZHRvTGlzdCA9ICgoKSA9PiB7XG4gICAgbGV0IFRvZG9MaXN0ID0gW107XG5cbiAgICBmdW5jdGlvbiBhZGRUb0xpc3QodGFzaykge1xuICAgICAgICBUb2RvTGlzdC5wdXNoKHRhc2spO1xuICAgICAgICBjb25zb2xlLmxvZyhUb2RvTGlzdCk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gcmVtb3ZlVGFzayhpZCkge1xuICAgICAgICByZXR1cm4gVG9kb0xpc3QgPSBUb2RvTGlzdC5maWx0ZXIodGFzayA9PiBpZCAhPT0gdGFzay5pZCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHsgYWRkVG9MaXN0LCBUb2RvTGlzdCwgcmVtb3ZlVGFzayB9O1xufSkoKVxuXG5cbmV4cG9ydCB7IEFkZHRvTGlzdCB9IiwiaW1wb3J0IHsgcmVuZGVyUHJvamVjdCB9IGZyb20gXCIuL1VJXCI7XG5pbXBvcnQgeyBBZGR0b0xpc3QgfSBmcm9tIFwiLi9tYW5hZ2VMaXN0XCI7XG5pbXBvcnQgeyBOZXdUYXNrIH0gZnJvbSBcIi4vbWFuYWdlVGFza1wiO1xuXG5jb25zdCBuZXdQcm9qZWN0ID0gKHRpdGxlLCB0YXNrTGlzdCwgaWQpID0+IHtcbiAgICByZXR1cm4geyB0aXRsZSwgdGFza0xpc3QsIGlkIH07XG59XG5cbmNvbnN0IHByb2plY3RzID0gKCgpID0+IHtcbiAgICBsZXQgcHJvamVjdFRpdGxlXG4gICAgbGV0IHByb2plY3RMaXN0ID0gW107XG5cbiAgICBsZXQgdGFza0xpc3QgPSBBZGR0b0xpc3QuVG9kb0xpc3Q7XG5cbiAgICBjb25zdCBnZW5lcmFsTGlzdCA9IG5ld1Byb2plY3QoJ0dlbmVyYWwnLCB0YXNrTGlzdCwgMCk7XG4gICAgcHJvamVjdExpc3QucHVzaChnZW5lcmFsTGlzdCk7XG5cbiAgICBsZXQgY3VycmVudFByb2plY3QgPSAwO1xuXG4gICAgZnVuY3Rpb24gdXBkYXRlR2VuZXJhbExpc3QobmV3TGlzdCkge1xuICAgICAgICBnZW5lcmFsTGlzdC50YXNrTGlzdCA9IG5ld0xpc3RcbiAgICAgICAgY29uc29sZS5sb2coZ2VuZXJhbExpc3QudGFza0xpc3QpXG4gICAgICAgIHJldHVybiBnZW5lcmFsTGlzdFxuICAgIH1cblxuICAgIGZ1bmN0aW9uIHVwZGF0ZVByb2plY3RMaXN0KGlkKSB7XG4gICAgICAgIGxldCB1cGRhdGUgPSBnZW5lcmFsTGlzdC50YXNrTGlzdC5maWx0ZXIodGFzayA9PiB0YXNrLnByb2plY3QgPT09IGlkKTtcbiAgICAgICAgY29uc29sZS5sb2codXBkYXRlKVxuICAgICAgICBpZiAoaWQgIT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiBwcm9qZWN0TGlzdC5maWx0ZXIocHJvamVjdCA9PiBwcm9qZWN0LmlkID09PSBpZClbMF0udGFza0xpc3QgPSB1cGRhdGVcbiAgICAgICAgfSBlbHNlIHJldHVybjtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBncmFiQ3VycmVudFByb2plY3RUYXNrcyhpZCkge1xuICAgICAgICBjb25zb2xlLmxvZyhwcm9qZWN0TGlzdC5maWx0ZXIocHJvamVjdCA9PiBwcm9qZWN0LmlkID09PSBpZClbMF0udGFza0xpc3QpXG4gICAgICAgIHJldHVybiBwcm9qZWN0TGlzdC5maWx0ZXIocHJvamVjdCA9PiBwcm9qZWN0LmlkID09PSBpZClbMF0udGFza0xpc3RcbiAgICB9XG5cbiAgICBmdW5jdGlvbiByZW1vdmVQcm9qZWN0KGlkKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdiZWZvcmUnLCBwcm9qZWN0TGlzdCk7XG4gICAgICAgIHByb2plY3RMaXN0ID0gcHJvamVjdExpc3QuZmlsdGVyKHByb2plY3QgPT4gcHJvamVjdC5pZCAhPT0gaWQpO1xuICAgICAgICBjb25zb2xlLmxvZygnYWZ0ZXInLCBwcm9qZWN0TGlzdCk7XG4gICAgICAgIHJldHVybiBwcm9qZWN0TGlzdFxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdyYWJDdXJyZW50UHJvamVjdCgpIHtcbiAgICAgICAgcmV0dXJuIGN1cnJlbnRQcm9qZWN0O1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdyYWJQcm9qZWN0TGlzdCgpIHtcbiAgICAgICAgcmV0dXJuIHByb2plY3RMaXN0O1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGNyZWF0ZVByb2plY3QoKSB7XG4gICAgICAgIHByb2plY3RUaXRsZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNwcm9qZWN0VGl0bGUnKS52YWx1ZTtcbiAgICAgICAgY29uc3QgcHJvamVjdElkID0gY3JlYXRlUHJvamVjdElkKClcbiAgICAgICAgY29uc3QgcHJvamVjdFRhc2tzID0gW107XG5cbiAgICAgICAgaWYgKHByb2plY3RUaXRsZSA9PT0gJycpIHJldHVyblxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IHByb2plY3QgPSBuZXdQcm9qZWN0KHByb2plY3RUaXRsZSwgcHJvamVjdFRhc2tzLCBwcm9qZWN0SWQpO1xuICAgICAgICAgICAgY29uc29sZS5sb2cocHJvamVjdCk7XG4gICAgICAgICAgICBhZGRUb1Byb2plY3RMaXN0KHByb2plY3QpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gY3JlYXRlUHJvamVjdElkKCkge1xuICAgICAgICBsZXQgaWQ7XG4gICAgICAgIGlmIChwcm9qZWN0TGlzdC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiBpZCA9IDA7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gaWQgPSBwcm9qZWN0TGlzdFtwcm9qZWN0TGlzdC5sZW5ndGggLSAxXS5pZCArIDE7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBhZGRUb1Byb2plY3RMaXN0KHByb2plY3QpIHtcbiAgICAgICAgcHJvamVjdExpc3QucHVzaChwcm9qZWN0KTtcbiAgICAgICAgY29uc29sZS5sb2cocHJvamVjdExpc3QpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHJlc2V0KCkge1xuICAgICAgICBsZXQgcHJvamVjdFRpdGxlVmFsdWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjcHJvamVjdFRpdGxlJyk7XG4gICAgICAgIHByb2plY3RUaXRsZVZhbHVlLnZhbHVlID0gJyc7XG4gICAgICAgIHByb2plY3RUaXRsZSA9ICcnO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHN1Ym1pdFByb2plY3QoKSB7XG4gICAgICAgIGNvbnN0IGNyZWF0ZVByb2plY3RCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjY3JlYXRlUHJvamVjdCcpO1xuXG4gICAgICAgIGNyZWF0ZVByb2plY3RCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBjcmVhdGVQcm9qZWN0KCk7XG4gICAgICAgICAgICBpZiAocHJvamVjdFRpdGxlID09PSAnJykgcmV0dXJuXG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBsZXQgcHJvamVjdCA9IHByb2plY3RMaXN0W3Byb2plY3RMaXN0Lmxlbmd0aCAtMV07XG5cbiAgICAgICAgICAgICAgICByZW5kZXJQcm9qZWN0LmRpc3BsYXlQcm9qZWN0KHByb2plY3QpO1xuICAgICAgICAgICAgICAgIHJlc2V0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZ3JhYlByb2plY3RJZChlKSB7XG4gICAgICAgIGxldCBwcm9qZWN0SWQgPSBwYXJzZUludChlLnRhcmdldC5nZXRBdHRyaWJ1dGUoJ2RhdGEtcHJvamVjdElkJykpO1xuXG4gICAgICAgIGN1cnJlbnRQcm9qZWN0ID0gcHJvamVjdElkO1xuXG4gICAgICAgIHJldHVybiBjdXJyZW50UHJvamVjdDtcbiAgICB9XG5cbiAgICByZXR1cm4geyBzdWJtaXRQcm9qZWN0LCBncmFiUHJvamVjdElkLCBncmFiQ3VycmVudFByb2plY3QsIGdyYWJQcm9qZWN0TGlzdCwgcHJvamVjdExpc3QsIHVwZGF0ZUdlbmVyYWxMaXN0LHVwZGF0ZVByb2plY3RMaXN0LCBncmFiQ3VycmVudFByb2plY3RUYXNrcywgcmVtb3ZlUHJvamVjdCB9XG59KSgpXG5cbmV4cG9ydCB7IHByb2plY3RzIH1cblxuIiwiLyoqXG4gKiBAbmFtZSB0b0RhdGVcbiAqIEBjYXRlZ29yeSBDb21tb24gSGVscGVyc1xuICogQHN1bW1hcnkgQ29udmVydCB0aGUgZ2l2ZW4gYXJndW1lbnQgdG8gYW4gaW5zdGFuY2Ugb2YgRGF0ZS5cbiAqXG4gKiBAZGVzY3JpcHRpb25cbiAqIENvbnZlcnQgdGhlIGdpdmVuIGFyZ3VtZW50IHRvIGFuIGluc3RhbmNlIG9mIERhdGUuXG4gKlxuICogSWYgdGhlIGFyZ3VtZW50IGlzIGFuIGluc3RhbmNlIG9mIERhdGUsIHRoZSBmdW5jdGlvbiByZXR1cm5zIGl0cyBjbG9uZS5cbiAqXG4gKiBJZiB0aGUgYXJndW1lbnQgaXMgYSBudW1iZXIsIGl0IGlzIHRyZWF0ZWQgYXMgYSB0aW1lc3RhbXAuXG4gKlxuICogSWYgdGhlIGFyZ3VtZW50IGlzIG5vbmUgb2YgdGhlIGFib3ZlLCB0aGUgZnVuY3Rpb24gcmV0dXJucyBJbnZhbGlkIERhdGUuXG4gKlxuICogKipOb3RlKio6ICphbGwqIERhdGUgYXJndW1lbnRzIHBhc3NlZCB0byBhbnkgKmRhdGUtZm5zKiBmdW5jdGlvbiBpcyBwcm9jZXNzZWQgYnkgYHRvRGF0ZWAuXG4gKlxuICogQHR5cGVQYXJhbSBEYXRlVHlwZSAtIFRoZSBgRGF0ZWAgdHlwZSwgdGhlIGZ1bmN0aW9uIG9wZXJhdGVzIG9uLiBHZXRzIGluZmVycmVkIGZyb20gcGFzc2VkIGFyZ3VtZW50cy4gQWxsb3dzIHRvIHVzZSBleHRlbnNpb25zIGxpa2UgW2BVVENEYXRlYF0oaHR0cHM6Ly9naXRodWIuY29tL2RhdGUtZm5zL3V0YykuXG4gKlxuICogQHBhcmFtIGFyZ3VtZW50IC0gVGhlIHZhbHVlIHRvIGNvbnZlcnRcbiAqXG4gKiBAcmV0dXJucyBUaGUgcGFyc2VkIGRhdGUgaW4gdGhlIGxvY2FsIHRpbWUgem9uZVxuICpcbiAqIEBleGFtcGxlXG4gKiAvLyBDbG9uZSB0aGUgZGF0ZTpcbiAqIGNvbnN0IHJlc3VsdCA9IHRvRGF0ZShuZXcgRGF0ZSgyMDE0LCAxLCAxMSwgMTEsIDMwLCAzMCkpXG4gKiAvLz0+IFR1ZSBGZWIgMTEgMjAxNCAxMTozMDozMFxuICpcbiAqIEBleGFtcGxlXG4gKiAvLyBDb252ZXJ0IHRoZSB0aW1lc3RhbXAgdG8gZGF0ZTpcbiAqIGNvbnN0IHJlc3VsdCA9IHRvRGF0ZSgxMzkyMDk4NDMwMDAwKVxuICogLy89PiBUdWUgRmViIDExIDIwMTQgMTE6MzA6MzBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHRvRGF0ZShhcmd1bWVudCkge1xuICBjb25zdCBhcmdTdHIgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoYXJndW1lbnQpO1xuXG4gIC8vIENsb25lIHRoZSBkYXRlXG4gIGlmIChcbiAgICBhcmd1bWVudCBpbnN0YW5jZW9mIERhdGUgfHxcbiAgICAodHlwZW9mIGFyZ3VtZW50ID09PSBcIm9iamVjdFwiICYmIGFyZ1N0ciA9PT0gXCJbb2JqZWN0IERhdGVdXCIpXG4gICkge1xuICAgIC8vIFByZXZlbnQgdGhlIGRhdGUgdG8gbG9zZSB0aGUgbWlsbGlzZWNvbmRzIHdoZW4gcGFzc2VkIHRvIG5ldyBEYXRlKCkgaW4gSUUxMFxuICAgIHJldHVybiBuZXcgYXJndW1lbnQuY29uc3RydWN0b3IoK2FyZ3VtZW50KTtcbiAgfSBlbHNlIGlmIChcbiAgICB0eXBlb2YgYXJndW1lbnQgPT09IFwibnVtYmVyXCIgfHxcbiAgICBhcmdTdHIgPT09IFwiW29iamVjdCBOdW1iZXJdXCIgfHxcbiAgICB0eXBlb2YgYXJndW1lbnQgPT09IFwic3RyaW5nXCIgfHxcbiAgICBhcmdTdHIgPT09IFwiW29iamVjdCBTdHJpbmddXCJcbiAgKSB7XG4gICAgLy8gVE9ETzogQ2FuIHdlIGdldCByaWQgb2YgYXM/XG4gICAgcmV0dXJuIG5ldyBEYXRlKGFyZ3VtZW50KTtcbiAgfSBlbHNlIHtcbiAgICAvLyBUT0RPOiBDYW4gd2UgZ2V0IHJpZCBvZiBhcz9cbiAgICByZXR1cm4gbmV3IERhdGUoTmFOKTtcbiAgfVxufVxuXG4vLyBGYWxsYmFjayBmb3IgbW9kdWxhcml6ZWQgaW1wb3J0czpcbmV4cG9ydCBkZWZhdWx0IHRvRGF0ZTtcbiIsImltcG9ydCB7IHRvRGF0ZSB9IGZyb20gXCIuL3RvRGF0ZS5tanNcIjtcblxuLyoqXG4gKiBAbmFtZSBzdGFydE9mRGF5XG4gKiBAY2F0ZWdvcnkgRGF5IEhlbHBlcnNcbiAqIEBzdW1tYXJ5IFJldHVybiB0aGUgc3RhcnQgb2YgYSBkYXkgZm9yIHRoZSBnaXZlbiBkYXRlLlxuICpcbiAqIEBkZXNjcmlwdGlvblxuICogUmV0dXJuIHRoZSBzdGFydCBvZiBhIGRheSBmb3IgdGhlIGdpdmVuIGRhdGUuXG4gKiBUaGUgcmVzdWx0IHdpbGwgYmUgaW4gdGhlIGxvY2FsIHRpbWV6b25lLlxuICpcbiAqIEB0eXBlUGFyYW0gRGF0ZVR5cGUgLSBUaGUgYERhdGVgIHR5cGUsIHRoZSBmdW5jdGlvbiBvcGVyYXRlcyBvbi4gR2V0cyBpbmZlcnJlZCBmcm9tIHBhc3NlZCBhcmd1bWVudHMuIEFsbG93cyB0byB1c2UgZXh0ZW5zaW9ucyBsaWtlIFtgVVRDRGF0ZWBdKGh0dHBzOi8vZ2l0aHViLmNvbS9kYXRlLWZucy91dGMpLlxuICpcbiAqIEBwYXJhbSBkYXRlIC0gVGhlIG9yaWdpbmFsIGRhdGVcbiAqXG4gKiBAcmV0dXJucyBUaGUgc3RhcnQgb2YgYSBkYXlcbiAqXG4gKiBAZXhhbXBsZVxuICogLy8gVGhlIHN0YXJ0IG9mIGEgZGF5IGZvciAyIFNlcHRlbWJlciAyMDE0IDExOjU1OjAwOlxuICogY29uc3QgcmVzdWx0ID0gc3RhcnRPZkRheShuZXcgRGF0ZSgyMDE0LCA4LCAyLCAxMSwgNTUsIDApKVxuICogLy89PiBUdWUgU2VwIDAyIDIwMTQgMDA6MDA6MDBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHN0YXJ0T2ZEYXkoZGF0ZSkge1xuICBjb25zdCBfZGF0ZSA9IHRvRGF0ZShkYXRlKTtcbiAgX2RhdGUuc2V0SG91cnMoMCwgMCwgMCwgMCk7XG4gIHJldHVybiBfZGF0ZTtcbn1cblxuLy8gRmFsbGJhY2sgZm9yIG1vZHVsYXJpemVkIGltcG9ydHM6XG5leHBvcnQgZGVmYXVsdCBzdGFydE9mRGF5O1xuIiwiaW1wb3J0IHsgaXNTYW1lRGF5IH0gZnJvbSBcIi4vaXNTYW1lRGF5Lm1qc1wiO1xuXG4vKipcbiAqIEBuYW1lIGlzVG9kYXlcbiAqIEBjYXRlZ29yeSBEYXkgSGVscGVyc1xuICogQHN1bW1hcnkgSXMgdGhlIGdpdmVuIGRhdGUgdG9kYXk/XG4gKiBAcHVyZSBmYWxzZVxuICpcbiAqIEBkZXNjcmlwdGlvblxuICogSXMgdGhlIGdpdmVuIGRhdGUgdG9kYXk/XG4gKlxuICogQHR5cGVQYXJhbSBEYXRlVHlwZSAtIFRoZSBgRGF0ZWAgdHlwZSwgdGhlIGZ1bmN0aW9uIG9wZXJhdGVzIG9uLiBHZXRzIGluZmVycmVkIGZyb20gcGFzc2VkIGFyZ3VtZW50cy4gQWxsb3dzIHRvIHVzZSBleHRlbnNpb25zIGxpa2UgW2BVVENEYXRlYF0oaHR0cHM6Ly9naXRodWIuY29tL2RhdGUtZm5zL3V0YykuXG4gKlxuICogQHBhcmFtIGRhdGUgLSBUaGUgZGF0ZSB0byBjaGVja1xuICpcbiAqIEByZXR1cm5zIFRoZSBkYXRlIGlzIHRvZGF5XG4gKlxuICogQGV4YW1wbGVcbiAqIC8vIElmIHRvZGF5IGlzIDYgT2N0b2JlciAyMDE0LCBpcyA2IE9jdG9iZXIgMTQ6MDA6MDAgdG9kYXk/XG4gKiBjb25zdCByZXN1bHQgPSBpc1RvZGF5KG5ldyBEYXRlKDIwMTQsIDksIDYsIDE0LCAwKSlcbiAqIC8vPT4gdHJ1ZVxuICovXG5leHBvcnQgZnVuY3Rpb24gaXNUb2RheShkYXRlKSB7XG4gIHJldHVybiBpc1NhbWVEYXkoZGF0ZSwgRGF0ZS5ub3coKSk7XG59XG5cbi8vIEZhbGxiYWNrIGZvciBtb2R1bGFyaXplZCBpbXBvcnRzOlxuZXhwb3J0IGRlZmF1bHQgaXNUb2RheTtcbiIsImltcG9ydCB7IHN0YXJ0T2ZEYXkgfSBmcm9tIFwiLi9zdGFydE9mRGF5Lm1qc1wiO1xuXG4vKipcbiAqIEBuYW1lIGlzU2FtZURheVxuICogQGNhdGVnb3J5IERheSBIZWxwZXJzXG4gKiBAc3VtbWFyeSBBcmUgdGhlIGdpdmVuIGRhdGVzIGluIHRoZSBzYW1lIGRheSAoYW5kIHllYXIgYW5kIG1vbnRoKT9cbiAqXG4gKiBAZGVzY3JpcHRpb25cbiAqIEFyZSB0aGUgZ2l2ZW4gZGF0ZXMgaW4gdGhlIHNhbWUgZGF5IChhbmQgeWVhciBhbmQgbW9udGgpP1xuICpcbiAqIEB0eXBlUGFyYW0gRGF0ZVR5cGUgLSBUaGUgYERhdGVgIHR5cGUsIHRoZSBmdW5jdGlvbiBvcGVyYXRlcyBvbi4gR2V0cyBpbmZlcnJlZCBmcm9tIHBhc3NlZCBhcmd1bWVudHMuIEFsbG93cyB0byB1c2UgZXh0ZW5zaW9ucyBsaWtlIFtgVVRDRGF0ZWBdKGh0dHBzOi8vZ2l0aHViLmNvbS9kYXRlLWZucy91dGMpLlxuICpcbiAqIEBwYXJhbSBkYXRlTGVmdCAtIFRoZSBmaXJzdCBkYXRlIHRvIGNoZWNrXG4gKiBAcGFyYW0gZGF0ZVJpZ2h0IC0gVGhlIHNlY29uZCBkYXRlIHRvIGNoZWNrXG5cbiAqIEByZXR1cm5zIFRoZSBkYXRlcyBhcmUgaW4gdGhlIHNhbWUgZGF5IChhbmQgeWVhciBhbmQgbW9udGgpXG4gKlxuICogQGV4YW1wbGVcbiAqIC8vIEFyZSA0IFNlcHRlbWJlciAwNjowMDowMCBhbmQgNCBTZXB0ZW1iZXIgMTg6MDA6MDAgaW4gdGhlIHNhbWUgZGF5P1xuICogY29uc3QgcmVzdWx0ID0gaXNTYW1lRGF5KG5ldyBEYXRlKDIwMTQsIDgsIDQsIDYsIDApLCBuZXcgRGF0ZSgyMDE0LCA4LCA0LCAxOCwgMCkpXG4gKiAvLz0+IHRydWVcbiAqXG4gKiBAZXhhbXBsZVxuICogLy8gQXJlIDQgU2VwdGVtYmVyIGFuZCA0IE9jdG9iZXIgaW4gdGhlIHNhbWUgZGF5P1xuICogY29uc3QgcmVzdWx0ID0gaXNTYW1lRGF5KG5ldyBEYXRlKDIwMTQsIDgsIDQpLCBuZXcgRGF0ZSgyMDE0LCA5LCA0KSlcbiAqIC8vPT4gZmFsc2VcbiAqXG4gKiBAZXhhbXBsZVxuICogLy8gQXJlIDQgU2VwdGVtYmVyLCAyMDE0IGFuZCA0IFNlcHRlbWJlciwgMjAxNSBpbiB0aGUgc2FtZSBkYXk/XG4gKiBjb25zdCByZXN1bHQgPSBpc1NhbWVEYXkobmV3IERhdGUoMjAxNCwgOCwgNCksIG5ldyBEYXRlKDIwMTUsIDgsIDQpKVxuICogLy89PiBmYWxzZVxuICovXG5leHBvcnQgZnVuY3Rpb24gaXNTYW1lRGF5KGRhdGVMZWZ0LCBkYXRlUmlnaHQpIHtcbiAgY29uc3QgZGF0ZUxlZnRTdGFydE9mRGF5ID0gc3RhcnRPZkRheShkYXRlTGVmdCk7XG4gIGNvbnN0IGRhdGVSaWdodFN0YXJ0T2ZEYXkgPSBzdGFydE9mRGF5KGRhdGVSaWdodCk7XG5cbiAgcmV0dXJuICtkYXRlTGVmdFN0YXJ0T2ZEYXkgPT09ICtkYXRlUmlnaHRTdGFydE9mRGF5O1xufVxuXG4vLyBGYWxsYmFjayBmb3IgbW9kdWxhcml6ZWQgaW1wb3J0czpcbmV4cG9ydCBkZWZhdWx0IGlzU2FtZURheTtcbiIsImxldCBkZWZhdWx0T3B0aW9ucyA9IHt9O1xuXG5leHBvcnQgZnVuY3Rpb24gZ2V0RGVmYXVsdE9wdGlvbnMoKSB7XG4gIHJldHVybiBkZWZhdWx0T3B0aW9ucztcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHNldERlZmF1bHRPcHRpb25zKG5ld09wdGlvbnMpIHtcbiAgZGVmYXVsdE9wdGlvbnMgPSBuZXdPcHRpb25zO1xufVxuIiwiaW1wb3J0IHsgdG9EYXRlIH0gZnJvbSBcIi4vdG9EYXRlLm1qc1wiO1xuaW1wb3J0IHsgZ2V0RGVmYXVsdE9wdGlvbnMgfSBmcm9tIFwiLi9fbGliL2RlZmF1bHRPcHRpb25zLm1qc1wiO1xuXG4vKipcbiAqIFRoZSB7QGxpbmsgc3RhcnRPZldlZWt9IGZ1bmN0aW9uIG9wdGlvbnMuXG4gKi9cblxuLyoqXG4gKiBAbmFtZSBzdGFydE9mV2Vla1xuICogQGNhdGVnb3J5IFdlZWsgSGVscGVyc1xuICogQHN1bW1hcnkgUmV0dXJuIHRoZSBzdGFydCBvZiBhIHdlZWsgZm9yIHRoZSBnaXZlbiBkYXRlLlxuICpcbiAqIEBkZXNjcmlwdGlvblxuICogUmV0dXJuIHRoZSBzdGFydCBvZiBhIHdlZWsgZm9yIHRoZSBnaXZlbiBkYXRlLlxuICogVGhlIHJlc3VsdCB3aWxsIGJlIGluIHRoZSBsb2NhbCB0aW1lem9uZS5cbiAqXG4gKiBAdHlwZVBhcmFtIERhdGVUeXBlIC0gVGhlIGBEYXRlYCB0eXBlLCB0aGUgZnVuY3Rpb24gb3BlcmF0ZXMgb24uIEdldHMgaW5mZXJyZWQgZnJvbSBwYXNzZWQgYXJndW1lbnRzLiBBbGxvd3MgdG8gdXNlIGV4dGVuc2lvbnMgbGlrZSBbYFVUQ0RhdGVgXShodHRwczovL2dpdGh1Yi5jb20vZGF0ZS1mbnMvdXRjKS5cbiAqXG4gKiBAcGFyYW0gZGF0ZSAtIFRoZSBvcmlnaW5hbCBkYXRlXG4gKiBAcGFyYW0gb3B0aW9ucyAtIEFuIG9iamVjdCB3aXRoIG9wdGlvbnNcbiAqXG4gKiBAcmV0dXJucyBUaGUgc3RhcnQgb2YgYSB3ZWVrXG4gKlxuICogQGV4YW1wbGVcbiAqIC8vIFRoZSBzdGFydCBvZiBhIHdlZWsgZm9yIDIgU2VwdGVtYmVyIDIwMTQgMTE6NTU6MDA6XG4gKiBjb25zdCByZXN1bHQgPSBzdGFydE9mV2VlayhuZXcgRGF0ZSgyMDE0LCA4LCAyLCAxMSwgNTUsIDApKVxuICogLy89PiBTdW4gQXVnIDMxIDIwMTQgMDA6MDA6MDBcbiAqXG4gKiBAZXhhbXBsZVxuICogLy8gSWYgdGhlIHdlZWsgc3RhcnRzIG9uIE1vbmRheSwgdGhlIHN0YXJ0IG9mIHRoZSB3ZWVrIGZvciAyIFNlcHRlbWJlciAyMDE0IDExOjU1OjAwOlxuICogY29uc3QgcmVzdWx0ID0gc3RhcnRPZldlZWsobmV3IERhdGUoMjAxNCwgOCwgMiwgMTEsIDU1LCAwKSwgeyB3ZWVrU3RhcnRzT246IDEgfSlcbiAqIC8vPT4gTW9uIFNlcCAwMSAyMDE0IDAwOjAwOjAwXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBzdGFydE9mV2VlayhkYXRlLCBvcHRpb25zKSB7XG4gIGNvbnN0IGRlZmF1bHRPcHRpb25zID0gZ2V0RGVmYXVsdE9wdGlvbnMoKTtcbiAgY29uc3Qgd2Vla1N0YXJ0c09uID1cbiAgICBvcHRpb25zPy53ZWVrU3RhcnRzT24gPz9cbiAgICBvcHRpb25zPy5sb2NhbGU/Lm9wdGlvbnM/LndlZWtTdGFydHNPbiA/P1xuICAgIGRlZmF1bHRPcHRpb25zLndlZWtTdGFydHNPbiA/P1xuICAgIGRlZmF1bHRPcHRpb25zLmxvY2FsZT8ub3B0aW9ucz8ud2Vla1N0YXJ0c09uID8/XG4gICAgMDtcblxuICBjb25zdCBfZGF0ZSA9IHRvRGF0ZShkYXRlKTtcbiAgY29uc3QgZGF5ID0gX2RhdGUuZ2V0RGF5KCk7XG4gIGNvbnN0IGRpZmYgPSAoZGF5IDwgd2Vla1N0YXJ0c09uID8gNyA6IDApICsgZGF5IC0gd2Vla1N0YXJ0c09uO1xuXG4gIF9kYXRlLnNldERhdGUoX2RhdGUuZ2V0RGF0ZSgpIC0gZGlmZik7XG4gIF9kYXRlLnNldEhvdXJzKDAsIDAsIDAsIDApO1xuICByZXR1cm4gX2RhdGU7XG59XG5cbi8vIEZhbGxiYWNrIGZvciBtb2R1bGFyaXplZCBpbXBvcnRzOlxuZXhwb3J0IGRlZmF1bHQgc3RhcnRPZldlZWs7XG4iLCJpbXBvcnQgeyBpc1NhbWVXZWVrIH0gZnJvbSBcIi4vaXNTYW1lV2Vlay5tanNcIjtcblxuLyoqXG4gKiBUaGUge0BsaW5rIGlzVGhpc1dlZWt9IGZ1bmN0aW9uIG9wdGlvbnMuXG4gKi9cblxuLyoqXG4gKiBAbmFtZSBpc1RoaXNXZWVrXG4gKiBAY2F0ZWdvcnkgV2VlayBIZWxwZXJzXG4gKiBAc3VtbWFyeSBJcyB0aGUgZ2l2ZW4gZGF0ZSBpbiB0aGUgc2FtZSB3ZWVrIGFzIHRoZSBjdXJyZW50IGRhdGU/XG4gKiBAcHVyZSBmYWxzZVxuICpcbiAqIEBkZXNjcmlwdGlvblxuICogSXMgdGhlIGdpdmVuIGRhdGUgaW4gdGhlIHNhbWUgd2VlayBhcyB0aGUgY3VycmVudCBkYXRlP1xuICpcbiAqIEB0eXBlUGFyYW0gRGF0ZVR5cGUgLSBUaGUgYERhdGVgIHR5cGUsIHRoZSBmdW5jdGlvbiBvcGVyYXRlcyBvbi4gR2V0cyBpbmZlcnJlZCBmcm9tIHBhc3NlZCBhcmd1bWVudHMuIEFsbG93cyB0byB1c2UgZXh0ZW5zaW9ucyBsaWtlIFtgVVRDRGF0ZWBdKGh0dHBzOi8vZ2l0aHViLmNvbS9kYXRlLWZucy91dGMpLlxuICpcbiAqIEBwYXJhbSBkYXRlIC0gVGhlIGRhdGUgdG8gY2hlY2tcbiAqIEBwYXJhbSBvcHRpb25zIC0gVGhlIG9iamVjdCB3aXRoIG9wdGlvbnNcbiAqXG4gKiBAcmV0dXJucyBUaGUgZGF0ZSBpcyBpbiB0aGlzIHdlZWtcbiAqXG4gKiBAZXhhbXBsZVxuICogLy8gSWYgdG9kYXkgaXMgMjUgU2VwdGVtYmVyIDIwMTQsIGlzIDIxIFNlcHRlbWJlciAyMDE0IGluIHRoaXMgd2Vlaz9cbiAqIGNvbnN0IHJlc3VsdCA9IGlzVGhpc1dlZWsobmV3IERhdGUoMjAxNCwgOCwgMjEpKVxuICogLy89PiB0cnVlXG4gKlxuICogQGV4YW1wbGVcbiAqIC8vIElmIHRvZGF5IGlzIDI1IFNlcHRlbWJlciAyMDE0IGFuZCB3ZWVrIHN0YXJ0cyB3aXRoIE1vbmRheVxuICogLy8gaXMgMjEgU2VwdGVtYmVyIDIwMTQgaW4gdGhpcyB3ZWVrP1xuICogY29uc3QgcmVzdWx0ID0gaXNUaGlzV2VlayhuZXcgRGF0ZSgyMDE0LCA4LCAyMSksIHsgd2Vla1N0YXJ0c09uOiAxIH0pXG4gKiAvLz0+IGZhbHNlXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpc1RoaXNXZWVrKGRhdGUsIG9wdGlvbnMpIHtcbiAgcmV0dXJuIGlzU2FtZVdlZWsoZGF0ZSwgRGF0ZS5ub3coKSwgb3B0aW9ucyk7XG59XG5cbi8vIEZhbGxiYWNrIGZvciBtb2R1bGFyaXplZCBpbXBvcnRzOlxuZXhwb3J0IGRlZmF1bHQgaXNUaGlzV2VlaztcbiIsImltcG9ydCB7IHN0YXJ0T2ZXZWVrIH0gZnJvbSBcIi4vc3RhcnRPZldlZWsubWpzXCI7XG5cbi8qKlxuICogVGhlIHtAbGluayBpc1NhbWVXZWVrfSBmdW5jdGlvbiBvcHRpb25zLlxuICovXG5cbi8qKlxuICogQG5hbWUgaXNTYW1lV2Vla1xuICogQGNhdGVnb3J5IFdlZWsgSGVscGVyc1xuICogQHN1bW1hcnkgQXJlIHRoZSBnaXZlbiBkYXRlcyBpbiB0aGUgc2FtZSB3ZWVrIChhbmQgbW9udGggYW5kIHllYXIpP1xuICpcbiAqIEBkZXNjcmlwdGlvblxuICogQXJlIHRoZSBnaXZlbiBkYXRlcyBpbiB0aGUgc2FtZSB3ZWVrIChhbmQgbW9udGggYW5kIHllYXIpP1xuICpcbiAqIEB0eXBlUGFyYW0gRGF0ZVR5cGUgLSBUaGUgYERhdGVgIHR5cGUsIHRoZSBmdW5jdGlvbiBvcGVyYXRlcyBvbi4gR2V0cyBpbmZlcnJlZCBmcm9tIHBhc3NlZCBhcmd1bWVudHMuIEFsbG93cyB0byB1c2UgZXh0ZW5zaW9ucyBsaWtlIFtgVVRDRGF0ZWBdKGh0dHBzOi8vZ2l0aHViLmNvbS9kYXRlLWZucy91dGMpLlxuICpcbiAqIEBwYXJhbSBkYXRlTGVmdCAtIFRoZSBmaXJzdCBkYXRlIHRvIGNoZWNrXG4gKiBAcGFyYW0gZGF0ZVJpZ2h0IC0gVGhlIHNlY29uZCBkYXRlIHRvIGNoZWNrXG4gKiBAcGFyYW0gb3B0aW9ucyAtIEFuIG9iamVjdCB3aXRoIG9wdGlvbnNcbiAqXG4gKiBAcmV0dXJucyBUaGUgZGF0ZXMgYXJlIGluIHRoZSBzYW1lIHdlZWsgKGFuZCBtb250aCBhbmQgeWVhcilcbiAqXG4gKiBAZXhhbXBsZVxuICogLy8gQXJlIDMxIEF1Z3VzdCAyMDE0IGFuZCA0IFNlcHRlbWJlciAyMDE0IGluIHRoZSBzYW1lIHdlZWs/XG4gKiBjb25zdCByZXN1bHQgPSBpc1NhbWVXZWVrKG5ldyBEYXRlKDIwMTQsIDcsIDMxKSwgbmV3IERhdGUoMjAxNCwgOCwgNCkpXG4gKiAvLz0+IHRydWVcbiAqXG4gKiBAZXhhbXBsZVxuICogLy8gSWYgd2VlayBzdGFydHMgd2l0aCBNb25kYXksXG4gKiAvLyBhcmUgMzEgQXVndXN0IDIwMTQgYW5kIDQgU2VwdGVtYmVyIDIwMTQgaW4gdGhlIHNhbWUgd2Vlaz9cbiAqIGNvbnN0IHJlc3VsdCA9IGlzU2FtZVdlZWsobmV3IERhdGUoMjAxNCwgNywgMzEpLCBuZXcgRGF0ZSgyMDE0LCA4LCA0KSwge1xuICogICB3ZWVrU3RhcnRzT246IDFcbiAqIH0pXG4gKiAvLz0+IGZhbHNlXG4gKlxuICogQGV4YW1wbGVcbiAqIC8vIEFyZSAxIEphbnVhcnkgMjAxNCBhbmQgMSBKYW51YXJ5IDIwMTUgaW4gdGhlIHNhbWUgd2Vlaz9cbiAqIGNvbnN0IHJlc3VsdCA9IGlzU2FtZVdlZWsobmV3IERhdGUoMjAxNCwgMCwgMSksIG5ldyBEYXRlKDIwMTUsIDAsIDEpKVxuICogLy89PiBmYWxzZVxuICovXG5leHBvcnQgZnVuY3Rpb24gaXNTYW1lV2VlayhkYXRlTGVmdCwgZGF0ZVJpZ2h0LCBvcHRpb25zKSB7XG4gIGNvbnN0IGRhdGVMZWZ0U3RhcnRPZldlZWsgPSBzdGFydE9mV2VlayhkYXRlTGVmdCwgb3B0aW9ucyk7XG4gIGNvbnN0IGRhdGVSaWdodFN0YXJ0T2ZXZWVrID0gc3RhcnRPZldlZWsoZGF0ZVJpZ2h0LCBvcHRpb25zKTtcblxuICByZXR1cm4gK2RhdGVMZWZ0U3RhcnRPZldlZWsgPT09ICtkYXRlUmlnaHRTdGFydE9mV2Vlaztcbn1cblxuLy8gRmFsbGJhY2sgZm9yIG1vZHVsYXJpemVkIGltcG9ydHM6XG5leHBvcnQgZGVmYXVsdCBpc1NhbWVXZWVrO1xuIiwiaW1wb3J0IHsgcHJvamVjdHMgfSBmcm9tIFwiLi9tYW5hZ2VQcm9qZWN0XCI7XG5pbXBvcnQgeyBpc1RvZGF5LCB0b0RhdGUsIGlzVGhpc1dlZWsgfSBmcm9tIFwiZGF0ZS1mbnNcIjtcbmltcG9ydCB7IEFkZHRvTGlzdCB9IGZyb20gXCIuL21hbmFnZUxpc3RcIjtcblxuY29uc3QgcmVuZGVyVGFzayA9ICgoKSA9PiB7XG4gICAgZnVuY3Rpb24gZGlzcGxheUFsbFRhc2soaXRlbXMsIGRpc3BsYXkpIHtcbiAgICAgICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG5cbiAgICAgICAgY29udGFpbmVyLnNldEF0dHJpYnV0ZSgnZGF0YS10YXNrSWQnLCBgJHtpdGVtcy5pZH1gKVxuXG4gICAgICAgIGNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCd0YXNrJyk7XG5cbiAgICAgICAgY29uc3QgdGl0bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKVxuICAgICAgICBjb25zdCBkdWVkYXRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIGNvbnN0IGRlc2NyaXB0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIGNvbnN0IHByaW9yaXR5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIGNvbnN0IGRlbGV0ZUJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpO1xuXG4gICAgICAgIHRpdGxlLnRleHRDb250ZW50ID0gYFRpdGxlOiAke2l0ZW1zLnRpdGxlfWA7XG4gICAgICAgIGR1ZWRhdGUudGV4dENvbnRlbnQgPSBgRHVlIERhdGU6ICR7aXRlbXMuZHVlZGF0ZX1gO1xuICAgICAgICBkZXNjcmlwdGlvbi50ZXh0Q29udGVudCA9IGBEZXNjcmlwdGlvbjogJHtpdGVtcy5kZXNjcmlwdGlvbn1gO1xuICAgICAgICBwcmlvcml0eS50ZXh0Q29udGVudCA9IGBQcmlvcml0eTogJHtpdGVtcy5wcmlvcml0eX1gO1xuICAgICAgICBkZWxldGVCdG4udGV4dENvbnRlbnQgPSAnZGVsZXRlJztcblxuICAgICAgICBkZWxldGVCdG4uc2V0QXR0cmlidXRlKCdkYXRhLXRhc2tJZCcsIGAke2l0ZW1zLmlkfWApO1xuXG4gICAgICAgIGRlbGV0ZUJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IGluaXREZWxCdG4oaXRlbXMuaWQsIGl0ZW1zLnByb2plY3QpKTtcblxuICAgICAgICBjb250YWluZXIuYXBwZW5kKHRpdGxlLCBkdWVkYXRlLCBkZXNjcmlwdGlvbiwgcHJpb3JpdHksIGRlbGV0ZUJ0bik7XG4gICAgICAgIGRpc3BsYXkuYXBwZW5kQ2hpbGQoY29udGFpbmVyKTtcblxuICAgICAgICByZXR1cm4gZGlzcGxheTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBpbml0RGVsQnRuKGlkLCBwcm9qZWN0SWQpIHtcbiAgICAgICAgbGV0IEFsbHRhc2sgPSBBZGR0b0xpc3QucmVtb3ZlVGFzayhpZCk7XG4gICAgICAgIGNvbnN0IGdlbmVyYWxMaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2dlbmVyYWwnKTtcblxuICAgICAgICBwcm9qZWN0cy51cGRhdGVHZW5lcmFsTGlzdChBbGx0YXNrKTtcbiAgICAgICAgcHJvamVjdHMudXBkYXRlUHJvamVjdExpc3QocHJvamVjdElkKTtcblxuICAgICAgICB3aGlsZSAoZ2VuZXJhbExpc3QubGFzdEVsZW1lbnRDaGlsZCkgZ2VuZXJhbExpc3QucmVtb3ZlQ2hpbGQoZ2VuZXJhbExpc3QubGFzdEVsZW1lbnRDaGlsZCk7XG4gICAgICAgIFxuICAgICAgICB1cGRhdGVEaXNwbGF5KHByb2plY3RJZCk7XG5cbiAgICAgICAgY29uc29sZS5sb2cocHJvamVjdHMucHJvamVjdExpc3QpO1xuICAgICAgICBjb25zb2xlLmxvZyhwcm9qZWN0SWQpXG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZ3JhYlRhYigpIHtcbiAgICAgICAgbGV0IGN1cnJlbnRUYWIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjZ2VuZXJhbCcpLmdldEF0dHJpYnV0ZSgnY2xhc3MnKTtcbiAgICAgICAgcmV0dXJuIGN1cnJlbnRUYWI7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gdXBkYXRlRGlzcGxheShpZCkge1xuICAgICAgICBsZXQgdGFiID0gZ3JhYlRhYigpO1xuICAgICAgICBpZiAodGFiID09PSAnaW5ib3hUYWInKSBkaXNwbGF5SW5ib3goKVxuICAgICAgICBlbHNlIGlmICh0YWIgPT09ICd0b2RheVRhYicpIGRpc3BsYXlEYWlseSgpXG4gICAgICAgIGVsc2UgaWYgKHRhYiA9PT0gJ3dlZWtUYWInKSBkaXNwbGF5V2Vla2x5KClcbiAgICAgICAgZWxzZSBpZiAodGFiID09PSBgJHtpZH1gICYmIGlkICE9PSAwKSByZW5kZXJQcm9qZWN0LmRpc3BsYXlQcm9qZWN0VGFza3MoaWQpXG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZGlzcGxheUluYm94KCkge1xuICAgICAgICBsZXQgbGlzdCA9IHByb2plY3RzLnByb2plY3RMaXN0WzBdLnRhc2tMaXN0O1xuICAgICAgICBjb25zdCBnZW5lcmFsTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNnZW5lcmFsJyk7XG4gICAgICAgIGdlbmVyYWxMaXN0LmNsYXNzTGlzdC5yZXBsYWNlKGdlbmVyYWxMaXN0LmdldEF0dHJpYnV0ZSgnY2xhc3MnKSwgJ2luYm94VGFiJyk7XG5cbiAgICAgICAgd2hpbGUgKGdlbmVyYWxMaXN0Lmxhc3RFbGVtZW50Q2hpbGQpIGdlbmVyYWxMaXN0LnJlbW92ZUNoaWxkKGdlbmVyYWxMaXN0Lmxhc3RFbGVtZW50Q2hpbGQpO1xuXG4gICAgICAgIGxpc3QuZm9yRWFjaCh0YXNrID0+IGRpc3BsYXlBbGxUYXNrKHRhc2ssIGdlbmVyYWxMaXN0KSk7XG4gICAgICAgIGNvbnNvbGUubG9nKGxpc3QpXG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZGlzcGxheURhaWx5KCkge1xuICAgICAgICBsZXQgbGlzdCA9IHByb2plY3RzLnByb2plY3RMaXN0WzBdLnRhc2tMaXN0O1xuICAgICAgICBjb25zdCBnZW5lcmFsTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNnZW5lcmFsJyk7XG4gICAgICAgIGdlbmVyYWxMaXN0LmNsYXNzTGlzdC5yZXBsYWNlKGdlbmVyYWxMaXN0LmdldEF0dHJpYnV0ZSgnY2xhc3MnKSwgJ3RvZGF5VGFiJyk7XG5cbiAgICAgICAgd2hpbGUgKGdlbmVyYWxMaXN0Lmxhc3RFbGVtZW50Q2hpbGQpIGdlbmVyYWxMaXN0LnJlbW92ZUNoaWxkKGdlbmVyYWxMaXN0Lmxhc3RFbGVtZW50Q2hpbGQpO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgZGFpbHlUYXNrcyA9IGxpc3QuZmlsdGVyKHRhc2sgPT4gaXNUb2RheSh0b0RhdGUodGFzay5kdWVkYXRlKSkpO1xuICAgICAgICBcbiAgICAgICAgZGFpbHlUYXNrcy5mb3JFYWNoKHRhc2sgPT4gZGlzcGxheUFsbFRhc2sodGFzaywgZ2VuZXJhbExpc3QpKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBkaXNwbGF5V2Vla2x5KCkge1xuICAgICAgICBsZXQgbGlzdCA9IHByb2plY3RzLnByb2plY3RMaXN0WzBdLnRhc2tMaXN0O1xuICAgICAgICBjb25zdCBnZW5lcmFsTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNnZW5lcmFsJyk7XG4gICAgICAgIGdlbmVyYWxMaXN0LmNsYXNzTGlzdC5yZXBsYWNlKGdlbmVyYWxMaXN0LmdldEF0dHJpYnV0ZSgnY2xhc3MnKSwgJ3dlZWtUYWInKTtcblxuICAgICAgICB3aGlsZSAoZ2VuZXJhbExpc3QubGFzdEVsZW1lbnRDaGlsZCkgZ2VuZXJhbExpc3QucmVtb3ZlQ2hpbGQoZ2VuZXJhbExpc3QubGFzdEVsZW1lbnRDaGlsZCk7XG5cbiAgICAgICAgY29uc3Qgd2Vla2x5VGFza3MgPSBsaXN0LmZpbHRlcih0YXNrID0+IGlzVGhpc1dlZWsodG9EYXRlKHRhc2suZHVlZGF0ZSkpKTtcblxuICAgICAgICB3ZWVrbHlUYXNrcy5mb3JFYWNoKHRhc2sgPT4gZGlzcGxheUFsbFRhc2sodGFzaywgZ2VuZXJhbExpc3QpKTtcbiAgICB9XG5cbiAgICByZXR1cm4geyBkaXNwbGF5SW5ib3gsIGRpc3BsYXlEYWlseSwgZGlzcGxheVdlZWtseSwgZGlzcGxheUFsbFRhc2ssIHVwZGF0ZURpc3BsYXksIGdyYWJUYWIgfVxufSkoKVxuXG5jb25zdCByZW5kZXJQcm9qZWN0ID0gKCgpID0+IHtcbiAgICBmdW5jdGlvbiBkaXNwbGF5UHJvamVjdChwcm9qZWN0KSB7XG4gICAgICAgIGNvbnN0IHByb2plY3REaXNwbGF5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmFsbC1wcm9qZWN0cycpO1xuICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcblxuICAgICAgICBjb25zdCBwcm9qZWN0VGl0bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgY29uc3QgcHJvamVjdFRhc2tCdG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTtcbiAgICAgICAgY29uc3QgcHJvamVjdERlbEJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpO1xuXG4gICAgICAgIGNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKGBwcm9qZWN0LSR7cHJvamVjdC5pZH1gKTtcbiAgICAgICAgY29udGFpbmVyLnNldEF0dHJpYnV0ZSgnZGF0YS1wcm9qZWN0SWQnLCBgJHtwcm9qZWN0LmlkfWApO1xuICAgICAgICBwcm9qZWN0VGFza0J0bi5zZXRBdHRyaWJ1dGUoJ2RhdGEtcHJvamVjdElkJywgYCR7cHJvamVjdC5pZH1gKTtcbiAgICAgICAgcHJvamVjdFRhc2tCdG4uc2V0QXR0cmlidXRlKCdpZCcsIGBwcm9qZWN0LSR7cHJvamVjdC5pZH1gKTtcblxuICAgICAgICBwcm9qZWN0VGl0bGUudGV4dENvbnRlbnQgPSBgJHtwcm9qZWN0LnRpdGxlfWA7XG4gICAgICAgIHByb2plY3RUYXNrQnRuLnRleHRDb250ZW50ID0gJysnO1xuICAgICAgICBwcm9qZWN0RGVsQnRuLnRleHRDb250ZW50ID0gJ2RlbGV0ZSc7XG5cbiAgICAgICAgY29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICBkaXNwbGF5UHJvamVjdFRhc2tzKHByb2plY3QuaWQpO1xuICAgICAgICB9KTtcblxuICAgICAgICBwcm9qZWN0VGFza0J0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG4gICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ3Byb2plY3QgaWQnLCBwcm9qZWN0cy5ncmFiUHJvamVjdElkKGUpKTtcbiAgICAgICAgICAgIGNvbnN0IG5ld1Rhc2tGb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI21haW4tZm9ybScpO1xuXG4gICAgICAgICAgICBwcm9qZWN0cy5ncmFiUHJvamVjdElkKGUpO1xuICAgICAgICAgICAgbmV3VGFza0Zvcm0ucmVtb3ZlQXR0cmlidXRlKCdoaWRkZW4nKTtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgfSlcblxuICAgICAgICBwcm9qZWN0RGVsQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICBpbml0RGVsUHJvakJ0bihwcm9qZWN0LmlkKTtcbiAgICAgICAgfSlcblxuICAgICAgICBjb250YWluZXIuYXBwZW5kKHByb2plY3RUaXRsZSwgcHJvamVjdFRhc2tCdG4sIHByb2plY3REZWxCdG4pO1xuICAgICAgICBwcm9qZWN0RGlzcGxheS5hcHBlbmRDaGlsZChjb250YWluZXIpO1xuXG4gICAgICAgIHJldHVybiBwcm9qZWN0RGlzcGxheVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGluaXREZWxQcm9qQnRuKHByb2plY3RJZCkge1xuICAgICAgICBwcm9qZWN0cy5yZW1vdmVQcm9qZWN0KHByb2plY3RJZCk7XG5cbiAgICAgICAgbGV0IHVwZGF0ZWRQcm9qZWN0cyA9IHByb2plY3RzLmdyYWJQcm9qZWN0TGlzdCgpO1xuICAgICAgICBsZXQgdGFza0xpc3QgPSBBZGR0b0xpc3QuVG9kb0xpc3Q7XG4gICAgICAgIGxldCB1cGRhdGVkVGFza0xpc3QgPSB0YXNrTGlzdC5maWx0ZXIodGFzayA9PiB0YXNrLnByb2plY3QgPT09IHByb2plY3RJZCk7XG5cbiAgICAgICAgdXBkYXRlZFRhc2tMaXN0LmZvckVhY2godGFzayA9PiB7XG4gICAgICAgICAgICBsZXQgbmV3TGlzdCA9IEFkZHRvTGlzdC5yZW1vdmVUYXNrKHRhc2suaWQpO1xuICAgICAgICAgICAgcHJvamVjdHMudXBkYXRlR2VuZXJhbExpc3QobmV3TGlzdCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGxldCBwcm9qZWN0c0Rpc3BsYXkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYWxsLXByb2plY3RzJyk7XG4gICAgICAgIHdoaWxlIChwcm9qZWN0c0Rpc3BsYXkubGFzdEVsZW1lbnRDaGlsZCkgcHJvamVjdHNEaXNwbGF5LnJlbW92ZUNoaWxkKHByb2plY3RzRGlzcGxheS5sYXN0RWxlbWVudENoaWxkKTtcblxuICAgICAgICB1cGRhdGVkUHJvamVjdHMuZm9yRWFjaChwcm9qZWN0ID0+IHtcbiAgICAgICAgICAgIGlmIChwcm9qZWN0LmlkID4gMCkgZGlzcGxheVByb2plY3QocHJvamVjdCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmIChwYXJzZUludChyZW5kZXJUYXNrLmdyYWJUYWIocHJvamVjdElkKSkgPT09IHByb2plY3RJZCkgcmVuZGVyVGFzay5kaXNwbGF5SW5ib3goKVxuICAgICAgICBlbHNlIHJlbmRlclRhc2sudXBkYXRlRGlzcGxheShwcm9qZWN0SWQpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGRpc3BsYXlQcm9qZWN0VGFza3MoaWQpIHtcbiAgICAgICAgbGV0IGxpc3QgPSBwcm9qZWN0cy5wcm9qZWN0TGlzdDtcbiAgICAgICAgY29uc3QgZ2VuZXJhbExpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjZ2VuZXJhbCcpO1xuICAgICAgICBnZW5lcmFsTGlzdC5jbGFzc0xpc3QucmVwbGFjZShnZW5lcmFsTGlzdC5nZXRBdHRyaWJ1dGUoJ2NsYXNzJyksIGAke2lkfWApO1xuXG4gICAgICAgIHdoaWxlIChnZW5lcmFsTGlzdC5sYXN0RWxlbWVudENoaWxkKSBnZW5lcmFsTGlzdC5yZW1vdmVDaGlsZChnZW5lcmFsTGlzdC5sYXN0RWxlbWVudENoaWxkKTtcblxuICAgICAgICBsZXQgcHJvamVjdFRhc2tzID0gcHJvamVjdHMuZ3JhYkN1cnJlbnRQcm9qZWN0VGFza3MoaWQpO1xuXG4gICAgICAgIHByb2plY3RUYXNrcy5mb3JFYWNoKHRhc2sgPT4gcmVuZGVyVGFzay5kaXNwbGF5QWxsVGFzayh0YXNrLCBnZW5lcmFsTGlzdCkpO1xuICAgIH1cblxuICAgIHJldHVybiB7IGRpc3BsYXlQcm9qZWN0LCBkaXNwbGF5UHJvamVjdFRhc2tzIH1cbn0pKClcblxuZXhwb3J0IHsgcmVuZGVyVGFzaywgcmVuZGVyUHJvamVjdCB9IiwiaW1wb3J0IHsgQWRkdG9MaXN0IH0gZnJvbSBcIi4vbWFuYWdlTGlzdFwiO1xuaW1wb3J0IHsgcmVuZGVyVGFzayB9IGZyb20gXCIuL1VJXCI7XG5pbXBvcnQgeyBwcm9qZWN0cyB9IGZyb20gXCIuL21hbmFnZVByb2plY3RcIjtcbmltcG9ydCB7IHRvRGF0ZSwgaXNUaGlzV2VlaywgaXNUb2RheSB9IGZyb20gXCJkYXRlLWZuc1wiO1xuXG5cbmNvbnN0IGNyZWF0ZVRhc2sgPSAoaWQsIHRpdGxlLCBkZXNjcmlwdGlvbiwgZHVlZGF0ZSwgcHJpb3JpdHksIHByb2plY3QpID0+IHtcbiAgICByZXR1cm4ge1xuICAgICAgICBpZCwgdGl0bGUsIGRlc2NyaXB0aW9uLCBkdWVkYXRlLCBwcmlvcml0eSwgcHJvamVjdFxuICAgIH1cbn1cblxuY29uc3QgTmV3VGFzayA9ICgoKSA9PiB7XG5cbiAgICBsZXQgdGl0bGU7XG4gICAgbGV0IGRlc2NyaXB0aW9uO1xuXG4gICAgZnVuY3Rpb24gY3JlYXRlTmV3VGFzaygpIHtcbiAgICAgICAgY29uc3QgcHJvamVjdExpc3QgPSBwcm9qZWN0cy5ncmFiUHJvamVjdExpc3QoKTtcblxuICAgICAgICB0aXRsZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0aXRsZScpLnZhbHVlO1xuICAgICAgICBkZXNjcmlwdGlvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkZXNjcmlwdGlvbicpLnZhbHVlO1xuXG4gICAgICAgIGxldCBkdWVkYXRlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RhdGUnKS52YWx1ZTtcbiAgICAgICAgbGV0IHByaW9yaXR5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ByaW9yaXR5JykudmFsdWU7XG4gICAgICAgIGxldCBpZCA9IGNyZWF0ZUlkKCk7XG4gICAgICAgIGxldCBwcm9qZWN0SWQgPSBwcm9qZWN0cy5ncmFiQ3VycmVudFByb2plY3QoKTtcblxuICAgICAgICBjb25zb2xlLmxvZyhpc1RoaXNXZWVrKHRvRGF0ZShkdWVkYXRlKSkpXG4gICAgICAgIGNvbnNvbGUubG9nKGlzVG9kYXkodG9EYXRlKGR1ZWRhdGUpKSlcblxuICAgICAgICBpZiAodGl0bGUgPT09ICcnIHx8XG4gICAgICAgICAgICBkZXNjcmlwdGlvbiA9PT0gJycgfHxcbiAgICAgICAgICAgIGR1ZWRhdGUgPT09ICcnKSByZXR1cm5cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb25zdCB0YXNrID0gY3JlYXRlVGFzayhpZCwgdGl0bGUsIGRlc2NyaXB0aW9uLCBkdWVkYXRlLCBwcmlvcml0eSwgcHJvamVjdElkKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHRhc2spO1xuXG4gICAgICAgICAgICBpZiAocHJvamVjdElkID09PSAwKSB7XG4gICAgICAgICAgICAgICAgcHJvamVjdExpc3RbMF0udGFza0xpc3QucHVzaCh0YXNrKTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhwcm9qZWN0TGlzdClcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCBwcm9qZWN0TGlzdC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGlmIChwcm9qZWN0TGlzdFtpXS5pZCA9PT0gcHJvamVjdElkKSB7XG4gICAgICAgICAgICAgICAgICAgIEFkZHRvTGlzdC5hZGRUb0xpc3QodGFzayk7XG4gICAgICAgICAgICAgICAgICAgIHByb2plY3RMaXN0W2ldLnRhc2tMaXN0LnB1c2godGFzayk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHByb2plY3RMaXN0KVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjcmVhdGVJZCgpIHtcbiAgICAgICAgbGV0IGxpc3QgPSBwcm9qZWN0cy5wcm9qZWN0TGlzdFswXS50YXNrTGlzdDtcbiAgICAgICAgbGV0IGlkO1xuXG4gICAgICAgIGlmIChsaXN0Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIGlkID0gMDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBpZCA9IGxpc3RbbGlzdC5sZW5ndGgtMV0uaWQgKyAxO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gcmVzZXQoKSB7XG4gICAgICAgIGxldCB0aXRsZVZhbHVlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RpdGxlJyk7XG4gICAgICAgIHRpdGxlVmFsdWUudmFsdWUgPSAnJztcbiAgICAgICAgdGl0bGUgPSAnJztcblxuICAgICAgICBsZXQgZGVzY3JpcHRpb25WYWx1ZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkZXNjcmlwdGlvbicpO1xuICAgICAgICBkZXNjcmlwdGlvblZhbHVlLnZhbHVlID0gJyc7XG4gICAgICAgIGRlc2NyaXB0aW9uID0gJyc7XG5cbiAgICAgICAgbGV0IGR1ZWRhdGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGF0ZScpO1xuICAgICAgICBkdWVkYXRlLnZhbHVlID0gJyc7XG5cbiAgICAgICAgbGV0IHByaW9yaXR5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ByaW9yaXR5Jyk7XG4gICAgICAgIHByaW9yaXR5LnZhbHVlID0gJ0xvdyc7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gaW5pdFN1Ym1pdEJ0bigpIHtcbiAgICAgICAgY29uc3Qgc3VibWl0QnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3N1Ym1pdCcpO1xuXG4gICAgICAgIHN1Ym1pdEJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG4gICAgICAgICAgICBzdWJtaXRUYXNrKCk7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBzdWJtaXRUYXNrKCkge1xuICAgICAgICBjb25zdCBuZXdUYXNrRm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNtYWluLWZvcm0nKTtcbiAgICAgICAgY29uc3QgbmV3VGFza0J0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNuZXdUYXNrJyk7XG4gICAgICAgIFxuICAgICAgICBjcmVhdGVOZXdUYXNrKCk7XG5cbiAgICAgICAgaWYgKHRpdGxlID09PSAnJyB8fCBkZXNjcmlwdGlvbiA9PT0gJycpIHJldHVyblxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGxldCB0YXNrTGlzdCA9IHByb2plY3RzLnByb2plY3RMaXN0WzBdLnRhc2tMaXN0XG4gICAgICAgICAgICBsZXQgcHJvamVjdElkID0gdGFza0xpc3RbdGFza0xpc3QubGVuZ3RoIC0gMV0ucHJvamVjdDsgXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHJlbmRlclRhc2sudXBkYXRlRGlzcGxheShwcm9qZWN0SWQpO1xuICAgICAgICAgICAgcmVzZXQoKTtcbiAgICAgICAgICAgIG5ld1Rhc2tGb3JtLnNldEF0dHJpYnV0ZSgnaGlkZGVuJywgJycpO1xuICAgICAgICAgICAgbmV3VGFza0J0bi5yZW1vdmVBdHRyaWJ1dGUoJ2hpZGRlbicpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gY2FuY2VsVGFzaygpIHtcbiAgICAgICAgY29uc3QgY2FuY2VsQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2NhbmNlbCcpO1xuICAgICAgICBjb25zdCBuZXdUYXNrRm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNtYWluLWZvcm0nKTtcbiAgICAgICAgY29uc3QgbmV3VGFza0J0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNuZXdUYXNrJyk7XG5cbiAgICAgICAgY2FuY2VsQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgICAgICAgICAgIHJlc2V0KCk7XG4gICAgICAgICAgICBuZXdUYXNrRm9ybS5zZXRBdHRyaWJ1dGUoJ2hpZGRlbicsICcnKTtcbiAgICAgICAgICAgIG5ld1Rhc2tCdG4ucmVtb3ZlQXR0cmlidXRlKCdoaWRkZW4nKTtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgfSlcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBvcGVuVGFza0NyZWF0b3IoKSB7XG4gICAgICAgIGNvbnN0IG5ld1Rhc2tCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjbmV3VGFzaycpO1xuICAgICAgICBjb25zdCBuZXdUYXNrRm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNtYWluLWZvcm0nKTtcblxuICAgICAgICBuZXdUYXNrQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgICAgICAgICAgIHByb2plY3RzLmdyYWJQcm9qZWN0SWQoZSk7XG4gICAgICAgICAgICBuZXdUYXNrRm9ybS5yZW1vdmVBdHRyaWJ1dGUoJ2hpZGRlbicpO1xuICAgICAgICAgICAgbmV3VGFza0J0bi5zZXRBdHRyaWJ1dGUoJ2hpZGRlbicsICcnKTtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgfSlcbiAgICB9XG5cbiAgICByZXR1cm4geyBjcmVhdGVOZXdUYXNrLCBpbml0U3VibWl0QnRuLCBjYW5jZWxUYXNrLCBvcGVuVGFza0NyZWF0b3IgfVxufSkoKTtcblxuZXhwb3J0IHsgTmV3VGFzayB9XG4iLCJpbXBvcnQgeyBOZXdUYXNrIH0gZnJvbSBcIi4vbWFuYWdlVGFzay5qc1wiO1xuaW1wb3J0IHsgcHJvamVjdHMgfSBmcm9tIFwiLi9tYW5hZ2VQcm9qZWN0LmpzXCI7XG5pbXBvcnQgeyByZW5kZXJUYXNrIH0gZnJvbSBcIi4vVUkuanNcIjtcblxuTmV3VGFzay5pbml0U3VibWl0QnRuKCk7XG5OZXdUYXNrLmNhbmNlbFRhc2soKTtcbk5ld1Rhc2sub3BlblRhc2tDcmVhdG9yKCk7XG5cbnByb2plY3RzLnN1Ym1pdFByb2plY3QoKTtcblxuY29uc3QgdG9kYXlUYWIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjdG9kYXknKTtcbmNvbnN0IHdlZWtUYWIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjd2Vla2x5Jyk7XG5jb25zdCBpbmJveFRhYiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNpbmJveCcpO1xuXG50b2RheVRhYi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycscmVuZGVyVGFzay5kaXNwbGF5RGFpbHkpO1xud2Vla1RhYi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHJlbmRlclRhc2suZGlzcGxheVdlZWtseSk7XG5pbmJveFRhYi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHJlbmRlclRhc2suZGlzcGxheUluYm94KTsiXSwibmFtZXMiOlsiQWRkdG9MaXN0IiwiVG9kb0xpc3QiLCJhZGRUb0xpc3QiLCJ0YXNrIiwicHVzaCIsImNvbnNvbGUiLCJsb2ciLCJyZW1vdmVUYXNrIiwiaWQiLCJmaWx0ZXIiLCJuZXdQcm9qZWN0IiwidGl0bGUiLCJ0YXNrTGlzdCIsInByb2plY3RzIiwicHJvamVjdFRpdGxlIiwicHJvamVjdExpc3QiLCJnZW5lcmFsTGlzdCIsImN1cnJlbnRQcm9qZWN0Iiwic3VibWl0UHJvamVjdCIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwicHJldmVudERlZmF1bHQiLCJ2YWx1ZSIsInByb2plY3RJZCIsImxlbmd0aCIsInByb2plY3QiLCJhZGRUb1Byb2plY3RMaXN0IiwiY3JlYXRlUHJvamVjdCIsInJlbmRlclByb2plY3QiLCJkaXNwbGF5UHJvamVjdCIsImdyYWJQcm9qZWN0SWQiLCJwYXJzZUludCIsInRhcmdldCIsImdldEF0dHJpYnV0ZSIsImdyYWJDdXJyZW50UHJvamVjdCIsImdyYWJQcm9qZWN0TGlzdCIsInVwZGF0ZUdlbmVyYWxMaXN0IiwibmV3TGlzdCIsInVwZGF0ZVByb2plY3RMaXN0IiwidXBkYXRlIiwiZ3JhYkN1cnJlbnRQcm9qZWN0VGFza3MiLCJyZW1vdmVQcm9qZWN0IiwidG9EYXRlIiwiYXJndW1lbnQiLCJhcmdTdHIiLCJPYmplY3QiLCJwcm90b3R5cGUiLCJ0b1N0cmluZyIsImNhbGwiLCJEYXRlIiwiY29uc3RydWN0b3IiLCJOYU4iLCJzdGFydE9mRGF5IiwiZGF0ZSIsIl9kYXRlIiwic2V0SG91cnMiLCJpc1RvZGF5IiwiZGF0ZUxlZnQiLCJkYXRlUmlnaHQiLCJub3ciLCJkZWZhdWx0T3B0aW9ucyIsImdldERlZmF1bHRPcHRpb25zIiwic3RhcnRPZldlZWsiLCJvcHRpb25zIiwid2Vla1N0YXJ0c09uIiwibG9jYWxlIiwiZGF5IiwiZ2V0RGF5IiwiZGlmZiIsInNldERhdGUiLCJnZXREYXRlIiwiaXNUaGlzV2VlayIsImlzU2FtZVdlZWsiLCJyZW5kZXJUYXNrIiwiZGlzcGxheUFsbFRhc2siLCJpdGVtcyIsImRpc3BsYXkiLCJjb250YWluZXIiLCJjcmVhdGVFbGVtZW50Iiwic2V0QXR0cmlidXRlIiwiY2xhc3NMaXN0IiwiYWRkIiwiZHVlZGF0ZSIsImRlc2NyaXB0aW9uIiwicHJpb3JpdHkiLCJkZWxldGVCdG4iLCJ0ZXh0Q29udGVudCIsIkFsbHRhc2siLCJsYXN0RWxlbWVudENoaWxkIiwicmVtb3ZlQ2hpbGQiLCJ1cGRhdGVEaXNwbGF5IiwiaW5pdERlbEJ0biIsImFwcGVuZCIsImFwcGVuZENoaWxkIiwiZ3JhYlRhYiIsInRhYiIsImRpc3BsYXlJbmJveCIsImRpc3BsYXlEYWlseSIsImRpc3BsYXlXZWVrbHkiLCJkaXNwbGF5UHJvamVjdFRhc2tzIiwibGlzdCIsInJlcGxhY2UiLCJmb3JFYWNoIiwicHJvamVjdERpc3BsYXkiLCJwcm9qZWN0VGFza0J0biIsInByb2plY3REZWxCdG4iLCJzdG9wUHJvcGFnYXRpb24iLCJuZXdUYXNrRm9ybSIsInJlbW92ZUF0dHJpYnV0ZSIsInVwZGF0ZWRQcm9qZWN0cyIsInByb2plY3RzRGlzcGxheSIsImluaXREZWxQcm9qQnRuIiwiTmV3VGFzayIsImNyZWF0ZU5ld1Rhc2siLCJnZXRFbGVtZW50QnlJZCIsImNyZWF0ZUlkIiwiY3JlYXRlVGFzayIsImkiLCJyZXNldCIsImluaXRTdWJtaXRCdG4iLCJuZXdUYXNrQnRuIiwic3VibWl0VGFzayIsImNhbmNlbFRhc2siLCJjYW5jZWxCdG4iLCJvcGVuVGFza0NyZWF0b3IiLCJ0b2RheVRhYiIsIndlZWtUYWIiLCJpbmJveFRhYiJdLCJzb3VyY2VSb290IjoiIn0=