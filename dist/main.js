(()=>{"use strict";const t=(()=>{let t=[];return{addToList:function(e){t.push(e),console.log(t)},TodoList:t,removeTask:function(e){return t=t.filter((t=>e!==t.id))}}})(),e=function(){const t=r.grabProjectList();var e;localStorage.setItem("project",(e=t,JSON.stringify(e))),console.log(JSON.parse(localStorage.getItem("project")))},o=function(){const t=JSON.parse(localStorage.getItem("project"));t.filter((t=>0!==t.id)).forEach((t=>{t.taskList=[],r.addToProjectList(t),p.displayProject(t)})),t[0].taskList.forEach((t=>{f.addToTasklist(t.project,t),m.updateDisplay(t.project)}))},n=(t,e,o)=>({title:t,taskList:e,id:o}),r=(()=>{let o,r=[],i=t.TodoList;const l=n("General",i,0);r.push(l);let c=0;function a(t){r.push(t),console.log(r)}return{submitProject:function(){document.querySelector("#createProject").addEventListener("click",(t=>{if(t.preventDefault(),function(){o=document.querySelector("#projectTitle").value;const t=0===r.length?0:r[r.length-1].id+1;if(""!==o){const r=n(o,[],t);console.log(r),a(r),e()}}(),""!==o){let t=r[r.length-1];p.displayProject(t),document.querySelector("#projectTitle").value="",o=""}}))},grabProjectId:function(t){let e=parseInt(t.target.getAttribute("data-projectId"));return c=e,c},grabCurrentProject:function(){return c},grabProjectList:function(){return r},projectList:r,updateGeneralList:function(t){return l.taskList=t,console.log(l.taskList),l},updateProject:function(t){let e=l.taskList.filter((e=>e.project===t));return console.log(e),0!==t?r.filter((e=>e.id===t))[0].taskList=e:void 0},grabCurrentProjectTasks:function(t){return console.log(r.filter((e=>e.id===t))[0].taskList),r.filter((e=>e.id===t))[0].taskList},removeProject:function(t){return console.log("before",r),r=r.filter((e=>e.id!==t)),console.log("after",r),r},addToProjectList:a}})();function i(t){const e=Object.prototype.toString.call(t);return t instanceof Date||"object"==typeof t&&"[object Date]"===e?new t.constructor(+t):"number"==typeof t||"[object Number]"===e||"string"==typeof t||"[object String]"===e?new Date(t):new Date(NaN)}function l(t){const e=i(t);return e.setHours(0,0,0,0),e}function c(t){return e=t,o=Date.now(),+l(e)==+l(o);var e,o}let a={};function s(){return a}function d(t,e){const o=s(),n=e?.weekStartsOn??e?.locale?.options?.weekStartsOn??o.weekStartsOn??o.locale?.options?.weekStartsOn??0,r=i(t),l=r.getDay(),c=(l<n?7:0)+l-n;return r.setDate(r.getDate()-c),r.setHours(0,0,0,0),r}function u(t,e){return function(t,e,o){return+d(t,o)==+d(e,o)}(t,Date.now(),e)}const m=(()=>{function o(o,i){const l=document.createElement("div");l.setAttribute("data-taskId",`${o.id}`),l.classList.add("task");const c=document.createElement("div"),s=document.createElement("div"),d=document.createElement("div"),u=document.createElement("div"),m=document.createElement("button"),p=document.createElement("button"),f=document.createElement("input"),g=document.createElement("label");return c.textContent=`Title: ${o.title}`,s.textContent=`Due Date: ${o.duedate}`,d.textContent=`Details: ${o.details}`,u.textContent=`Priority: ${o.priority}`,m.textContent="delete",p.textContent="edit",g.textContent="Done?",f.setAttribute("type","checkbox"),f.setAttribute("id",`status-${o.id}`),f.setAttribute("name","status"),f.setAttribute("value","off"),g.setAttribute("for",`status-${o.id}`),m.setAttribute("data-taskId",`${o.id}`),f.addEventListener("click",(()=>{"off"===f.value?n(o,f,g,p,l):function(t,e,o,n,r){o.textContent="Done?",e.value="off",n.removeAttribute("disabled"),t.status="unfinished",r.classList.remove("finished")}(o,f,g,p,l),e()})),m.addEventListener("click",(()=>function(o,n){let i=t.removeTask(o);const l=document.querySelector("#general");for(r.updateGeneralList(i),r.updateProject(n),e();l.lastElementChild;)l.removeChild(l.lastElementChild);a(n),console.log(r.projectList),console.log(n)}(o.id,o.project))),p.addEventListener("click",(()=>{!function(t){const e=document.querySelector("#main-form");e.classList.add("edit-mode"),e.setAttribute("data-taskId",`${t.id}`);let o=document.getElementById("title"),n=document.getElementById("details"),r=document.getElementById("date"),i=document.getElementById("priority");const l=t.title,c=t.details,a=t.duedate,s=t.priority;o.value=l,n.value=c,r.value=a,i.value=s,e.removeAttribute("hidden")}(o)})),"finished"===o.status&&(f.setAttribute("checked",""),n(o,f,g,p,l)),l.append(c,s,d,u,m,p,g,f),i.appendChild(l),i}function n(t,e,o,n,r){o.textContent="Done!",e.value="on",n.setAttribute("disabled",""),t.status="finished",r.classList.add("finished")}function l(){return document.querySelector("#general").getAttribute("class")}function a(t){let e=l();"inboxTab"===e?s():"todayTab"===e?d():"weekTab"===e?m():e===`${t}`&&0!==t&&p.displayProjectTasks(t)}function s(){let t=r.grabProjectList()[0].taskList;const e=document.querySelector("#general");for(e.classList.replace(e.getAttribute("class"),"inboxTab");e.lastElementChild;)e.removeChild(e.lastElementChild);console.log(t),t.forEach((t=>o(t,e))),console.log(r.projectList)}function d(){let t=r.grabProjectList()[0].taskList;const e=document.querySelector("#general");for(e.classList.replace(e.getAttribute("class"),"todayTab");e.lastElementChild;)e.removeChild(e.lastElementChild);t.filter((t=>c(i(t.duedate)))).forEach((t=>o(t,e)))}function m(){let t=r.grabProjectList()[0].taskList;const e=document.querySelector("#general");for(e.classList.replace(e.getAttribute("class"),"weekTab");e.lastElementChild;)e.removeChild(e.lastElementChild);t.filter((t=>u(i(t.duedate)))).forEach((t=>o(t,e)))}return{displayInbox:s,displayDaily:d,displayWeekly:m,displayAllTask:o,updateDisplay:a,grabTab:l}})(),p=(()=>{function o(t){r.projectList;const e=document.querySelector("#general");for(e.classList.replace(e.getAttribute("class"),`${t}`);e.lastElementChild;)e.removeChild(e.lastElementChild);r.grabCurrentProjectTasks(t).forEach((t=>m.displayAllTask(t,e)))}return{displayProject:function n(i){const l=document.querySelector(".all-projects"),c=document.createElement("div"),a=document.createElement("div"),s=document.createElement("button"),d=document.createElement("button");return c.classList.add(`project-${i.id}`),c.setAttribute("data-projectId",`${i.id}`),s.setAttribute("data-projectId",`${i.id}`),s.setAttribute("id",`project-${i.id}`),a.textContent=`${i.title}`,s.textContent="+",d.textContent="delete",c.addEventListener("click",(t=>{t.stopPropagation(),o(i.id)})),s.addEventListener("click",(t=>{t.stopPropagation(),console.log("project id",r.grabProjectId(t));const e=document.querySelector("#main-form");r.grabProjectId(t),e.removeAttribute("hidden"),t.preventDefault()})),d.addEventListener("click",(o=>{o.stopPropagation(),function(o){r.removeProject(o);let i=r.grabProjectList();t.TodoList.filter((t=>t.project===o)).forEach((e=>{let o=t.removeTask(e.id);r.updateGeneralList(o)}));let l=document.querySelector(".all-projects");for(;l.lastElementChild;)l.removeChild(l.lastElementChild);i.forEach((t=>{t.id>0&&n(t)})),parseInt(m.grabTab(o))===o?m.displayInbox():m.updateDisplay(o),e()}(i.id)})),c.append(a,s,d),l.appendChild(c),l},displayProjectTasks:o}})(),f=(()=>{let o,n;function l(){r.grabProjectList(),o=document.getElementById("title").value,n=document.getElementById("details").value;let t=document.getElementById("date").value,e=document.getElementById("priority").value,l=function(){let t=r.grabProjectList()[0].taskList;return 0===t.length?0:t[t.length-1].id+1}(),s=r.grabCurrentProject();if(console.log(u(i(t))),console.log(c(i(t))),""===o||""===n||""===t)return;const d=((t,e,o,n,r,i,l)=>({id:t,title:e,details:o,duedate:n,priority:r,project:i,status:"unfinished"}))(l,o,n,t,e,s);console.log(d),a(s,d)}function a(e,o){const n=r.grabProjectList();0===e&&(n[0].taskList.push(o),console.log(n));for(let r=1;r<n.length;r++)n[r].id===e&&(t.addToList(o),n[r].taskList.push(o),console.log(n))}function s(){document.getElementById("title").value="",o="",document.getElementById("details").value="",n="",document.getElementById("date").value="",document.getElementById("priority").value="Low"}return{createNewTask:l,initSubmitBtn:function(){document.querySelector("#submit").addEventListener("click",(t=>{!function(){const t=document.querySelector("#main-form"),i=document.querySelector("#newTask"),c=parseInt(t.getAttribute("data-taskId"));if("edit-mode"===t.getAttribute("class")?(console.log("werk"),function(t){let e=document.getElementById("title").value,i=document.getElementById("details").value,l=document.getElementById("date").value,c=document.getElementById("priority").value;const a=r.grabProjectList()[0].taskList,s=a.filter((e=>t===e.id))[0];s.title=e,s.details=i,s.duedate=l,s.priority=c,o=e,n=i;for(let e=0;e<a.length;e++)a[e].id===t&&(a[e]=s,r.updateProject(a[e].project),console.log(r.grabProjectList()))}(c)):l(),e(),""===o||""===n)return;let a,d=r.grabProjectList()[0].taskList;"edit-mode"===t.getAttribute("class")?(a=d.filter((t=>c===t.id))[0].project,t.classList.remove("edit-mode")):a=d[d.length-1].project,m.updateDisplay(a),s(),t.setAttribute("hidden",""),i.removeAttribute("hidden")}(),t.preventDefault()}))},cancelTask:function(){const t=document.querySelector("#cancel"),e=document.querySelector("#main-form"),o=document.querySelector("#newTask");t.addEventListener("click",(t=>{s(),e.setAttribute("hidden",""),o.removeAttribute("hidden"),t.preventDefault()}))},openTaskCreator:function(){const t=document.querySelector("#newTask"),e=document.querySelector("#main-form");t.addEventListener("click",(o=>{r.grabProjectId(o),e.removeAttribute("hidden"),t.setAttribute("hidden",""),o.preventDefault()}))},addToTasklist:a}})();f.initSubmitBtn(),f.cancelTask(),f.openTaskCreator(),r.submitProject();const g=document.querySelector("#today"),b=document.querySelector("#weekly"),y=document.querySelector("#inbox");g.addEventListener("click",m.displayDaily),b.addEventListener("click",m.displayWeekly),y.addEventListener("click",m.displayInbox),document.addEventListener("DOMContentLoaded",o)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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U0MsY0FBYyxjQUNyQ3lHLEVBQWExRyxTQUFTQyxjQUFjLFlBRTFDK0csRUFBVTlHLGlCQUFpQixTQUFVQyxJQUNqQ3FHLElBQ0FSLEVBQVl6QyxhQUFhLFNBQVUsSUFDbkNtRCxFQUFXdkMsZ0JBQWdCLFVBQzNCaEUsRUFBRUMsZ0JBQWdCLEdBRTFCLEVBY21ENkcsZ0JBWm5ELFdBQ0ksTUFBTVAsRUFBYTFHLFNBQVNDLGNBQWMsWUFDcEMrRixFQUFjaEcsU0FBU0MsY0FBYyxjQUUzQ3lHLEVBQVd4RyxpQkFBaUIsU0FBVUMsSUFDbEM3QixFQUFTbUMsY0FBY04sR0FDdkI2RixFQUFZN0IsZ0JBQWdCLFVBQzVCdUMsRUFBV25ELGFBQWEsU0FBVSxJQUNsQ3BELEVBQUVDLGdCQUFnQixHQUUxQixFQUVvRWIsZ0JBQ3ZFLEVBbktlLEdDUmhCRCxFQUFRbUgsZ0JBQ1JuSCxFQUFReUgsYUFDUnpILEVBQVEySCxrQkFFUjNJLEVBQVN5QixnQkFFVCxNQUFNbUgsRUFBV2xILFNBQVNDLGNBQWMsVUFDbENrSCxFQUFVbkgsU0FBU0MsY0FBYyxXQUNqQ21ILEVBQVdwSCxTQUFTQyxjQUFjLFVBRXhDaUgsRUFBU2hILGlCQUFpQixRQUFRVixFQUFXK0YsY0FDN0M0QixFQUFRakgsaUJBQWlCLFFBQVNWLEVBQVdnRyxlQUM3QzRCLEVBQVNsSCxpQkFBaUIsUUFBU1YsRUFBVzhGLGNBRTlDdEYsU0FBU0UsaUJBQWlCLG1CQUFvQjlCLEUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly90b2RvLWxpc3QvLi9zcmMvbWFuYWdlTGlzdC5qcyIsIndlYnBhY2s6Ly90b2RvLWxpc3QvLi9zcmMvc3RvcmFnZS5qcyIsIndlYnBhY2s6Ly90b2RvLWxpc3QvLi9zcmMvbWFuYWdlUHJvamVjdC5qcyIsIndlYnBhY2s6Ly90b2RvLWxpc3QvLi9ub2RlX21vZHVsZXMvZGF0ZS1mbnMvdG9EYXRlLm1qcyIsIndlYnBhY2s6Ly90b2RvLWxpc3QvLi9ub2RlX21vZHVsZXMvZGF0ZS1mbnMvc3RhcnRPZkRheS5tanMiLCJ3ZWJwYWNrOi8vdG9kby1saXN0Ly4vbm9kZV9tb2R1bGVzL2RhdGUtZm5zL2lzVG9kYXkubWpzIiwid2VicGFjazovL3RvZG8tbGlzdC8uL25vZGVfbW9kdWxlcy9kYXRlLWZucy9pc1NhbWVEYXkubWpzIiwid2VicGFjazovL3RvZG8tbGlzdC8uL25vZGVfbW9kdWxlcy9kYXRlLWZucy9fbGliL2RlZmF1bHRPcHRpb25zLm1qcyIsIndlYnBhY2s6Ly90b2RvLWxpc3QvLi9ub2RlX21vZHVsZXMvZGF0ZS1mbnMvc3RhcnRPZldlZWsubWpzIiwid2VicGFjazovL3RvZG8tbGlzdC8uL25vZGVfbW9kdWxlcy9kYXRlLWZucy9pc1RoaXNXZWVrLm1qcyIsIndlYnBhY2s6Ly90b2RvLWxpc3QvLi9ub2RlX21vZHVsZXMvZGF0ZS1mbnMvaXNTYW1lV2Vlay5tanMiLCJ3ZWJwYWNrOi8vdG9kby1saXN0Ly4vc3JjL1VJLmpzIiwid2VicGFjazovL3RvZG8tbGlzdC8uL3NyYy9tYW5hZ2VUYXNrLmpzIiwid2VicGFjazovL3RvZG8tbGlzdC8uL3NyYy9pbmRleC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBBZGR0b0xpc3QgPSAoKCkgPT4ge1xuICAgIGxldCBUb2RvTGlzdCA9IFtdO1xuXG4gICAgZnVuY3Rpb24gYWRkVG9MaXN0KHRhc2spIHtcbiAgICAgICAgVG9kb0xpc3QucHVzaCh0YXNrKTtcbiAgICAgICAgY29uc29sZS5sb2coVG9kb0xpc3QpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHJlbW92ZVRhc2soaWQpIHtcbiAgICAgICAgcmV0dXJuIFRvZG9MaXN0ID0gVG9kb0xpc3QuZmlsdGVyKHRhc2sgPT4gaWQgIT09IHRhc2suaWQpO1xuICAgIH1cblxuICAgIHJldHVybiB7IGFkZFRvTGlzdCwgVG9kb0xpc3QsIHJlbW92ZVRhc2sgfTtcbn0pKClcblxuXG5leHBvcnQgeyBBZGR0b0xpc3QgfSIsImltcG9ydCB7IHByb2plY3RzIH0gZnJvbSBcIi4vbWFuYWdlUHJvamVjdFwiO1xuaW1wb3J0IHsgcmVuZGVyUHJvamVjdCwgcmVuZGVyVGFzayB9IGZyb20gXCIuL1VJXCI7XG5pbXBvcnQgeyBBZGR0b0xpc3QgfSBmcm9tIFwiLi9tYW5hZ2VMaXN0XCI7XG5pbXBvcnQgeyBOZXdUYXNrIH0gZnJvbSBcIi4vbWFuYWdlVGFza1wiO1xuXG5jb25zdCBzdG9yZUxvY2FsID0gKCgpID0+IHtcbiAgICBmdW5jdGlvbiBzdHJpbmdpZnkoaXRlbSkge1xuICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoaXRlbSk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gc3RvcmVQcm9qZWN0cygpIHtcbiAgICAgICAgY29uc3QgcHJvamVjdExpc3QgPSBwcm9qZWN0cy5ncmFiUHJvamVjdExpc3QoKTtcbiAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3Byb2plY3QnLCBzdHJpbmdpZnkocHJvamVjdExpc3QpKTtcbiAgICAgICAgY29uc29sZS5sb2coSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgncHJvamVjdCcpKSk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gbG9hZFN0b3JhZ2UoKSB7XG4gICAgICAgIGNvbnN0IG5ld0xpc3QgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdwcm9qZWN0JykpO1xuXG4gICAgICAgIC8qIGxldCBnZW5MaXN0ID0gbmV3TGlzdFswXTtcbiAgICAgICAgZ2VuTGlzdC50YXNrTGlzdC5mb3JFYWNoKHRhc2sgPT4ge1xuICAgICAgICAgICAgQWRkdG9MaXN0LmFkZFRvTGlzdCh0YXNrKTtcbiAgICAgICAgICAgIHJlbmRlclRhc2sudXBkYXRlRGlzcGxheSh0YXNrLnByb2plY3QpXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGxldCBsb2FkZWRQcm9qZWN0cyA9IG5ld0xpc3QuZmlsdGVyKHByb2plY3QgPT4gcHJvamVjdC5pZCAhPT0gMCk7XG4gICAgICAgIGxvYWRlZFByb2plY3RzLmZvckVhY2gocHJvamVjdCA9PiB7XG4gICAgICAgICAgICBwcm9qZWN0cy5hZGRUb1Byb2plY3RMaXN0KHByb2plY3QpO1xuICAgICAgICAgICAgcmVuZGVyUHJvamVjdC5kaXNwbGF5UHJvamVjdChwcm9qZWN0KTtcbiAgICAgICAgfSk7ICovXG5cbiAgICAgICAgbGV0IGxvYWRlZFByb2plY3RzID0gbmV3TGlzdC5maWx0ZXIocHJvamVjdCA9PiBwcm9qZWN0LmlkICE9PSAwKTtcbiAgICAgICAgbG9hZGVkUHJvamVjdHMuZm9yRWFjaChwcm9qZWN0ID0+IHtcbiAgICAgICAgICAgIHByb2plY3QudGFza0xpc3QgPSBbXTtcbiAgICAgICAgICAgIHByb2plY3RzLmFkZFRvUHJvamVjdExpc3QocHJvamVjdCk7XG4gICAgICAgICAgICByZW5kZXJQcm9qZWN0LmRpc3BsYXlQcm9qZWN0KHByb2plY3QpO1xuICAgICAgICB9KTtcblxuICAgICAgICBsZXQgZ2VuTGlzdCA9IG5ld0xpc3RbMF07XG5cbiAgICAgICAgZ2VuTGlzdC50YXNrTGlzdC5mb3JFYWNoKHRhc2sgPT4ge1xuICAgICAgICAgICAgTmV3VGFzay5hZGRUb1Rhc2tsaXN0KHRhc2sucHJvamVjdCwgdGFzayk7XG4gICAgICAgICAgICByZW5kZXJUYXNrLnVwZGF0ZURpc3BsYXkodGFzay5wcm9qZWN0KTtcbiAgICAgICAgfSlcbiAgICAgICAgXG4gICAgfVxuXG4gICAgcmV0dXJuIHsgc3RvcmVQcm9qZWN0cyxcbiAgICAgICAgICAgICBsb2FkU3RvcmFnZSB9XG59KSgpO1xuXG5leHBvcnQge3N0b3JlTG9jYWx9IiwiaW1wb3J0IHsgcmVuZGVyUHJvamVjdCB9IGZyb20gXCIuL1VJXCI7XG5pbXBvcnQgeyBBZGR0b0xpc3QgfSBmcm9tIFwiLi9tYW5hZ2VMaXN0XCI7XG5pbXBvcnQgeyBzdG9yZUxvY2FsIH0gZnJvbSBcIi4vc3RvcmFnZVwiO1xuXG5jb25zdCBuZXdQcm9qZWN0ID0gKHRpdGxlLCB0YXNrTGlzdCwgaWQpID0+IHtcbiAgICByZXR1cm4geyB0aXRsZSwgdGFza0xpc3QsIGlkIH07XG59XG5cbmNvbnN0IHByb2plY3RzID0gKCgpID0+IHtcbiAgICBsZXQgcHJvamVjdFRpdGxlXG4gICAgbGV0IHByb2plY3RMaXN0ID0gW107XG5cbiAgICBsZXQgdGFza0xpc3QgPSBBZGR0b0xpc3QuVG9kb0xpc3Q7XG5cbiAgICBjb25zdCBnZW5lcmFsTGlzdCA9IG5ld1Byb2plY3QoJ0dlbmVyYWwnLCB0YXNrTGlzdCwgMCk7XG4gICAgcHJvamVjdExpc3QucHVzaChnZW5lcmFsTGlzdCk7XG5cbiAgICBsZXQgY3VycmVudFByb2plY3QgPSAwO1xuXG4gICAgZnVuY3Rpb24gdXBkYXRlR2VuZXJhbExpc3QobmV3TGlzdCkge1xuICAgICAgICBnZW5lcmFsTGlzdC50YXNrTGlzdCA9IG5ld0xpc3RcbiAgICAgICAgY29uc29sZS5sb2coZ2VuZXJhbExpc3QudGFza0xpc3QpXG4gICAgICAgIHJldHVybiBnZW5lcmFsTGlzdFxuICAgIH1cblxuICAgIGZ1bmN0aW9uIHVwZGF0ZVByb2plY3QoaWQpIHtcbiAgICAgICAgbGV0IHVwZGF0ZSA9IGdlbmVyYWxMaXN0LnRhc2tMaXN0LmZpbHRlcih0YXNrID0+IHRhc2sucHJvamVjdCA9PT0gaWQpO1xuICAgICAgICBjb25zb2xlLmxvZyh1cGRhdGUpXG4gICAgICAgIGlmIChpZCAhPT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIHByb2plY3RMaXN0LmZpbHRlcihwcm9qZWN0ID0+IHByb2plY3QuaWQgPT09IGlkKVswXS50YXNrTGlzdCA9IHVwZGF0ZVxuICAgICAgICB9IGVsc2UgcmV0dXJuO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdyYWJDdXJyZW50UHJvamVjdFRhc2tzKGlkKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKHByb2plY3RMaXN0LmZpbHRlcihwcm9qZWN0ID0+IHByb2plY3QuaWQgPT09IGlkKVswXS50YXNrTGlzdClcbiAgICAgICAgcmV0dXJuIHByb2plY3RMaXN0LmZpbHRlcihwcm9qZWN0ID0+IHByb2plY3QuaWQgPT09IGlkKVswXS50YXNrTGlzdFxuICAgIH1cblxuICAgIGZ1bmN0aW9uIHJlbW92ZVByb2plY3QoaWQpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ2JlZm9yZScsIHByb2plY3RMaXN0KTtcbiAgICAgICAgcHJvamVjdExpc3QgPSBwcm9qZWN0TGlzdC5maWx0ZXIocHJvamVjdCA9PiBwcm9qZWN0LmlkICE9PSBpZCk7XG4gICAgICAgIGNvbnNvbGUubG9nKCdhZnRlcicsIHByb2plY3RMaXN0KTtcbiAgICAgICAgcmV0dXJuIHByb2plY3RMaXN0XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZ3JhYkN1cnJlbnRQcm9qZWN0KCkge1xuICAgICAgICByZXR1cm4gY3VycmVudFByb2plY3Q7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZ3JhYlByb2plY3RMaXN0KCkge1xuICAgICAgICByZXR1cm4gcHJvamVjdExpc3Q7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gY3JlYXRlUHJvamVjdCgpIHtcbiAgICAgICAgcHJvamVjdFRpdGxlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3Byb2plY3RUaXRsZScpLnZhbHVlO1xuICAgICAgICBjb25zdCBwcm9qZWN0SWQgPSBjcmVhdGVQcm9qZWN0SWQoKVxuICAgICAgICBjb25zdCBwcm9qZWN0VGFza3MgPSBbXTtcblxuICAgICAgICBpZiAocHJvamVjdFRpdGxlID09PSAnJykgcmV0dXJuXG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgcHJvamVjdCA9IG5ld1Byb2plY3QocHJvamVjdFRpdGxlLCBwcm9qZWN0VGFza3MsIHByb2plY3RJZCk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhwcm9qZWN0KTtcbiAgICAgICAgICAgIGFkZFRvUHJvamVjdExpc3QocHJvamVjdCk7XG4gICAgICAgICAgICBzdG9yZUxvY2FsLnN0b3JlUHJvamVjdHMoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGNyZWF0ZVByb2plY3RJZCgpIHtcbiAgICAgICAgbGV0IGlkO1xuICAgICAgICBpZiAocHJvamVjdExpc3QubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gaWQgPSAwO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIGlkID0gcHJvamVjdExpc3RbcHJvamVjdExpc3QubGVuZ3RoIC0gMV0uaWQgKyAxO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gYWRkVG9Qcm9qZWN0TGlzdChwcm9qZWN0KSB7XG4gICAgICAgIHByb2plY3RMaXN0LnB1c2gocHJvamVjdCk7XG4gICAgICAgIGNvbnNvbGUubG9nKHByb2plY3RMaXN0KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiByZXNldCgpIHtcbiAgICAgICAgbGV0IHByb2plY3RUaXRsZVZhbHVlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3Byb2plY3RUaXRsZScpO1xuICAgICAgICBwcm9qZWN0VGl0bGVWYWx1ZS52YWx1ZSA9ICcnO1xuICAgICAgICBwcm9qZWN0VGl0bGUgPSAnJztcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBzdWJtaXRQcm9qZWN0KCkge1xuICAgICAgICBjb25zdCBjcmVhdGVQcm9qZWN0QnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2NyZWF0ZVByb2plY3QnKTtcblxuICAgICAgICBjcmVhdGVQcm9qZWN0QnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY3JlYXRlUHJvamVjdCgpO1xuICAgICAgICAgICAgaWYgKHByb2plY3RUaXRsZSA9PT0gJycpIHJldHVyblxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgbGV0IHByb2plY3QgPSBwcm9qZWN0TGlzdFtwcm9qZWN0TGlzdC5sZW5ndGggLTFdO1xuXG4gICAgICAgICAgICAgICAgcmVuZGVyUHJvamVjdC5kaXNwbGF5UHJvamVjdChwcm9qZWN0KTtcbiAgICAgICAgICAgICAgICByZXNldCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdyYWJQcm9qZWN0SWQoZSkge1xuICAgICAgICBsZXQgcHJvamVjdElkID0gcGFyc2VJbnQoZS50YXJnZXQuZ2V0QXR0cmlidXRlKCdkYXRhLXByb2plY3RJZCcpKTtcblxuICAgICAgICBjdXJyZW50UHJvamVjdCA9IHByb2plY3RJZDtcblxuICAgICAgICByZXR1cm4gY3VycmVudFByb2plY3Q7XG4gICAgfVxuXG4gICAgcmV0dXJuIHsgc3VibWl0UHJvamVjdCxcbiAgICAgICAgICAgICBncmFiUHJvamVjdElkLFxuICAgICAgICAgICAgIGdyYWJDdXJyZW50UHJvamVjdCwgXG4gICAgICAgICAgICAgZ3JhYlByb2plY3RMaXN0LCBcbiAgICAgICAgICAgICBwcm9qZWN0TGlzdCwgXG4gICAgICAgICAgICAgdXBkYXRlR2VuZXJhbExpc3QsXG4gICAgICAgICAgICAgdXBkYXRlUHJvamVjdCwgXG4gICAgICAgICAgICAgZ3JhYkN1cnJlbnRQcm9qZWN0VGFza3MsIFxuICAgICAgICAgICAgIHJlbW92ZVByb2plY3QsXG4gICAgICAgICAgICAgYWRkVG9Qcm9qZWN0TGlzdCB9XG59KSgpXG5cbmV4cG9ydCB7IHByb2plY3RzIH1cblxuIiwiLyoqXG4gKiBAbmFtZSB0b0RhdGVcbiAqIEBjYXRlZ29yeSBDb21tb24gSGVscGVyc1xuICogQHN1bW1hcnkgQ29udmVydCB0aGUgZ2l2ZW4gYXJndW1lbnQgdG8gYW4gaW5zdGFuY2Ugb2YgRGF0ZS5cbiAqXG4gKiBAZGVzY3JpcHRpb25cbiAqIENvbnZlcnQgdGhlIGdpdmVuIGFyZ3VtZW50IHRvIGFuIGluc3RhbmNlIG9mIERhdGUuXG4gKlxuICogSWYgdGhlIGFyZ3VtZW50IGlzIGFuIGluc3RhbmNlIG9mIERhdGUsIHRoZSBmdW5jdGlvbiByZXR1cm5zIGl0cyBjbG9uZS5cbiAqXG4gKiBJZiB0aGUgYXJndW1lbnQgaXMgYSBudW1iZXIsIGl0IGlzIHRyZWF0ZWQgYXMgYSB0aW1lc3RhbXAuXG4gKlxuICogSWYgdGhlIGFyZ3VtZW50IGlzIG5vbmUgb2YgdGhlIGFib3ZlLCB0aGUgZnVuY3Rpb24gcmV0dXJucyBJbnZhbGlkIERhdGUuXG4gKlxuICogKipOb3RlKio6ICphbGwqIERhdGUgYXJndW1lbnRzIHBhc3NlZCB0byBhbnkgKmRhdGUtZm5zKiBmdW5jdGlvbiBpcyBwcm9jZXNzZWQgYnkgYHRvRGF0ZWAuXG4gKlxuICogQHR5cGVQYXJhbSBEYXRlVHlwZSAtIFRoZSBgRGF0ZWAgdHlwZSwgdGhlIGZ1bmN0aW9uIG9wZXJhdGVzIG9uLiBHZXRzIGluZmVycmVkIGZyb20gcGFzc2VkIGFyZ3VtZW50cy4gQWxsb3dzIHRvIHVzZSBleHRlbnNpb25zIGxpa2UgW2BVVENEYXRlYF0oaHR0cHM6Ly9naXRodWIuY29tL2RhdGUtZm5zL3V0YykuXG4gKlxuICogQHBhcmFtIGFyZ3VtZW50IC0gVGhlIHZhbHVlIHRvIGNvbnZlcnRcbiAqXG4gKiBAcmV0dXJucyBUaGUgcGFyc2VkIGRhdGUgaW4gdGhlIGxvY2FsIHRpbWUgem9uZVxuICpcbiAqIEBleGFtcGxlXG4gKiAvLyBDbG9uZSB0aGUgZGF0ZTpcbiAqIGNvbnN0IHJlc3VsdCA9IHRvRGF0ZShuZXcgRGF0ZSgyMDE0LCAxLCAxMSwgMTEsIDMwLCAzMCkpXG4gKiAvLz0+IFR1ZSBGZWIgMTEgMjAxNCAxMTozMDozMFxuICpcbiAqIEBleGFtcGxlXG4gKiAvLyBDb252ZXJ0IHRoZSB0aW1lc3RhbXAgdG8gZGF0ZTpcbiAqIGNvbnN0IHJlc3VsdCA9IHRvRGF0ZSgxMzkyMDk4NDMwMDAwKVxuICogLy89PiBUdWUgRmViIDExIDIwMTQgMTE6MzA6MzBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHRvRGF0ZShhcmd1bWVudCkge1xuICBjb25zdCBhcmdTdHIgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoYXJndW1lbnQpO1xuXG4gIC8vIENsb25lIHRoZSBkYXRlXG4gIGlmIChcbiAgICBhcmd1bWVudCBpbnN0YW5jZW9mIERhdGUgfHxcbiAgICAodHlwZW9mIGFyZ3VtZW50ID09PSBcIm9iamVjdFwiICYmIGFyZ1N0ciA9PT0gXCJbb2JqZWN0IERhdGVdXCIpXG4gICkge1xuICAgIC8vIFByZXZlbnQgdGhlIGRhdGUgdG8gbG9zZSB0aGUgbWlsbGlzZWNvbmRzIHdoZW4gcGFzc2VkIHRvIG5ldyBEYXRlKCkgaW4gSUUxMFxuICAgIHJldHVybiBuZXcgYXJndW1lbnQuY29uc3RydWN0b3IoK2FyZ3VtZW50KTtcbiAgfSBlbHNlIGlmIChcbiAgICB0eXBlb2YgYXJndW1lbnQgPT09IFwibnVtYmVyXCIgfHxcbiAgICBhcmdTdHIgPT09IFwiW29iamVjdCBOdW1iZXJdXCIgfHxcbiAgICB0eXBlb2YgYXJndW1lbnQgPT09IFwic3RyaW5nXCIgfHxcbiAgICBhcmdTdHIgPT09IFwiW29iamVjdCBTdHJpbmddXCJcbiAgKSB7XG4gICAgLy8gVE9ETzogQ2FuIHdlIGdldCByaWQgb2YgYXM/XG4gICAgcmV0dXJuIG5ldyBEYXRlKGFyZ3VtZW50KTtcbiAgfSBlbHNlIHtcbiAgICAvLyBUT0RPOiBDYW4gd2UgZ2V0IHJpZCBvZiBhcz9cbiAgICByZXR1cm4gbmV3IERhdGUoTmFOKTtcbiAgfVxufVxuXG4vLyBGYWxsYmFjayBmb3IgbW9kdWxhcml6ZWQgaW1wb3J0czpcbmV4cG9ydCBkZWZhdWx0IHRvRGF0ZTtcbiIsImltcG9ydCB7IHRvRGF0ZSB9IGZyb20gXCIuL3RvRGF0ZS5tanNcIjtcblxuLyoqXG4gKiBAbmFtZSBzdGFydE9mRGF5XG4gKiBAY2F0ZWdvcnkgRGF5IEhlbHBlcnNcbiAqIEBzdW1tYXJ5IFJldHVybiB0aGUgc3RhcnQgb2YgYSBkYXkgZm9yIHRoZSBnaXZlbiBkYXRlLlxuICpcbiAqIEBkZXNjcmlwdGlvblxuICogUmV0dXJuIHRoZSBzdGFydCBvZiBhIGRheSBmb3IgdGhlIGdpdmVuIGRhdGUuXG4gKiBUaGUgcmVzdWx0IHdpbGwgYmUgaW4gdGhlIGxvY2FsIHRpbWV6b25lLlxuICpcbiAqIEB0eXBlUGFyYW0gRGF0ZVR5cGUgLSBUaGUgYERhdGVgIHR5cGUsIHRoZSBmdW5jdGlvbiBvcGVyYXRlcyBvbi4gR2V0cyBpbmZlcnJlZCBmcm9tIHBhc3NlZCBhcmd1bWVudHMuIEFsbG93cyB0byB1c2UgZXh0ZW5zaW9ucyBsaWtlIFtgVVRDRGF0ZWBdKGh0dHBzOi8vZ2l0aHViLmNvbS9kYXRlLWZucy91dGMpLlxuICpcbiAqIEBwYXJhbSBkYXRlIC0gVGhlIG9yaWdpbmFsIGRhdGVcbiAqXG4gKiBAcmV0dXJucyBUaGUgc3RhcnQgb2YgYSBkYXlcbiAqXG4gKiBAZXhhbXBsZVxuICogLy8gVGhlIHN0YXJ0IG9mIGEgZGF5IGZvciAyIFNlcHRlbWJlciAyMDE0IDExOjU1OjAwOlxuICogY29uc3QgcmVzdWx0ID0gc3RhcnRPZkRheShuZXcgRGF0ZSgyMDE0LCA4LCAyLCAxMSwgNTUsIDApKVxuICogLy89PiBUdWUgU2VwIDAyIDIwMTQgMDA6MDA6MDBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHN0YXJ0T2ZEYXkoZGF0ZSkge1xuICBjb25zdCBfZGF0ZSA9IHRvRGF0ZShkYXRlKTtcbiAgX2RhdGUuc2V0SG91cnMoMCwgMCwgMCwgMCk7XG4gIHJldHVybiBfZGF0ZTtcbn1cblxuLy8gRmFsbGJhY2sgZm9yIG1vZHVsYXJpemVkIGltcG9ydHM6XG5leHBvcnQgZGVmYXVsdCBzdGFydE9mRGF5O1xuIiwiaW1wb3J0IHsgaXNTYW1lRGF5IH0gZnJvbSBcIi4vaXNTYW1lRGF5Lm1qc1wiO1xuXG4vKipcbiAqIEBuYW1lIGlzVG9kYXlcbiAqIEBjYXRlZ29yeSBEYXkgSGVscGVyc1xuICogQHN1bW1hcnkgSXMgdGhlIGdpdmVuIGRhdGUgdG9kYXk/XG4gKiBAcHVyZSBmYWxzZVxuICpcbiAqIEBkZXNjcmlwdGlvblxuICogSXMgdGhlIGdpdmVuIGRhdGUgdG9kYXk/XG4gKlxuICogQHR5cGVQYXJhbSBEYXRlVHlwZSAtIFRoZSBgRGF0ZWAgdHlwZSwgdGhlIGZ1bmN0aW9uIG9wZXJhdGVzIG9uLiBHZXRzIGluZmVycmVkIGZyb20gcGFzc2VkIGFyZ3VtZW50cy4gQWxsb3dzIHRvIHVzZSBleHRlbnNpb25zIGxpa2UgW2BVVENEYXRlYF0oaHR0cHM6Ly9naXRodWIuY29tL2RhdGUtZm5zL3V0YykuXG4gKlxuICogQHBhcmFtIGRhdGUgLSBUaGUgZGF0ZSB0byBjaGVja1xuICpcbiAqIEByZXR1cm5zIFRoZSBkYXRlIGlzIHRvZGF5XG4gKlxuICogQGV4YW1wbGVcbiAqIC8vIElmIHRvZGF5IGlzIDYgT2N0b2JlciAyMDE0LCBpcyA2IE9jdG9iZXIgMTQ6MDA6MDAgdG9kYXk/XG4gKiBjb25zdCByZXN1bHQgPSBpc1RvZGF5KG5ldyBEYXRlKDIwMTQsIDksIDYsIDE0LCAwKSlcbiAqIC8vPT4gdHJ1ZVxuICovXG5leHBvcnQgZnVuY3Rpb24gaXNUb2RheShkYXRlKSB7XG4gIHJldHVybiBpc1NhbWVEYXkoZGF0ZSwgRGF0ZS5ub3coKSk7XG59XG5cbi8vIEZhbGxiYWNrIGZvciBtb2R1bGFyaXplZCBpbXBvcnRzOlxuZXhwb3J0IGRlZmF1bHQgaXNUb2RheTtcbiIsImltcG9ydCB7IHN0YXJ0T2ZEYXkgfSBmcm9tIFwiLi9zdGFydE9mRGF5Lm1qc1wiO1xuXG4vKipcbiAqIEBuYW1lIGlzU2FtZURheVxuICogQGNhdGVnb3J5IERheSBIZWxwZXJzXG4gKiBAc3VtbWFyeSBBcmUgdGhlIGdpdmVuIGRhdGVzIGluIHRoZSBzYW1lIGRheSAoYW5kIHllYXIgYW5kIG1vbnRoKT9cbiAqXG4gKiBAZGVzY3JpcHRpb25cbiAqIEFyZSB0aGUgZ2l2ZW4gZGF0ZXMgaW4gdGhlIHNhbWUgZGF5IChhbmQgeWVhciBhbmQgbW9udGgpP1xuICpcbiAqIEB0eXBlUGFyYW0gRGF0ZVR5cGUgLSBUaGUgYERhdGVgIHR5cGUsIHRoZSBmdW5jdGlvbiBvcGVyYXRlcyBvbi4gR2V0cyBpbmZlcnJlZCBmcm9tIHBhc3NlZCBhcmd1bWVudHMuIEFsbG93cyB0byB1c2UgZXh0ZW5zaW9ucyBsaWtlIFtgVVRDRGF0ZWBdKGh0dHBzOi8vZ2l0aHViLmNvbS9kYXRlLWZucy91dGMpLlxuICpcbiAqIEBwYXJhbSBkYXRlTGVmdCAtIFRoZSBmaXJzdCBkYXRlIHRvIGNoZWNrXG4gKiBAcGFyYW0gZGF0ZVJpZ2h0IC0gVGhlIHNlY29uZCBkYXRlIHRvIGNoZWNrXG5cbiAqIEByZXR1cm5zIFRoZSBkYXRlcyBhcmUgaW4gdGhlIHNhbWUgZGF5IChhbmQgeWVhciBhbmQgbW9udGgpXG4gKlxuICogQGV4YW1wbGVcbiAqIC8vIEFyZSA0IFNlcHRlbWJlciAwNjowMDowMCBhbmQgNCBTZXB0ZW1iZXIgMTg6MDA6MDAgaW4gdGhlIHNhbWUgZGF5P1xuICogY29uc3QgcmVzdWx0ID0gaXNTYW1lRGF5KG5ldyBEYXRlKDIwMTQsIDgsIDQsIDYsIDApLCBuZXcgRGF0ZSgyMDE0LCA4LCA0LCAxOCwgMCkpXG4gKiAvLz0+IHRydWVcbiAqXG4gKiBAZXhhbXBsZVxuICogLy8gQXJlIDQgU2VwdGVtYmVyIGFuZCA0IE9jdG9iZXIgaW4gdGhlIHNhbWUgZGF5P1xuICogY29uc3QgcmVzdWx0ID0gaXNTYW1lRGF5KG5ldyBEYXRlKDIwMTQsIDgsIDQpLCBuZXcgRGF0ZSgyMDE0LCA5LCA0KSlcbiAqIC8vPT4gZmFsc2VcbiAqXG4gKiBAZXhhbXBsZVxuICogLy8gQXJlIDQgU2VwdGVtYmVyLCAyMDE0IGFuZCA0IFNlcHRlbWJlciwgMjAxNSBpbiB0aGUgc2FtZSBkYXk/XG4gKiBjb25zdCByZXN1bHQgPSBpc1NhbWVEYXkobmV3IERhdGUoMjAxNCwgOCwgNCksIG5ldyBEYXRlKDIwMTUsIDgsIDQpKVxuICogLy89PiBmYWxzZVxuICovXG5leHBvcnQgZnVuY3Rpb24gaXNTYW1lRGF5KGRhdGVMZWZ0LCBkYXRlUmlnaHQpIHtcbiAgY29uc3QgZGF0ZUxlZnRTdGFydE9mRGF5ID0gc3RhcnRPZkRheShkYXRlTGVmdCk7XG4gIGNvbnN0IGRhdGVSaWdodFN0YXJ0T2ZEYXkgPSBzdGFydE9mRGF5KGRhdGVSaWdodCk7XG5cbiAgcmV0dXJuICtkYXRlTGVmdFN0YXJ0T2ZEYXkgPT09ICtkYXRlUmlnaHRTdGFydE9mRGF5O1xufVxuXG4vLyBGYWxsYmFjayBmb3IgbW9kdWxhcml6ZWQgaW1wb3J0czpcbmV4cG9ydCBkZWZhdWx0IGlzU2FtZURheTtcbiIsImxldCBkZWZhdWx0T3B0aW9ucyA9IHt9O1xuXG5leHBvcnQgZnVuY3Rpb24gZ2V0RGVmYXVsdE9wdGlvbnMoKSB7XG4gIHJldHVybiBkZWZhdWx0T3B0aW9ucztcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHNldERlZmF1bHRPcHRpb25zKG5ld09wdGlvbnMpIHtcbiAgZGVmYXVsdE9wdGlvbnMgPSBuZXdPcHRpb25zO1xufVxuIiwiaW1wb3J0IHsgdG9EYXRlIH0gZnJvbSBcIi4vdG9EYXRlLm1qc1wiO1xuaW1wb3J0IHsgZ2V0RGVmYXVsdE9wdGlvbnMgfSBmcm9tIFwiLi9fbGliL2RlZmF1bHRPcHRpb25zLm1qc1wiO1xuXG4vKipcbiAqIFRoZSB7QGxpbmsgc3RhcnRPZldlZWt9IGZ1bmN0aW9uIG9wdGlvbnMuXG4gKi9cblxuLyoqXG4gKiBAbmFtZSBzdGFydE9mV2Vla1xuICogQGNhdGVnb3J5IFdlZWsgSGVscGVyc1xuICogQHN1bW1hcnkgUmV0dXJuIHRoZSBzdGFydCBvZiBhIHdlZWsgZm9yIHRoZSBnaXZlbiBkYXRlLlxuICpcbiAqIEBkZXNjcmlwdGlvblxuICogUmV0dXJuIHRoZSBzdGFydCBvZiBhIHdlZWsgZm9yIHRoZSBnaXZlbiBkYXRlLlxuICogVGhlIHJlc3VsdCB3aWxsIGJlIGluIHRoZSBsb2NhbCB0aW1lem9uZS5cbiAqXG4gKiBAdHlwZVBhcmFtIERhdGVUeXBlIC0gVGhlIGBEYXRlYCB0eXBlLCB0aGUgZnVuY3Rpb24gb3BlcmF0ZXMgb24uIEdldHMgaW5mZXJyZWQgZnJvbSBwYXNzZWQgYXJndW1lbnRzLiBBbGxvd3MgdG8gdXNlIGV4dGVuc2lvbnMgbGlrZSBbYFVUQ0RhdGVgXShodHRwczovL2dpdGh1Yi5jb20vZGF0ZS1mbnMvdXRjKS5cbiAqXG4gKiBAcGFyYW0gZGF0ZSAtIFRoZSBvcmlnaW5hbCBkYXRlXG4gKiBAcGFyYW0gb3B0aW9ucyAtIEFuIG9iamVjdCB3aXRoIG9wdGlvbnNcbiAqXG4gKiBAcmV0dXJucyBUaGUgc3RhcnQgb2YgYSB3ZWVrXG4gKlxuICogQGV4YW1wbGVcbiAqIC8vIFRoZSBzdGFydCBvZiBhIHdlZWsgZm9yIDIgU2VwdGVtYmVyIDIwMTQgMTE6NTU6MDA6XG4gKiBjb25zdCByZXN1bHQgPSBzdGFydE9mV2VlayhuZXcgRGF0ZSgyMDE0LCA4LCAyLCAxMSwgNTUsIDApKVxuICogLy89PiBTdW4gQXVnIDMxIDIwMTQgMDA6MDA6MDBcbiAqXG4gKiBAZXhhbXBsZVxuICogLy8gSWYgdGhlIHdlZWsgc3RhcnRzIG9uIE1vbmRheSwgdGhlIHN0YXJ0IG9mIHRoZSB3ZWVrIGZvciAyIFNlcHRlbWJlciAyMDE0IDExOjU1OjAwOlxuICogY29uc3QgcmVzdWx0ID0gc3RhcnRPZldlZWsobmV3IERhdGUoMjAxNCwgOCwgMiwgMTEsIDU1LCAwKSwgeyB3ZWVrU3RhcnRzT246IDEgfSlcbiAqIC8vPT4gTW9uIFNlcCAwMSAyMDE0IDAwOjAwOjAwXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBzdGFydE9mV2VlayhkYXRlLCBvcHRpb25zKSB7XG4gIGNvbnN0IGRlZmF1bHRPcHRpb25zID0gZ2V0RGVmYXVsdE9wdGlvbnMoKTtcbiAgY29uc3Qgd2Vla1N0YXJ0c09uID1cbiAgICBvcHRpb25zPy53ZWVrU3RhcnRzT24gPz9cbiAgICBvcHRpb25zPy5sb2NhbGU/Lm9wdGlvbnM/LndlZWtTdGFydHNPbiA/P1xuICAgIGRlZmF1bHRPcHRpb25zLndlZWtTdGFydHNPbiA/P1xuICAgIGRlZmF1bHRPcHRpb25zLmxvY2FsZT8ub3B0aW9ucz8ud2Vla1N0YXJ0c09uID8/XG4gICAgMDtcblxuICBjb25zdCBfZGF0ZSA9IHRvRGF0ZShkYXRlKTtcbiAgY29uc3QgZGF5ID0gX2RhdGUuZ2V0RGF5KCk7XG4gIGNvbnN0IGRpZmYgPSAoZGF5IDwgd2Vla1N0YXJ0c09uID8gNyA6IDApICsgZGF5IC0gd2Vla1N0YXJ0c09uO1xuXG4gIF9kYXRlLnNldERhdGUoX2RhdGUuZ2V0RGF0ZSgpIC0gZGlmZik7XG4gIF9kYXRlLnNldEhvdXJzKDAsIDAsIDAsIDApO1xuICByZXR1cm4gX2RhdGU7XG59XG5cbi8vIEZhbGxiYWNrIGZvciBtb2R1bGFyaXplZCBpbXBvcnRzOlxuZXhwb3J0IGRlZmF1bHQgc3RhcnRPZldlZWs7XG4iLCJpbXBvcnQgeyBpc1NhbWVXZWVrIH0gZnJvbSBcIi4vaXNTYW1lV2Vlay5tanNcIjtcblxuLyoqXG4gKiBUaGUge0BsaW5rIGlzVGhpc1dlZWt9IGZ1bmN0aW9uIG9wdGlvbnMuXG4gKi9cblxuLyoqXG4gKiBAbmFtZSBpc1RoaXNXZWVrXG4gKiBAY2F0ZWdvcnkgV2VlayBIZWxwZXJzXG4gKiBAc3VtbWFyeSBJcyB0aGUgZ2l2ZW4gZGF0ZSBpbiB0aGUgc2FtZSB3ZWVrIGFzIHRoZSBjdXJyZW50IGRhdGU/XG4gKiBAcHVyZSBmYWxzZVxuICpcbiAqIEBkZXNjcmlwdGlvblxuICogSXMgdGhlIGdpdmVuIGRhdGUgaW4gdGhlIHNhbWUgd2VlayBhcyB0aGUgY3VycmVudCBkYXRlP1xuICpcbiAqIEB0eXBlUGFyYW0gRGF0ZVR5cGUgLSBUaGUgYERhdGVgIHR5cGUsIHRoZSBmdW5jdGlvbiBvcGVyYXRlcyBvbi4gR2V0cyBpbmZlcnJlZCBmcm9tIHBhc3NlZCBhcmd1bWVudHMuIEFsbG93cyB0byB1c2UgZXh0ZW5zaW9ucyBsaWtlIFtgVVRDRGF0ZWBdKGh0dHBzOi8vZ2l0aHViLmNvbS9kYXRlLWZucy91dGMpLlxuICpcbiAqIEBwYXJhbSBkYXRlIC0gVGhlIGRhdGUgdG8gY2hlY2tcbiAqIEBwYXJhbSBvcHRpb25zIC0gVGhlIG9iamVjdCB3aXRoIG9wdGlvbnNcbiAqXG4gKiBAcmV0dXJucyBUaGUgZGF0ZSBpcyBpbiB0aGlzIHdlZWtcbiAqXG4gKiBAZXhhbXBsZVxuICogLy8gSWYgdG9kYXkgaXMgMjUgU2VwdGVtYmVyIDIwMTQsIGlzIDIxIFNlcHRlbWJlciAyMDE0IGluIHRoaXMgd2Vlaz9cbiAqIGNvbnN0IHJlc3VsdCA9IGlzVGhpc1dlZWsobmV3IERhdGUoMjAxNCwgOCwgMjEpKVxuICogLy89PiB0cnVlXG4gKlxuICogQGV4YW1wbGVcbiAqIC8vIElmIHRvZGF5IGlzIDI1IFNlcHRlbWJlciAyMDE0IGFuZCB3ZWVrIHN0YXJ0cyB3aXRoIE1vbmRheVxuICogLy8gaXMgMjEgU2VwdGVtYmVyIDIwMTQgaW4gdGhpcyB3ZWVrP1xuICogY29uc3QgcmVzdWx0ID0gaXNUaGlzV2VlayhuZXcgRGF0ZSgyMDE0LCA4LCAyMSksIHsgd2Vla1N0YXJ0c09uOiAxIH0pXG4gKiAvLz0+IGZhbHNlXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpc1RoaXNXZWVrKGRhdGUsIG9wdGlvbnMpIHtcbiAgcmV0dXJuIGlzU2FtZVdlZWsoZGF0ZSwgRGF0ZS5ub3coKSwgb3B0aW9ucyk7XG59XG5cbi8vIEZhbGxiYWNrIGZvciBtb2R1bGFyaXplZCBpbXBvcnRzOlxuZXhwb3J0IGRlZmF1bHQgaXNUaGlzV2VlaztcbiIsImltcG9ydCB7IHN0YXJ0T2ZXZWVrIH0gZnJvbSBcIi4vc3RhcnRPZldlZWsubWpzXCI7XG5cbi8qKlxuICogVGhlIHtAbGluayBpc1NhbWVXZWVrfSBmdW5jdGlvbiBvcHRpb25zLlxuICovXG5cbi8qKlxuICogQG5hbWUgaXNTYW1lV2Vla1xuICogQGNhdGVnb3J5IFdlZWsgSGVscGVyc1xuICogQHN1bW1hcnkgQXJlIHRoZSBnaXZlbiBkYXRlcyBpbiB0aGUgc2FtZSB3ZWVrIChhbmQgbW9udGggYW5kIHllYXIpP1xuICpcbiAqIEBkZXNjcmlwdGlvblxuICogQXJlIHRoZSBnaXZlbiBkYXRlcyBpbiB0aGUgc2FtZSB3ZWVrIChhbmQgbW9udGggYW5kIHllYXIpP1xuICpcbiAqIEB0eXBlUGFyYW0gRGF0ZVR5cGUgLSBUaGUgYERhdGVgIHR5cGUsIHRoZSBmdW5jdGlvbiBvcGVyYXRlcyBvbi4gR2V0cyBpbmZlcnJlZCBmcm9tIHBhc3NlZCBhcmd1bWVudHMuIEFsbG93cyB0byB1c2UgZXh0ZW5zaW9ucyBsaWtlIFtgVVRDRGF0ZWBdKGh0dHBzOi8vZ2l0aHViLmNvbS9kYXRlLWZucy91dGMpLlxuICpcbiAqIEBwYXJhbSBkYXRlTGVmdCAtIFRoZSBmaXJzdCBkYXRlIHRvIGNoZWNrXG4gKiBAcGFyYW0gZGF0ZVJpZ2h0IC0gVGhlIHNlY29uZCBkYXRlIHRvIGNoZWNrXG4gKiBAcGFyYW0gb3B0aW9ucyAtIEFuIG9iamVjdCB3aXRoIG9wdGlvbnNcbiAqXG4gKiBAcmV0dXJucyBUaGUgZGF0ZXMgYXJlIGluIHRoZSBzYW1lIHdlZWsgKGFuZCBtb250aCBhbmQgeWVhcilcbiAqXG4gKiBAZXhhbXBsZVxuICogLy8gQXJlIDMxIEF1Z3VzdCAyMDE0IGFuZCA0IFNlcHRlbWJlciAyMDE0IGluIHRoZSBzYW1lIHdlZWs/XG4gKiBjb25zdCByZXN1bHQgPSBpc1NhbWVXZWVrKG5ldyBEYXRlKDIwMTQsIDcsIDMxKSwgbmV3IERhdGUoMjAxNCwgOCwgNCkpXG4gKiAvLz0+IHRydWVcbiAqXG4gKiBAZXhhbXBsZVxuICogLy8gSWYgd2VlayBzdGFydHMgd2l0aCBNb25kYXksXG4gKiAvLyBhcmUgMzEgQXVndXN0IDIwMTQgYW5kIDQgU2VwdGVtYmVyIDIwMTQgaW4gdGhlIHNhbWUgd2Vlaz9cbiAqIGNvbnN0IHJlc3VsdCA9IGlzU2FtZVdlZWsobmV3IERhdGUoMjAxNCwgNywgMzEpLCBuZXcgRGF0ZSgyMDE0LCA4LCA0KSwge1xuICogICB3ZWVrU3RhcnRzT246IDFcbiAqIH0pXG4gKiAvLz0+IGZhbHNlXG4gKlxuICogQGV4YW1wbGVcbiAqIC8vIEFyZSAxIEphbnVhcnkgMjAxNCBhbmQgMSBKYW51YXJ5IDIwMTUgaW4gdGhlIHNhbWUgd2Vlaz9cbiAqIGNvbnN0IHJlc3VsdCA9IGlzU2FtZVdlZWsobmV3IERhdGUoMjAxNCwgMCwgMSksIG5ldyBEYXRlKDIwMTUsIDAsIDEpKVxuICogLy89PiBmYWxzZVxuICovXG5leHBvcnQgZnVuY3Rpb24gaXNTYW1lV2VlayhkYXRlTGVmdCwgZGF0ZVJpZ2h0LCBvcHRpb25zKSB7XG4gIGNvbnN0IGRhdGVMZWZ0U3RhcnRPZldlZWsgPSBzdGFydE9mV2VlayhkYXRlTGVmdCwgb3B0aW9ucyk7XG4gIGNvbnN0IGRhdGVSaWdodFN0YXJ0T2ZXZWVrID0gc3RhcnRPZldlZWsoZGF0ZVJpZ2h0LCBvcHRpb25zKTtcblxuICByZXR1cm4gK2RhdGVMZWZ0U3RhcnRPZldlZWsgPT09ICtkYXRlUmlnaHRTdGFydE9mV2Vlaztcbn1cblxuLy8gRmFsbGJhY2sgZm9yIG1vZHVsYXJpemVkIGltcG9ydHM6XG5leHBvcnQgZGVmYXVsdCBpc1NhbWVXZWVrO1xuIiwiaW1wb3J0IHsgcHJvamVjdHMgfSBmcm9tIFwiLi9tYW5hZ2VQcm9qZWN0XCI7XG5pbXBvcnQgeyBpc1RvZGF5LCB0b0RhdGUsIGlzVGhpc1dlZWsgfSBmcm9tIFwiZGF0ZS1mbnNcIjtcbmltcG9ydCB7IEFkZHRvTGlzdCB9IGZyb20gXCIuL21hbmFnZUxpc3RcIjtcbmltcG9ydCB7IHN0b3JlTG9jYWwgfSBmcm9tIFwiLi9zdG9yYWdlXCI7XG5cbmNvbnN0IHJlbmRlclRhc2sgPSAoKCkgPT4ge1xuICAgIGZ1bmN0aW9uIGRpc3BsYXlBbGxUYXNrKGl0ZW1zLCBkaXNwbGF5KSB7XG4gICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuXG4gICAgICAgIGNvbnRhaW5lci5zZXRBdHRyaWJ1dGUoJ2RhdGEtdGFza0lkJywgYCR7aXRlbXMuaWR9YClcblxuICAgICAgICBjb250YWluZXIuY2xhc3NMaXN0LmFkZCgndGFzaycpO1xuXG4gICAgICAgIGNvbnN0IHRpdGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JylcbiAgICAgICAgY29uc3QgZHVlZGF0ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICBjb25zdCBkZXRhaWxzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIGNvbnN0IHByaW9yaXR5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIGNvbnN0IGRlbGV0ZUJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpO1xuICAgICAgICBjb25zdCBlZGl0QnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7XG4gICAgICAgIGNvbnN0IGNoZWNrYm94ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTtcbiAgICAgICAgY29uc3QgbGFiZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsYWJlbCcpO1xuXG4gICAgICAgIHRpdGxlLnRleHRDb250ZW50ID0gYFRpdGxlOiAke2l0ZW1zLnRpdGxlfWA7XG4gICAgICAgIGR1ZWRhdGUudGV4dENvbnRlbnQgPSBgRHVlIERhdGU6ICR7aXRlbXMuZHVlZGF0ZX1gO1xuICAgICAgICBkZXRhaWxzLnRleHRDb250ZW50ID0gYERldGFpbHM6ICR7aXRlbXMuZGV0YWlsc31gO1xuICAgICAgICBwcmlvcml0eS50ZXh0Q29udGVudCA9IGBQcmlvcml0eTogJHtpdGVtcy5wcmlvcml0eX1gO1xuICAgICAgICBkZWxldGVCdG4udGV4dENvbnRlbnQgPSAnZGVsZXRlJztcbiAgICAgICAgZWRpdEJ0bi50ZXh0Q29udGVudCA9ICdlZGl0JztcbiAgICAgICAgbGFiZWwudGV4dENvbnRlbnQgPSAnRG9uZT8nO1xuXG4gICAgICAgIGNoZWNrYm94LnNldEF0dHJpYnV0ZSgndHlwZScsICdjaGVja2JveCcpO1xuICAgICAgICBjaGVja2JveC5zZXRBdHRyaWJ1dGUoJ2lkJywgYHN0YXR1cy0ke2l0ZW1zLmlkfWApO1xuICAgICAgICBjaGVja2JveC5zZXRBdHRyaWJ1dGUoJ25hbWUnLCAnc3RhdHVzJyk7XG4gICAgICAgIGNoZWNrYm94LnNldEF0dHJpYnV0ZSgndmFsdWUnLCAnb2ZmJyk7XG4gICAgICAgIGxhYmVsLnNldEF0dHJpYnV0ZSgnZm9yJywgYHN0YXR1cy0ke2l0ZW1zLmlkfWApO1xuICAgICAgICBkZWxldGVCdG4uc2V0QXR0cmlidXRlKCdkYXRhLXRhc2tJZCcsIGAke2l0ZW1zLmlkfWApO1xuICAgICAgICBcblxuICAgICAgICBjaGVja2JveC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICAgICAgICAgIGlmIChjaGVja2JveC52YWx1ZSA9PT0gJ29mZicpIHtpbml0Q2hlY2tib3hPbihpdGVtcywgY2hlY2tib3gsIGxhYmVsLCBlZGl0QnRuLCBjb250YWluZXIpfVxuICAgICAgICAgICAgZWxzZSB7aW5pdENoZWNrYm94T2ZmKGl0ZW1zLCBjaGVja2JveCwgbGFiZWwsIGVkaXRCdG4sIGNvbnRhaW5lcil9O1xuICAgICAgICBcbiAgICAgICAgICAgIHN0b3JlTG9jYWwuc3RvcmVQcm9qZWN0cygpO1xuICAgICAgICB9KTtcblxuICAgICAgICBkZWxldGVCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiBpbml0RGVsQnRuKGl0ZW1zLmlkLCBpdGVtcy5wcm9qZWN0KSk7XG4gICAgICAgIGVkaXRCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7aW5pdEVkaXRCdG4oaXRlbXMpfSk7XG5cbiAgICAgICAgaWYgKGl0ZW1zLnN0YXR1cyA9PT0gJ2ZpbmlzaGVkJykge1xuICAgICAgICAgICAgY2hlY2tib3guc2V0QXR0cmlidXRlKCdjaGVja2VkJywnJyk7XG4gICAgICAgICAgICBpbml0Q2hlY2tib3hPbihpdGVtcywgY2hlY2tib3gsIGxhYmVsLCBlZGl0QnRuLCBjb250YWluZXIpO1xuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnRhaW5lci5hcHBlbmQodGl0bGUsIGR1ZWRhdGUsIGRldGFpbHMsIHByaW9yaXR5LCBkZWxldGVCdG4sIGVkaXRCdG4sIGxhYmVsLCBjaGVja2JveCk7XG4gICAgICAgIGRpc3BsYXkuYXBwZW5kQ2hpbGQoY29udGFpbmVyKTtcblxuICAgICAgICByZXR1cm4gZGlzcGxheTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBpbml0Q2hlY2tib3hPbihpdGVtcywgY2hlY2tib3gsIGxhYmVsLCBlZGl0QnRuLCBjb250YWluZXIpIHtcbiAgICAgICAgICAgIGxhYmVsLnRleHRDb250ZW50ID0gJ0RvbmUhJztcbiAgICAgICAgICAgIGNoZWNrYm94LnZhbHVlID0gJ29uJztcbiAgICAgICAgICAgIGVkaXRCdG4uc2V0QXR0cmlidXRlKCdkaXNhYmxlZCcsICcnKTtcbiAgICAgICAgICAgIGl0ZW1zLnN0YXR1cyA9ICdmaW5pc2hlZCc7XG4gICAgICAgICAgICBjb250YWluZXIuY2xhc3NMaXN0LmFkZCgnZmluaXNoZWQnKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBpbml0Q2hlY2tib3hPZmYoaXRlbXMsIGNoZWNrYm94LCBsYWJlbCwgZWRpdEJ0biwgY29udGFpbmVyKSB7XG4gICAgICAgIGxhYmVsLnRleHRDb250ZW50ID0gJ0RvbmU/JztcbiAgICAgICAgY2hlY2tib3gudmFsdWUgPSAnb2ZmJztcbiAgICAgICAgZWRpdEJ0bi5yZW1vdmVBdHRyaWJ1dGUoJ2Rpc2FibGVkJyk7XG4gICAgICAgIGl0ZW1zLnN0YXR1cyA9ICd1bmZpbmlzaGVkJztcbiAgICAgICAgY29udGFpbmVyLmNsYXNzTGlzdC5yZW1vdmUoJ2ZpbmlzaGVkJyk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gaW5pdEVkaXRCdG4odGFzaykge1xuICAgICAgICBjb25zdCB0YXNrRm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNtYWluLWZvcm0nKTtcblxuICAgICAgICB0YXNrRm9ybS5jbGFzc0xpc3QuYWRkKCdlZGl0LW1vZGUnKTtcbiAgICAgICAgdGFza0Zvcm0uc2V0QXR0cmlidXRlKCdkYXRhLXRhc2tJZCcsIGAke3Rhc2suaWR9YCk7XG5cbiAgICAgICAgbGV0IHRpdGxlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RpdGxlJyk7XG4gICAgICAgIGxldCBkZXRhaWxzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RldGFpbHMnKTtcbiAgICAgICAgbGV0IGRhdGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGF0ZScpO1xuICAgICAgICBsZXQgcHJpb3JpdHkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJpb3JpdHknKTtcblxuICAgICAgICBjb25zdCB0YXNrVGl0bGUgPSB0YXNrLnRpdGxlO1xuICAgICAgICBjb25zdCB0YXNrRGV0YWlscyA9IHRhc2suZGV0YWlscztcbiAgICAgICAgY29uc3QgdGFza0RhdGUgPSB0YXNrLmR1ZWRhdGU7XG4gICAgICAgIGNvbnN0IHRhc2tQcmlvcml0eSA9IHRhc2sucHJpb3JpdHk7XG5cbiAgICAgICAgdGl0bGUudmFsdWUgPSB0YXNrVGl0bGU7XG4gICAgICAgIGRldGFpbHMudmFsdWUgPSB0YXNrRGV0YWlscztcbiAgICAgICAgZGF0ZS52YWx1ZSA9IHRhc2tEYXRlO1xuICAgICAgICBwcmlvcml0eS52YWx1ZSA9IHRhc2tQcmlvcml0eTtcblxuICAgICAgICB0YXNrRm9ybS5yZW1vdmVBdHRyaWJ1dGUoJ2hpZGRlbicpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGluaXREZWxCdG4oaWQsIHByb2plY3RJZCkge1xuICAgICAgICBsZXQgQWxsdGFzayA9IEFkZHRvTGlzdC5yZW1vdmVUYXNrKGlkKTtcbiAgICAgICAgY29uc3QgZ2VuZXJhbExpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjZ2VuZXJhbCcpO1xuXG4gICAgICAgIHByb2plY3RzLnVwZGF0ZUdlbmVyYWxMaXN0KEFsbHRhc2spO1xuICAgICAgICBwcm9qZWN0cy51cGRhdGVQcm9qZWN0KHByb2plY3RJZCk7XG4gICAgICAgIHN0b3JlTG9jYWwuc3RvcmVQcm9qZWN0cygpO1xuXG4gICAgICAgIHdoaWxlIChnZW5lcmFsTGlzdC5sYXN0RWxlbWVudENoaWxkKSBnZW5lcmFsTGlzdC5yZW1vdmVDaGlsZChnZW5lcmFsTGlzdC5sYXN0RWxlbWVudENoaWxkKTtcbiAgICAgICAgXG4gICAgICAgIHVwZGF0ZURpc3BsYXkocHJvamVjdElkKTtcblxuICAgICAgICBjb25zb2xlLmxvZyhwcm9qZWN0cy5wcm9qZWN0TGlzdCk7XG4gICAgICAgIGNvbnNvbGUubG9nKHByb2plY3RJZClcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBncmFiVGFiKCkge1xuICAgICAgICBsZXQgY3VycmVudFRhYiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNnZW5lcmFsJykuZ2V0QXR0cmlidXRlKCdjbGFzcycpO1xuICAgICAgICByZXR1cm4gY3VycmVudFRhYjtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiB1cGRhdGVEaXNwbGF5KGlkKSB7XG4gICAgICAgIGxldCB0YWIgPSBncmFiVGFiKCk7XG4gICAgICAgIGlmICh0YWIgPT09ICdpbmJveFRhYicpIGRpc3BsYXlJbmJveCgpXG4gICAgICAgIGVsc2UgaWYgKHRhYiA9PT0gJ3RvZGF5VGFiJykgZGlzcGxheURhaWx5KClcbiAgICAgICAgZWxzZSBpZiAodGFiID09PSAnd2Vla1RhYicpIGRpc3BsYXlXZWVrbHkoKVxuICAgICAgICBlbHNlIGlmICh0YWIgPT09IGAke2lkfWAgJiYgaWQgIT09IDApIHJlbmRlclByb2plY3QuZGlzcGxheVByb2plY3RUYXNrcyhpZClcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBkaXNwbGF5SW5ib3goKSB7XG4gICAgICAgIGxldCBsaXN0ID0gcHJvamVjdHMuZ3JhYlByb2plY3RMaXN0KClbMF0udGFza0xpc3Q7XG4gICAgICAgIGNvbnN0IGdlbmVyYWxMaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2dlbmVyYWwnKTtcbiAgICAgICAgZ2VuZXJhbExpc3QuY2xhc3NMaXN0LnJlcGxhY2UoZ2VuZXJhbExpc3QuZ2V0QXR0cmlidXRlKCdjbGFzcycpLCAnaW5ib3hUYWInKTtcblxuICAgICAgICB3aGlsZSAoZ2VuZXJhbExpc3QubGFzdEVsZW1lbnRDaGlsZCkgZ2VuZXJhbExpc3QucmVtb3ZlQ2hpbGQoZ2VuZXJhbExpc3QubGFzdEVsZW1lbnRDaGlsZCk7XG4gICAgICAgIGNvbnNvbGUubG9nKGxpc3QpXG4gICAgICAgIGxpc3QuZm9yRWFjaCh0YXNrID0+IGRpc3BsYXlBbGxUYXNrKHRhc2ssIGdlbmVyYWxMaXN0KSk7XG4gICAgICAgIGNvbnNvbGUubG9nKHByb2plY3RzLnByb2plY3RMaXN0KVxuICAgICAgICBcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBkaXNwbGF5RGFpbHkoKSB7XG4gICAgICAgIGxldCBsaXN0ID0gcHJvamVjdHMuZ3JhYlByb2plY3RMaXN0KClbMF0udGFza0xpc3Q7XG4gICAgICAgIGNvbnN0IGdlbmVyYWxMaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2dlbmVyYWwnKTtcbiAgICAgICAgZ2VuZXJhbExpc3QuY2xhc3NMaXN0LnJlcGxhY2UoZ2VuZXJhbExpc3QuZ2V0QXR0cmlidXRlKCdjbGFzcycpLCAndG9kYXlUYWInKTtcblxuICAgICAgICB3aGlsZSAoZ2VuZXJhbExpc3QubGFzdEVsZW1lbnRDaGlsZCkgZ2VuZXJhbExpc3QucmVtb3ZlQ2hpbGQoZ2VuZXJhbExpc3QubGFzdEVsZW1lbnRDaGlsZCk7XG4gICAgICAgIFxuICAgICAgICBjb25zdCBkYWlseVRhc2tzID0gbGlzdC5maWx0ZXIodGFzayA9PiBpc1RvZGF5KHRvRGF0ZSh0YXNrLmR1ZWRhdGUpKSk7XG4gICAgICAgIFxuICAgICAgICBkYWlseVRhc2tzLmZvckVhY2godGFzayA9PiBkaXNwbGF5QWxsVGFzayh0YXNrLCBnZW5lcmFsTGlzdCkpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGRpc3BsYXlXZWVrbHkoKSB7XG4gICAgICAgIGxldCBsaXN0ID0gcHJvamVjdHMuZ3JhYlByb2plY3RMaXN0KClbMF0udGFza0xpc3Q7XG4gICAgICAgIGNvbnN0IGdlbmVyYWxMaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2dlbmVyYWwnKTtcbiAgICAgICAgZ2VuZXJhbExpc3QuY2xhc3NMaXN0LnJlcGxhY2UoZ2VuZXJhbExpc3QuZ2V0QXR0cmlidXRlKCdjbGFzcycpLCAnd2Vla1RhYicpO1xuXG4gICAgICAgIHdoaWxlIChnZW5lcmFsTGlzdC5sYXN0RWxlbWVudENoaWxkKSBnZW5lcmFsTGlzdC5yZW1vdmVDaGlsZChnZW5lcmFsTGlzdC5sYXN0RWxlbWVudENoaWxkKTtcblxuICAgICAgICBjb25zdCB3ZWVrbHlUYXNrcyA9IGxpc3QuZmlsdGVyKHRhc2sgPT4gaXNUaGlzV2Vlayh0b0RhdGUodGFzay5kdWVkYXRlKSkpO1xuXG4gICAgICAgIHdlZWtseVRhc2tzLmZvckVhY2godGFzayA9PiBkaXNwbGF5QWxsVGFzayh0YXNrLCBnZW5lcmFsTGlzdCkpO1xuICAgIH1cblxuICAgIHJldHVybiB7IGRpc3BsYXlJbmJveCwgZGlzcGxheURhaWx5LCBkaXNwbGF5V2Vla2x5LCBkaXNwbGF5QWxsVGFzaywgdXBkYXRlRGlzcGxheSwgZ3JhYlRhYiB9XG59KSgpXG5cbmNvbnN0IHJlbmRlclByb2plY3QgPSAoKCkgPT4ge1xuICAgIGZ1bmN0aW9uIGRpc3BsYXlQcm9qZWN0KHByb2plY3QpIHtcbiAgICAgICAgY29uc3QgcHJvamVjdERpc3BsYXkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYWxsLXByb2plY3RzJyk7XG4gICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuXG4gICAgICAgIGNvbnN0IHByb2plY3RUaXRsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICBjb25zdCBwcm9qZWN0VGFza0J0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpO1xuICAgICAgICBjb25zdCBwcm9qZWN0RGVsQnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7XG5cbiAgICAgICAgY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoYHByb2plY3QtJHtwcm9qZWN0LmlkfWApO1xuICAgICAgICBjb250YWluZXIuc2V0QXR0cmlidXRlKCdkYXRhLXByb2plY3RJZCcsIGAke3Byb2plY3QuaWR9YCk7XG4gICAgICAgIHByb2plY3RUYXNrQnRuLnNldEF0dHJpYnV0ZSgnZGF0YS1wcm9qZWN0SWQnLCBgJHtwcm9qZWN0LmlkfWApO1xuICAgICAgICBwcm9qZWN0VGFza0J0bi5zZXRBdHRyaWJ1dGUoJ2lkJywgYHByb2plY3QtJHtwcm9qZWN0LmlkfWApO1xuXG4gICAgICAgIHByb2plY3RUaXRsZS50ZXh0Q29udGVudCA9IGAke3Byb2plY3QudGl0bGV9YDtcbiAgICAgICAgcHJvamVjdFRhc2tCdG4udGV4dENvbnRlbnQgPSAnKyc7XG4gICAgICAgIHByb2plY3REZWxCdG4udGV4dENvbnRlbnQgPSAnZGVsZXRlJztcblxuICAgICAgICBjb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xuICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgIGRpc3BsYXlQcm9qZWN0VGFza3MocHJvamVjdC5pZCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHByb2plY3RUYXNrQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygncHJvamVjdCBpZCcsIHByb2plY3RzLmdyYWJQcm9qZWN0SWQoZSkpO1xuICAgICAgICAgICAgY29uc3QgbmV3VGFza0Zvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjbWFpbi1mb3JtJyk7XG5cbiAgICAgICAgICAgIHByb2plY3RzLmdyYWJQcm9qZWN0SWQoZSk7XG4gICAgICAgICAgICBuZXdUYXNrRm9ybS5yZW1vdmVBdHRyaWJ1dGUoJ2hpZGRlbicpO1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB9KVxuXG4gICAgICAgIHByb2plY3REZWxCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xuICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgIGluaXREZWxQcm9qQnRuKHByb2plY3QuaWQpO1xuICAgICAgICB9KVxuXG4gICAgICAgIGNvbnRhaW5lci5hcHBlbmQocHJvamVjdFRpdGxlLCBwcm9qZWN0VGFza0J0biwgcHJvamVjdERlbEJ0bik7XG4gICAgICAgIHByb2plY3REaXNwbGF5LmFwcGVuZENoaWxkKGNvbnRhaW5lcik7XG5cbiAgICAgICAgcmV0dXJuIHByb2plY3REaXNwbGF5XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gaW5pdERlbFByb2pCdG4ocHJvamVjdElkKSB7XG4gICAgICAgIHByb2plY3RzLnJlbW92ZVByb2plY3QocHJvamVjdElkKTtcblxuICAgICAgICBsZXQgdXBkYXRlZFByb2plY3RzID0gcHJvamVjdHMuZ3JhYlByb2plY3RMaXN0KCk7XG4gICAgICAgIGxldCB0YXNrTGlzdCA9IEFkZHRvTGlzdC5Ub2RvTGlzdDtcbiAgICAgICAgbGV0IHVwZGF0ZWRUYXNrTGlzdCA9IHRhc2tMaXN0LmZpbHRlcih0YXNrID0+IHRhc2sucHJvamVjdCA9PT0gcHJvamVjdElkKTtcblxuICAgICAgICB1cGRhdGVkVGFza0xpc3QuZm9yRWFjaCh0YXNrID0+IHtcbiAgICAgICAgICAgIGxldCBuZXdMaXN0ID0gQWRkdG9MaXN0LnJlbW92ZVRhc2sodGFzay5pZCk7XG4gICAgICAgICAgICBwcm9qZWN0cy51cGRhdGVHZW5lcmFsTGlzdChuZXdMaXN0KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgbGV0IHByb2plY3RzRGlzcGxheSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5hbGwtcHJvamVjdHMnKTtcbiAgICAgICAgd2hpbGUgKHByb2plY3RzRGlzcGxheS5sYXN0RWxlbWVudENoaWxkKSBwcm9qZWN0c0Rpc3BsYXkucmVtb3ZlQ2hpbGQocHJvamVjdHNEaXNwbGF5Lmxhc3RFbGVtZW50Q2hpbGQpO1xuXG4gICAgICAgIHVwZGF0ZWRQcm9qZWN0cy5mb3JFYWNoKHByb2plY3QgPT4ge1xuICAgICAgICAgICAgaWYgKHByb2plY3QuaWQgPiAwKSBkaXNwbGF5UHJvamVjdChwcm9qZWN0KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKHBhcnNlSW50KHJlbmRlclRhc2suZ3JhYlRhYihwcm9qZWN0SWQpKSA9PT0gcHJvamVjdElkKSByZW5kZXJUYXNrLmRpc3BsYXlJbmJveCgpXG4gICAgICAgIGVsc2UgcmVuZGVyVGFzay51cGRhdGVEaXNwbGF5KHByb2plY3RJZCk7XG5cbiAgICAgICAgc3RvcmVMb2NhbC5zdG9yZVByb2plY3RzKCk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZGlzcGxheVByb2plY3RUYXNrcyhpZCkge1xuICAgICAgICBsZXQgbGlzdCA9IHByb2plY3RzLnByb2plY3RMaXN0O1xuICAgICAgICBjb25zdCBnZW5lcmFsTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNnZW5lcmFsJyk7XG4gICAgICAgIGdlbmVyYWxMaXN0LmNsYXNzTGlzdC5yZXBsYWNlKGdlbmVyYWxMaXN0LmdldEF0dHJpYnV0ZSgnY2xhc3MnKSwgYCR7aWR9YCk7XG5cbiAgICAgICAgd2hpbGUgKGdlbmVyYWxMaXN0Lmxhc3RFbGVtZW50Q2hpbGQpIGdlbmVyYWxMaXN0LnJlbW92ZUNoaWxkKGdlbmVyYWxMaXN0Lmxhc3RFbGVtZW50Q2hpbGQpO1xuXG4gICAgICAgIGxldCBwcm9qZWN0VGFza3MgPSBwcm9qZWN0cy5ncmFiQ3VycmVudFByb2plY3RUYXNrcyhpZCk7XG5cbiAgICAgICAgcHJvamVjdFRhc2tzLmZvckVhY2godGFzayA9PiByZW5kZXJUYXNrLmRpc3BsYXlBbGxUYXNrKHRhc2ssIGdlbmVyYWxMaXN0KSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHsgZGlzcGxheVByb2plY3QsIGRpc3BsYXlQcm9qZWN0VGFza3MgfVxufSkoKVxuXG5leHBvcnQgeyByZW5kZXJUYXNrLCByZW5kZXJQcm9qZWN0IH0iLCJpbXBvcnQgeyBBZGR0b0xpc3QgfSBmcm9tIFwiLi9tYW5hZ2VMaXN0XCI7XG5pbXBvcnQgeyByZW5kZXJUYXNrIH0gZnJvbSBcIi4vVUlcIjtcbmltcG9ydCB7IHByb2plY3RzIH0gZnJvbSBcIi4vbWFuYWdlUHJvamVjdFwiO1xuaW1wb3J0IHsgdG9EYXRlLCBpc1RoaXNXZWVrLCBpc1RvZGF5IH0gZnJvbSBcImRhdGUtZm5zXCI7XG5pbXBvcnQgeyBzdG9yZUxvY2FsIH0gZnJvbSBcIi4vc3RvcmFnZVwiO1xuXG5cbmNvbnN0IGNyZWF0ZVRhc2sgPSAoaWQsIHRpdGxlLCBkZXRhaWxzLCBkdWVkYXRlLCBwcmlvcml0eSwgcHJvamVjdCwgc3RhdHVzKSA9PiB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgaWQsIHRpdGxlLCBkZXRhaWxzLCBkdWVkYXRlLCBwcmlvcml0eSwgcHJvamVjdCwgc3RhdHVzXG4gICAgfVxufVxuXG5jb25zdCBOZXdUYXNrID0gKCgpID0+IHtcblxuICAgIGxldCB0aXRsZTtcbiAgICBsZXQgZGV0YWlscztcblxuICAgIGZ1bmN0aW9uIGNyZWF0ZU5ld1Rhc2soKSB7XG4gICAgICAgIGNvbnN0IHByb2plY3RMaXN0ID0gcHJvamVjdHMuZ3JhYlByb2plY3RMaXN0KCk7XG5cbiAgICAgICAgdGl0bGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGl0bGUnKS52YWx1ZTtcbiAgICAgICAgZGV0YWlscyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkZXRhaWxzJykudmFsdWU7XG5cbiAgICAgICAgbGV0IGR1ZWRhdGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGF0ZScpLnZhbHVlO1xuICAgICAgICBsZXQgcHJpb3JpdHkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJpb3JpdHknKS52YWx1ZTtcbiAgICAgICAgbGV0IGlkID0gY3JlYXRlSWQoKTtcbiAgICAgICAgbGV0IHByb2plY3RJZCA9IHByb2plY3RzLmdyYWJDdXJyZW50UHJvamVjdCgpO1xuICAgICAgICBsZXQgc3RhdHVzID0gJ3VuZmluaXNoZWQnXG5cbiAgICAgICAgY29uc29sZS5sb2coaXNUaGlzV2Vlayh0b0RhdGUoZHVlZGF0ZSkpKVxuICAgICAgICBjb25zb2xlLmxvZyhpc1RvZGF5KHRvRGF0ZShkdWVkYXRlKSkpXG5cbiAgICAgICAgaWYgKHRpdGxlID09PSAnJyB8fCBkZXRhaWxzID09PSAnJyB8fCBkdWVkYXRlID09PSAnJykgcmV0dXJuXG5cbiAgICAgICAgY29uc3QgdGFzayA9IGNyZWF0ZVRhc2soaWQsIHRpdGxlLCBkZXRhaWxzLCBkdWVkYXRlLCBwcmlvcml0eSwgcHJvamVjdElkLCBzdGF0dXMpO1xuICAgICAgICBjb25zb2xlLmxvZyh0YXNrKTtcblxuICAgICAgICBhZGRUb1Rhc2tsaXN0KHByb2plY3RJZCwgdGFzayk7ICAgICAgIFxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGFkZFRvVGFza2xpc3QocHJvamVjdElkLCB0YXNrKSB7XG4gICAgICAgIGNvbnN0IHByb2plY3RMaXN0ID0gcHJvamVjdHMuZ3JhYlByb2plY3RMaXN0KCk7XG5cbiAgICAgICAgaWYgKHByb2plY3RJZCA9PT0gMCkge1xuICAgICAgICAgICAgcHJvamVjdExpc3RbMF0udGFza0xpc3QucHVzaCh0YXNrKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHByb2plY3RMaXN0KVxuICAgICAgICB9XG5cbiAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCBwcm9qZWN0TGlzdC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgaWYgKHByb2plY3RMaXN0W2ldLmlkID09PSBwcm9qZWN0SWQpIHtcbiAgICAgICAgICAgICAgICBBZGR0b0xpc3QuYWRkVG9MaXN0KHRhc2spO1xuICAgICAgICAgICAgICAgIHByb2plY3RMaXN0W2ldLnRhc2tMaXN0LnB1c2godGFzayk7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cocHJvamVjdExpc3QpXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjcmVhdGVJZCgpIHtcbiAgICAgICAgbGV0IGxpc3QgPSBwcm9qZWN0cy5ncmFiUHJvamVjdExpc3QoKVswXS50YXNrTGlzdDtcbiAgICAgICAgbGV0IGlkO1xuXG4gICAgICAgIGlmIChsaXN0Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIGlkID0gMDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBpZCA9IGxpc3RbbGlzdC5sZW5ndGgtMV0uaWQgKyAxO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gcmVzZXQoKSB7XG4gICAgICAgIGxldCB0aXRsZVZhbHVlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RpdGxlJyk7XG4gICAgICAgIHRpdGxlVmFsdWUudmFsdWUgPSAnJztcbiAgICAgICAgdGl0bGUgPSAnJztcblxuICAgICAgICBsZXQgZGV0YWlsc1ZhbHVlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RldGFpbHMnKTtcbiAgICAgICAgZGV0YWlsc1ZhbHVlLnZhbHVlID0gJyc7XG4gICAgICAgIGRldGFpbHMgPSAnJztcblxuICAgICAgICBsZXQgZHVlZGF0ZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkYXRlJyk7XG4gICAgICAgIGR1ZWRhdGUudmFsdWUgPSAnJztcblxuICAgICAgICBsZXQgcHJpb3JpdHkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJpb3JpdHknKTtcbiAgICAgICAgcHJpb3JpdHkudmFsdWUgPSAnTG93JztcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBpbml0U3VibWl0QnRuKCkge1xuICAgICAgICBjb25zdCBzdWJtaXRCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjc3VibWl0Jyk7XG5cbiAgICAgICAgc3VibWl0QnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgICAgICAgICAgIHN1Ym1pdFRhc2soKTtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIH0pO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGVkaXRUYXNrKGlkKSB7XG4gICAgICAgIGxldCB0YXNrVGl0bGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGl0bGUnKS52YWx1ZTtcbiAgICAgICAgbGV0IHRhc2tEZXRhaWxzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RldGFpbHMnKS52YWx1ZTtcbiAgICAgICAgbGV0IHRhc2tEYXRlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RhdGUnKS52YWx1ZTtcbiAgICAgICAgbGV0IHRhc2tQcmlvcml0eSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcmlvcml0eScpLnZhbHVlO1xuXG4gICAgICAgIGNvbnN0IHRhc2tMaXN0ID0gcHJvamVjdHMuZ3JhYlByb2plY3RMaXN0KClbMF0udGFza0xpc3Q7XG4gICAgICAgIGNvbnN0IGVkaXRlZFRhc2sgPSB0YXNrTGlzdC5maWx0ZXIodGFzayA9PiBpZCA9PT0gdGFzay5pZClbMF07XG5cbiAgICAgICAgZWRpdGVkVGFzay50aXRsZSA9IHRhc2tUaXRsZTtcbiAgICAgICAgZWRpdGVkVGFzay5kZXRhaWxzID0gdGFza0RldGFpbHM7XG4gICAgICAgIGVkaXRlZFRhc2suZHVlZGF0ZSA9IHRhc2tEYXRlO1xuICAgICAgICBlZGl0ZWRUYXNrLnByaW9yaXR5ID0gdGFza1ByaW9yaXR5O1xuXG4gICAgICAgIHRpdGxlID0gdGFza1RpdGxlO1xuICAgICAgICBkZXRhaWxzID0gdGFza0RldGFpbHM7XG5cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0YXNrTGlzdC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgaWYgKHRhc2tMaXN0W2ldLmlkID09PSBpZCkge1xuICAgICAgICAgICAgICAgIHRhc2tMaXN0W2ldID0gZWRpdGVkVGFzaztcbiAgICAgICAgICAgICAgICBwcm9qZWN0cy51cGRhdGVQcm9qZWN0KHRhc2tMaXN0W2ldLnByb2plY3QpO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHByb2plY3RzLmdyYWJQcm9qZWN0TGlzdCgpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIHN1Ym1pdFRhc2soKSB7XG4gICAgICAgIGNvbnN0IG5ld1Rhc2tGb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI21haW4tZm9ybScpO1xuICAgICAgICBjb25zdCBuZXdUYXNrQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI25ld1Rhc2snKTtcbiAgICAgICAgY29uc3QgdGFza0lkID0gcGFyc2VJbnQobmV3VGFza0Zvcm0uZ2V0QXR0cmlidXRlKCdkYXRhLXRhc2tJZCcpKTtcbiAgICAgICAgXG4gICAgICAgIGlmIChuZXdUYXNrRm9ybS5nZXRBdHRyaWJ1dGUoJ2NsYXNzJykgPT09ICdlZGl0LW1vZGUnKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnd2VyaycpXG4gICAgICAgICAgICBlZGl0VGFzayh0YXNrSWQpO1xuICAgICAgICB9IGVsc2Uge2NyZWF0ZU5ld1Rhc2soKX07XG4gICAgICAgIHN0b3JlTG9jYWwuc3RvcmVQcm9qZWN0cygpO1xuXG4gICAgICAgIGlmICh0aXRsZSA9PT0gJycgfHwgZGV0YWlscyA9PT0gJycpIHJldHVyblxuXG4gICAgICAgIGxldCBwcm9qZWN0SWQ7XG4gICAgICAgIGxldCB0YXNrTGlzdCA9IHByb2plY3RzLmdyYWJQcm9qZWN0TGlzdCgpWzBdLnRhc2tMaXN0XG5cbiAgICAgICAgaWYgKG5ld1Rhc2tGb3JtLmdldEF0dHJpYnV0ZSgnY2xhc3MnKSA9PT0gJ2VkaXQtbW9kZScpIHtcbiAgICAgICAgICAgIHByb2plY3RJZCA9IHRhc2tMaXN0LmZpbHRlcih0YXNrID0+IHRhc2tJZCA9PT0gdGFzay5pZClbMF0ucHJvamVjdDtcbiAgICAgICAgICAgIG5ld1Rhc2tGb3JtLmNsYXNzTGlzdC5yZW1vdmUoJ2VkaXQtbW9kZScpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcHJvamVjdElkID0gdGFza0xpc3RbdGFza0xpc3QubGVuZ3RoIC0gMV0ucHJvamVjdDsgXG4gICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICByZW5kZXJUYXNrLnVwZGF0ZURpc3BsYXkocHJvamVjdElkKTtcbiAgICAgICAgcmVzZXQoKTtcbiAgICAgICAgbmV3VGFza0Zvcm0uc2V0QXR0cmlidXRlKCdoaWRkZW4nLCAnJyk7XG4gICAgICAgIG5ld1Rhc2tCdG4ucmVtb3ZlQXR0cmlidXRlKCdoaWRkZW4nKTtcbiAgICAgICAgXG4gICAgfVxuXG4gICAgZnVuY3Rpb24gY2FuY2VsVGFzaygpIHtcbiAgICAgICAgY29uc3QgY2FuY2VsQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2NhbmNlbCcpO1xuICAgICAgICBjb25zdCBuZXdUYXNrRm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNtYWluLWZvcm0nKTtcbiAgICAgICAgY29uc3QgbmV3VGFza0J0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNuZXdUYXNrJyk7XG5cbiAgICAgICAgY2FuY2VsQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgICAgICAgICAgIHJlc2V0KCk7XG4gICAgICAgICAgICBuZXdUYXNrRm9ybS5zZXRBdHRyaWJ1dGUoJ2hpZGRlbicsICcnKTtcbiAgICAgICAgICAgIG5ld1Rhc2tCdG4ucmVtb3ZlQXR0cmlidXRlKCdoaWRkZW4nKTtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgfSlcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBvcGVuVGFza0NyZWF0b3IoKSB7XG4gICAgICAgIGNvbnN0IG5ld1Rhc2tCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjbmV3VGFzaycpO1xuICAgICAgICBjb25zdCBuZXdUYXNrRm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNtYWluLWZvcm0nKTtcblxuICAgICAgICBuZXdUYXNrQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgICAgICAgICAgIHByb2plY3RzLmdyYWJQcm9qZWN0SWQoZSk7XG4gICAgICAgICAgICBuZXdUYXNrRm9ybS5yZW1vdmVBdHRyaWJ1dGUoJ2hpZGRlbicpO1xuICAgICAgICAgICAgbmV3VGFza0J0bi5zZXRBdHRyaWJ1dGUoJ2hpZGRlbicsICcnKTtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgfSlcbiAgICB9XG5cbiAgICByZXR1cm4geyBjcmVhdGVOZXdUYXNrLCBpbml0U3VibWl0QnRuLCBjYW5jZWxUYXNrLCBvcGVuVGFza0NyZWF0b3IsIGFkZFRvVGFza2xpc3QgfVxufSkoKTtcblxuZXhwb3J0IHsgTmV3VGFzayB9XG4iLCJpbXBvcnQgeyBOZXdUYXNrIH0gZnJvbSBcIi4vbWFuYWdlVGFzay5qc1wiO1xuaW1wb3J0IHsgcHJvamVjdHMgfSBmcm9tIFwiLi9tYW5hZ2VQcm9qZWN0LmpzXCI7XG5pbXBvcnQgeyByZW5kZXJUYXNrIH0gZnJvbSBcIi4vVUkuanNcIjtcbmltcG9ydCB7IHN0b3JlTG9jYWwgfSBmcm9tIFwiLi9zdG9yYWdlLmpzXCI7XG5cbk5ld1Rhc2suaW5pdFN1Ym1pdEJ0bigpO1xuTmV3VGFzay5jYW5jZWxUYXNrKCk7XG5OZXdUYXNrLm9wZW5UYXNrQ3JlYXRvcigpO1xuXG5wcm9qZWN0cy5zdWJtaXRQcm9qZWN0KCk7XG5cbmNvbnN0IHRvZGF5VGFiID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3RvZGF5Jyk7XG5jb25zdCB3ZWVrVGFiID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3dlZWtseScpO1xuY29uc3QgaW5ib3hUYWIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjaW5ib3gnKTtcblxudG9kYXlUYWIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLHJlbmRlclRhc2suZGlzcGxheURhaWx5KTtcbndlZWtUYWIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCByZW5kZXJUYXNrLmRpc3BsYXlXZWVrbHkpO1xuaW5ib3hUYWIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCByZW5kZXJUYXNrLmRpc3BsYXlJbmJveCk7XG5cbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCBzdG9yZUxvY2FsLmxvYWRTdG9yYWdlKTsiXSwibmFtZXMiOlsiQWRkdG9MaXN0IiwiVG9kb0xpc3QiLCJhZGRUb0xpc3QiLCJ0YXNrIiwicHVzaCIsImNvbnNvbGUiLCJsb2ciLCJyZW1vdmVUYXNrIiwiaWQiLCJmaWx0ZXIiLCJzdG9yZUxvY2FsIiwicHJvamVjdExpc3QiLCJwcm9qZWN0cyIsImdyYWJQcm9qZWN0TGlzdCIsIml0ZW0iLCJsb2NhbFN0b3JhZ2UiLCJzZXRJdGVtIiwiSlNPTiIsInN0cmluZ2lmeSIsInBhcnNlIiwiZ2V0SXRlbSIsIm5ld0xpc3QiLCJwcm9qZWN0IiwiZm9yRWFjaCIsInRhc2tMaXN0IiwiYWRkVG9Qcm9qZWN0TGlzdCIsInJlbmRlclByb2plY3QiLCJkaXNwbGF5UHJvamVjdCIsIk5ld1Rhc2siLCJhZGRUb1Rhc2tsaXN0IiwicmVuZGVyVGFzayIsInVwZGF0ZURpc3BsYXkiLCJuZXdQcm9qZWN0IiwidGl0bGUiLCJwcm9qZWN0VGl0bGUiLCJnZW5lcmFsTGlzdCIsImN1cnJlbnRQcm9qZWN0Iiwic3VibWl0UHJvamVjdCIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwicHJldmVudERlZmF1bHQiLCJ2YWx1ZSIsInByb2plY3RJZCIsImxlbmd0aCIsImNyZWF0ZVByb2plY3QiLCJncmFiUHJvamVjdElkIiwicGFyc2VJbnQiLCJ0YXJnZXQiLCJnZXRBdHRyaWJ1dGUiLCJncmFiQ3VycmVudFByb2plY3QiLCJ1cGRhdGVHZW5lcmFsTGlzdCIsInVwZGF0ZVByb2plY3QiLCJ1cGRhdGUiLCJncmFiQ3VycmVudFByb2plY3RUYXNrcyIsInJlbW92ZVByb2plY3QiLCJ0b0RhdGUiLCJhcmd1bWVudCIsImFyZ1N0ciIsIk9iamVjdCIsInByb3RvdHlwZSIsInRvU3RyaW5nIiwiY2FsbCIsIkRhdGUiLCJjb25zdHJ1Y3RvciIsIk5hTiIsInN0YXJ0T2ZEYXkiLCJkYXRlIiwiX2RhdGUiLCJzZXRIb3VycyIsImlzVG9kYXkiLCJkYXRlTGVmdCIsImRhdGVSaWdodCIsIm5vdyIsImRlZmF1bHRPcHRpb25zIiwiZ2V0RGVmYXVsdE9wdGlvbnMiLCJzdGFydE9mV2VlayIsIm9wdGlvbnMiLCJ3ZWVrU3RhcnRzT24iLCJsb2NhbGUiLCJkYXkiLCJnZXREYXkiLCJkaWZmIiwic2V0RGF0ZSIsImdldERhdGUiLCJpc1RoaXNXZWVrIiwiaXNTYW1lV2VlayIsImRpc3BsYXlBbGxUYXNrIiwiaXRlbXMiLCJkaXNwbGF5IiwiY29udGFpbmVyIiwiY3JlYXRlRWxlbWVudCIsInNldEF0dHJpYnV0ZSIsImNsYXNzTGlzdCIsImFkZCIsImR1ZWRhdGUiLCJkZXRhaWxzIiwicHJpb3JpdHkiLCJkZWxldGVCdG4iLCJlZGl0QnRuIiwiY2hlY2tib3giLCJsYWJlbCIsInRleHRDb250ZW50IiwiaW5pdENoZWNrYm94T24iLCJyZW1vdmVBdHRyaWJ1dGUiLCJzdGF0dXMiLCJyZW1vdmUiLCJpbml0Q2hlY2tib3hPZmYiLCJBbGx0YXNrIiwibGFzdEVsZW1lbnRDaGlsZCIsInJlbW92ZUNoaWxkIiwiaW5pdERlbEJ0biIsInRhc2tGb3JtIiwiZ2V0RWxlbWVudEJ5SWQiLCJ0YXNrVGl0bGUiLCJ0YXNrRGV0YWlscyIsInRhc2tEYXRlIiwidGFza1ByaW9yaXR5IiwiaW5pdEVkaXRCdG4iLCJhcHBlbmQiLCJhcHBlbmRDaGlsZCIsImdyYWJUYWIiLCJ0YWIiLCJkaXNwbGF5SW5ib3giLCJkaXNwbGF5RGFpbHkiLCJkaXNwbGF5V2Vla2x5IiwiZGlzcGxheVByb2plY3RUYXNrcyIsImxpc3QiLCJyZXBsYWNlIiwicHJvamVjdERpc3BsYXkiLCJwcm9qZWN0VGFza0J0biIsInByb2plY3REZWxCdG4iLCJzdG9wUHJvcGFnYXRpb24iLCJuZXdUYXNrRm9ybSIsInVwZGF0ZWRQcm9qZWN0cyIsInByb2plY3RzRGlzcGxheSIsImluaXREZWxQcm9qQnRuIiwiY3JlYXRlTmV3VGFzayIsImNyZWF0ZUlkIiwiY3JlYXRlVGFzayIsImkiLCJyZXNldCIsImluaXRTdWJtaXRCdG4iLCJuZXdUYXNrQnRuIiwidGFza0lkIiwiZWRpdGVkVGFzayIsImVkaXRUYXNrIiwic3VibWl0VGFzayIsImNhbmNlbFRhc2siLCJjYW5jZWxCdG4iLCJvcGVuVGFza0NyZWF0b3IiLCJ0b2RheVRhYiIsIndlZWtUYWIiLCJpbmJveFRhYiJdLCJzb3VyY2VSb290IjoiIn0=